<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>WrightTech Inventory V2.0</title>
    <!--
    V2.0 - COMPLETE INVENTORY MANAGEMENT SYSTEM
    
    âœ… Core Features:
    - Real-time Firebase sync across all devices
    - Smart search with location & category filters
    - Comprehensive item editing with autocomplete suppliers
    - Water stock tracking with visual health bar
    - Shelf layout visualization with images
    - Stock counting with shop/storage separation
    - Shift log notes with item linking
    
    âœ… V2.0 Features:
    - ðŸ“ Inline note editing in search results
    - ðŸ¢ Supplier grouping in reorder lists with copy-to-clipboard
    - ðŸ‘ï¸ Hide/unhide items from alerts
    - ðŸ“Š Expandable alert lists (show more/less)
    - âš¡ Quick reorder buttons directly in alerts
    - ðŸ“Š Complete activity history with filtering
    - ðŸ“… Collapsible notes grouped by week (Inbox)
    - ðŸ”„ Retroactive activity generation
    
    âœ… Smart Alerts System:
    - Critical stock alerts (red)
    - Low stock warnings (orange)
    - Transfer recommendations (blue)
    - Grouped by supplier for easy ordering
    
    FULL FIREBASE REAL-TIME SYNC
    -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
        }

        :root {
            --primary-orange: #FF8C42;
            --primary-black: #1a1a1a;
            --primary-white: #ffffff;
            --light-gray: #f8f8f8;
            --border-gray: #e0e0e0;
            --text-gray: #666;
        }

        .app {
            max-width: 100%;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--primary-black);
            color: var(--primary-white);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--primary-orange);
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav {
            background: var(--primary-white);
            border-bottom: 2px solid var(--border-gray);
            padding: 0 2rem;
            display: flex;
            gap: 0;
            overflow-x: auto;
        }

        .nav-button {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-button:hover {
            color: var(--primary-black);
            background: var(--light-gray);
        }

        .nav-button.active {
            color: var(--primary-black);
            border-bottom-color: var(--primary-orange);
            font-weight: 600;
        }

        /* Main Content */
        .content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Search Page */
        .search-container {
            background: var(--primary-white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .search-box {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            margin-bottom: 2rem;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-orange);
        }

        .search-results {
            margin-top: 2rem;
        }

        .result-item {
            background: var(--light-gray);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary-orange);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .result-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .result-item h3 {
            color: var(--primary-black);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .result-item p {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin: 0.25rem 0;
        }

        .result-location {
            display: inline-block;
            background: var(--primary-orange);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .result-tag {
            display: inline-block;
            background: var(--primary-black);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        /* Storage Map */
        .storage-map {
            background: var(--primary-white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .map-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary-black);
        }

        .zone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .zone-card {
            background: linear-gradient(135deg, var(--primary-black) 0%, #2d2d2d 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 3px solid transparent;
        }

        .zone-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-color: var(--primary-orange);
        }

        .zone-card h3 {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
        }

        .zone-card p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .zone-badge {
            background: var(--primary-orange);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: inline-block;
            margin-top: 1rem;
            font-weight: 600;
        }

        /* Shelf Grid */
        .shelf-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .shelf-card {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--border-gray);
            cursor: pointer;
            transition: all 0.3s;
        }

        .shelf-card:hover {
            border-color: var(--primary-orange);
            transform: scale(1.02);
        }

        .shelf-card h4 {
            color: var(--primary-black);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        /* Inbox/Alerts */
        .alert-section {
            background: var(--primary-white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .alert-icon {
            font-size: 2rem;
        }

        .alert-title {
            font-size: 1.3rem;
            color: var(--primary-black);
        }

        .alert-count {
            background: #ff4444;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .alert-list {
            list-style: none;
        }

        .alert-item {
            padding: 1rem;
            background: var(--light-gray);
            margin-bottom: 0.75rem;
            border-radius: 6px;
            border-left: 4px solid #ff4444;
        }

        .alert-item.warning {
            border-left-color: #ffa500;
        }

        .alert-item.info {
            border-left-color: var(--primary-orange);
        }

        /* Back Button */
        .back-button {
            background: var(--primary-black);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #2d2d2d;
        }

        /* Stock Count */
        .stock-count-container {
            background: var(--primary-white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .progress-bar {
            background: var(--border-gray);
            height: 8px;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--primary-orange);
            height: 100%;
            transition: width 0.3s;
        }

        .count-item {
            background: var(--light-gray);
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .count-input {
            width: 80px;
            padding: 0.5rem;
            border: 2px solid var(--border-gray);
            border-radius: 4px;
            font-size: 1rem;
        }

        .count-button {
            background: var(--primary-orange);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .count-button:hover {
            background: #ff7b2e;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content {
                padding: 1rem;
                padding-bottom: 6rem; /* Extra space for bottom nav */
            }

            .header {
                padding: 1.5rem 1rem;
                background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            }

            .header h1 {
                font-size: 1.6rem;
                margin-bottom: 0.5rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .nav {
                padding: 0.5rem 0.5rem;
            }

            .nav-button {
                padding: 1rem 0.75rem;
                font-size: 0.9rem;
                min-height: 60px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 0.25rem;
            }

            /* Larger touch targets for mobile */
            .search-input, .search-button {
                font-size: 1rem;
                padding: 1rem;
                min-height: 50px;
            }

            .result-item, .stock-item {
                padding: 1.25rem;
                margin-bottom: 1rem;
            }

            .result-item h3 {
                font-size: 1.2rem;
                margin-bottom: 0.75rem;
            }

            .back-button {
                padding: 1rem 1.5rem;
                font-size: 1rem;
                min-height: 50px;
            }

            .shelf-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .shelf-card {
                padding: 1.5rem 1rem;
                min-height: 120px;
            }

            .zone-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .zone-card {
                padding: 1.5rem;
                min-height: 100px;
            }

            /* Make SVG map scrollable on mobile */
            .storage-map svg {
                max-width: 100%;
                height: auto;
            }

            /* Adjust analytics charts for mobile */
            .stock-count-container {
                padding: 1.25rem;
            }

            /* Better spacing for mobile */
            h2, h3 {
                margin-top: 1.5rem;
                margin-bottom: 1rem;
            }
        }

        /* Mobile-specific enhancements */
        @media (max-width: 768px) {
            /* Bottom navigation for mobile */
            .nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--primary-white);
                border-top: 2px solid var(--border-gray);
                border-bottom: none;
                padding: 0.5rem 0;
                z-index: 1000;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                overflow-x: auto;
            }

            .nav-button {
                flex-direction: column;
                padding: 0.5rem 0.75rem;
                font-size: 0.7rem;
                gap: 0.25rem;
                min-width: 70px;
            }

            .content {
                padding-bottom: 80px; /* Space for bottom nav */
            }

            /* Larger touch targets */
            .search-box {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }

            .count-button,
            .back-button {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }

            /* Stack cards vertically */
            .zone-grid,
            .shelf-grid {
                grid-template-columns: 1fr;
            }

            /* Simplify result items for mobile */
            .result-item {
                padding: 1.25rem;
            }

            /* Mobile-friendly analytics cards */
            .stock-count-container {
                padding: 1.25rem;
            }

            /* Better spacing for mobile forms */
            .count-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .count-item > div:last-child {
                flex-direction: column;
            }

            /* Full width buttons on mobile */
            .count-button {
                width: 100%;
            }

            /* Responsive table alternative - use cards */
            .alert-section {
                padding: 1.25rem;
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .zone-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .shelf-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Desktop optimizations */
        @media (min-width: 1025px) {
            .content {
                max-width: 1400px;
            }

            /* Hover effects for desktop only */
            .result-item:hover {
                transform: translateX(4px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .zone-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            }

            .shelf-card:hover {
                transform: scale(1.02);
            }
        }

        /* Chart container responsive */
        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }

        /* SVG charts responsive */
        .chart-svg {
            width: 100%;
            height: 100%;
        }

        /* Legend responsive */
        .chart-legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .chart-legend {
                font-size: 0.75rem;
                gap: 0.5rem;
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCWvAkAfDCkljNQmTyQsrhES7pm4H751EQ",
            authDomain: "wrighttech-inventory.firebaseapp.com",
            projectId: "wrighttech-inventory",
            storageBucket: "wrighttech-inventory.firebasestorage.app",
            messagingSenderId: "891021456690",
            appId: "1:891021456690:web:e81d5b7ff36dd3f687532b"
        };
        
        firebase.initializeApp(firebaseConfig);
        window.db = firebase.firestore();
        console.log("ðŸ”¥ Firebase connected!");
    </script>
    
    <!-- SheetJS for Excel file reading -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Minimal sample data - actual inventory loads from Firebase
        // Use Firebase tab to upload full inventory from JSON file
        const inventoryData = [
            {
                "name": "Sample Item",
                "category": "Samples",
                "location": "A1.1",
                "quantity": 0,
                "quantityShop": 0,
                "quantityStore": 0,
                "minStock": 5,
                "reorderPoint": 10,
                "criticalLevel": 5,
                "warningLevel": 10,
                "supplier": "TBD",
                "lastRestocked": "2025-01-04",
                "notes": []
            }
        ];

        // Dual stock tracking + notes data
        const stockLocations = {
            1: { shopFloor: 24, storage: 45, lastRestocked: '2 days ago', notes: [] },
            4: { shopFloor: 48, storage: 115, lastRestocked: '1 day ago', notes: [] },
            5: { shopFloor: 36, storage: 98, lastRestocked: '1 day ago', notes: [] },
            41: { shopFloor: 15, storage: 35, lastRestocked: '2 days ago', notes: [
                { text: 'Bestseller - tourists love these!', author: 'Sarah', date: '3 days ago' },
                { text: 'Display near entrance for maximum visibility', author: 'John', date: '1 week ago' }
            ]},
            75: { shopFloor: 8, storage: 22, lastRestocked: '3 days ago', notes: [
                { text: 'Pairs well with T-shirts for bundles', author: 'Maria', date: '5 days ago' }
            ]},
            85: { shopFloor: 6, storage: 18, lastRestocked: '12 hours ago', notes: [
                { text: 'WHITE color most popular - restock frequently', author: 'Sarah', date: '2 days ago' },
                { text: 'Mention dishwasher-safe feature = more sales', author: 'John', date: '1 week ago' }
            ]},
            68: { shopFloor: 12, storage: 28, lastRestocked: '4 days ago', notes: [] },
            69: { shopFloor: 10, storage: 25, lastRestocked: '4 days ago', notes: [] },
            70: { shopFloor: 3, storage: 8, lastRestocked: '45 days ago', notes: [
                { text: 'Customer said Â£12.99 too expensive for kids item', author: 'Sarah', date: '1 week ago' }
            ]}
        };

        // Fill in remaining items with default stock data
        inventoryData.forEach(item => {
            if (!stockLocations[item.id]) {
                const totalStock = Math.floor(Math.random() * 60) + 10;
                const shopFloor = Math.floor(totalStock * 0.3); // 30% on shop floor
                stockLocations[item.id] = {
                    shopFloor: shopFloor,
                    storage: totalStock - shopFloor,
                    lastRestocked: ['1 day ago', '2 days ago', '3 days ago', '1 week ago'][Math.floor(Math.random() * 4)],
                    notes: []
                };
            }
        });

        // Shift logs - daily staff notes
        const shiftLogs = [
            {
                date: 'Today - Dec 15, 2024',
                shift: 'Morning',
                staff: 'Sarah',
                sellingWell: [
                    'Vintage mugs WHITE - restocked twice already!',
                    'Adult caps BLACK - sold 8 units by noon'
                ],
                customerRequests: [
                    '3 customers asked for Gibraltar flag patches',
                    'Tourist wanted Rock of Gibraltar snow globe (we don\'t stock)'
                ],
                priceFeedback: [
                    'Kids caps - customer said too expensive at Â£12.99'
                ],
                issues: [
                    'Barcode scanner running slow on shelf A2'
                ]
            },
            {
                date: 'Yesterday - Dec 14, 2024',
                shift: 'Afternoon',
                staff: 'John',
                sellingWell: [
                    'Spitfire Collection doing well as bundles',
                    'Wine sales up - Rioja particularly popular'
                ],
                customerRequests: [
                    'Customer asked about international shipping',
                    'Request for WW1 memorabilia (out of our period)'
                ],
                priceFeedback: [],
                issues: []
            },
            {
                date: 'Dec 13, 2024',
                shift: 'Morning',
                staff: 'Maria',
                sellingWell: [
                    'Books selling to tour groups',
                    'Magnets as always'
                ],
                customerRequests: [
                    'Spanish tourist asked for items in Spanish - language barrier',
                    '2 people wanted Spitfire model planes (larger items)'
                ],
                priceFeedback: [
                    'Customer loved the wine selection and prices'
                ],
                issues: [
                    'Shelf display in Zone A looks messy - needs reorganizing'
                ]
            }
        ];

        // Time-based analytics data
        
        // Hourly sales pattern (9am - 6pm)
        const hourlySales = [
            { hour: '9am', sales: 12, revenue: 180 },
            { hour: '10am', sales: 28, revenue: 420 },
            { hour: '11am', sales: 45, revenue: 675 },
            { hour: '12pm', sales: 52, revenue: 780 },
            { hour: '1pm', sales: 48, revenue: 720 },
            { hour: '2pm', sales: 35, revenue: 525 },
            { hour: '3pm', sales: 22, revenue: 330 },
            { hour: '4pm', sales: 38, revenue: 570 },
            { hour: '5pm', sales: 42, revenue: 630 },
            { hour: '6pm', sales: 25, revenue: 375 }
        ];

        // Daily sales with variables (last 2 weeks)
        const dailySales = [
            { date: 'Mon 2', revenue: 1450, sales: 95, variables: [] },
            { date: 'Tue 3', revenue: 1680, sales: 112, variables: ['tour'] },
            { date: 'Wed 4', revenue: 1520, sales: 98, variables: [] },
            { date: 'Thu 5', revenue: 2100, sales: 145, variables: ['cruise'] },
            { date: 'Fri 6', revenue: 1890, sales: 125, variables: [] },
            { date: 'Sat 7', revenue: 2450, sales: 168, variables: ['weekend'] },
            { date: 'Sun 8', revenue: 2380, sales: 162, variables: ['weekend'] },
            { date: 'Mon 9', revenue: 1420, sales: 92, variables: [] },
            { date: 'Tue 10', revenue: 1750, sales: 118, variables: ['tour'] },
            { date: 'Wed 11', revenue: 2250, sales: 152, variables: ['cruise', 'tour'] },
            { date: 'Thu 12', revenue: 1680, sales: 108, variables: [] },
            { date: 'Fri 13', revenue: 1920, sales: 128, variables: [] },
            { date: 'Sat 14', revenue: 2520, sales: 172, variables: ['weekend'] },
            { date: 'Sun 15', revenue: 2410, sales: 165, variables: ['weekend'] }
        ];

        // Weekly sales trend (last 12 weeks)
        const weeklySales = [
            { week: 'Week 1', revenue: 8400, sales: 560 },
            { week: 'Week 2', revenue: 9200, sales: 615 },
            { week: 'Week 3', revenue: 8800, sales: 590 },
            { week: 'Week 4', revenue: 10100, sales: 675 },
            { week: 'Week 5', revenue: 9600, sales: 640 },
            { week: 'Week 6', revenue: 11200, sales: 748 },
            { week: 'Week 7', revenue: 10800, sales: 720 },
            { week: 'Week 8', revenue: 12400, sales: 828 },
            { week: 'Week 9', revenue: 11900, sales: 795 },
            { week: 'Week 10', revenue: 13200, sales: 882 },
            { week: 'Week 11', revenue: 12800, sales: 855 },
            { week: 'Week 12', revenue: 14100, sales: 942 }
        ];

        // Sales by day of week (average)
        const dayOfWeekSales = [
            { day: 'Monday', avgSales: 94, avgRevenue: 1435 },
            { day: 'Tuesday', avgSales: 115, avgRevenue: 1715 },
            { day: 'Wednesday', avgSales: 125, avgRevenue: 1885 },
            { day: 'Thursday', avgSales: 127, avgRevenue: 1890 },
            { day: 'Friday', avgSales: 127, avgRevenue: 1905 },
            { day: 'Saturday', avgSales: 170, avgRevenue: 2485 },
            { day: 'Sunday', avgSales: 164, avgRevenue: 2395 }
        ];

        // New item tracking (Spitfire Collection Bundle - launched 8 weeks ago)
        const newItemPerformance = [
            { week: 'Week 1', sales: 12, revenue: 156 },
            { week: 'Week 2', sales: 18, revenue: 234 },
            { week: 'Week 3', sales: 25, revenue: 325 },
            { week: 'Week 4', sales: 28, revenue: 364 },
            { week: 'Week 5', sales: 32, revenue: 416 },
            { week: 'Week 6', sales: 35, revenue: 455 },
            { week: 'Week 7', sales: 38, revenue: 494 },
            { week: 'Week 8', sales: 42, revenue: 546 }
        ];

        // Sample sales data for last 30 days (for analytics)
        const salesData = {
            1: { sold: 45, revenue: 67.50, trend: 'stable' },
            2: { sold: 12, revenue: 24.00, trend: 'down' },
            3: { sold: 8, revenue: 16.00, trend: 'stable' },
            4: { sold: 115, revenue: 172.50, trend: 'up' },
            5: { sold: 98, revenue: 147.00, trend: 'stable' },
            6: { sold: 23, revenue: 34.50, trend: 'down' },
            7: { sold: 87, revenue: 130.50, trend: 'up' },
            8: { sold: 34, revenue: 51.00, trend: 'stable' },
            9: { sold: 56, revenue: 84.00, trend: 'stable' },
            10: { sold: 78, revenue: 117.00, trend: 'up' },
            11: { sold: 15, revenue: 22.50, trend: 'stable' },
            39: { sold: 76, revenue: 304.00, trend: 'up' },
            40: { sold: 92, revenue: 368.00, trend: 'up' },
            41: { sold: 156, revenue: 624.00, trend: 'up' }, // Bestseller
            42: { sold: 43, revenue: 215.00, trend: 'stable' },
            43: { sold: 38, revenue: 190.00, trend: 'stable' },
            50: { sold: 65, revenue: 260.00, trend: 'up' },
            51: { sold: 87, revenue: 348.00, trend: 'up' },
            52: { sold: 54, revenue: 216.00, trend: 'stable' },
            53: { sold: 32, revenue: 128.00, trend: 'stable' },
            54: { sold: 71, revenue: 284.00, trend: 'up' },
            55: { sold: 3, revenue: 12.00, trend: 'down' }, // Slow mover
            56: { sold: 61, revenue: 305.00, trend: 'stable' },
            57: { sold: 48, revenue: 240.00, trend: 'stable' },
            68: { sold: 72, revenue: 1080.00, trend: 'up' },
            69: { sold: 88, revenue: 1320.00, trend: 'up' },
            70: { sold: 2, revenue: 24.00, trend: 'down' }, // Slow mover
            71: { sold: 5, revenue: 60.00, trend: 'down' },
            73: { sold: 45, revenue: 540.00, trend: 'stable' },
            74: { sold: 67, revenue: 804.00, trend: 'up' },
            75: { sold: 128, revenue: 1536.00, trend: 'up' }, // Bestseller
            83: { sold: 95, revenue: 1425.00, trend: 'up' },
            84: { sold: 81, revenue: 810.00, trend: 'stable' },
            85: { sold: 142, revenue: 1704.00, trend: 'up' }, // Bestseller
            86: { sold: 78, revenue: 936.00, trend: 'stable' },
            87: { sold: 34, revenue: 408.00, trend: 'stable' },
            88: { sold: 42, revenue: 504.00, trend: 'stable' },
            89: { sold: 56, revenue: 672.00, trend: 'stable' },
            90: { sold: 67, revenue: 804.00, trend: 'up' },
            91: { sold: 28, revenue: 420.00, trend: 'down' },
            92: { sold: 22, revenue: 330.00, trend: 'down' },
            93: { sold: 18, revenue: 270.00, trend: 'down' },
            104: { sold: 145, revenue: 217.50, trend: 'stable' },
            122: { sold: 31, revenue: 155.00, trend: 'stable' },
            141: { sold: 12, revenue: 60.00, trend: 'stable' },
            142: { sold: 8, revenue: 40.00, trend: 'stable' }
        };

        // Fill in remaining items with random realistic data
        inventoryData.forEach(item => {
            if (!salesData[item.id]) {
                const randomSold = Math.floor(Math.random() * 50) + 5;
                salesData[item.id] = {
                    sold: randomSold,
                    revenue: randomSold * (Math.random() * 10 + 5),
                    trend: ['up', 'stable', 'down'][Math.floor(Math.random() * 3)]
                };
            }
        });

        function App() {
            
            // Firebase Upload Function
            window.uploadAllToFirebase = async function() {
                if (!confirm('Upload all 160 items to Firebase?')) return;
                
                try {
                    console.log('Starting upload...');
                    const batch = window.db.batch();
                    
                    inventoryData.forEach((item, index) => {
                        const docRef = window.db.collection('inventory').doc(`item-${index + 1}`);
                        batch.set(docRef, item);
                    });
                    
                    await batch.commit();
                    alert('âœ… Successfully uploaded ' + inventoryData.length + ' items to Firebase!');
                    console.log('Upload complete!');
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('âŒ Upload failed: ' + error.message);
                }
            };
            
            // Draggable Map Functions
            const saveShelfPositions = async () => {
                try {
                    await window.db.collection('settings').doc('shelfPositions').set({
                        positions: shelfPositions,
                        lastUpdated: new Date().toISOString()
                    });
                    alert('âœ… Shelf layout saved and synced!');
                } catch (error) {
                    console.error('Save error:', error);
                    alert('âŒ Save failed: ' + error.message);
                }
            };
            
            const resetShelfPositions = async () => {
                if (confirm('Reset all shelves to default layout? This will sync to all devices.')) {
                    const defaultPos = {
                        A1: { x: 130, y: 60 }, A2: { x: 250, y: 60 }, A3: { x: 370, y: 60 },
                        A4: { x: 490, y: 60 }, A5: { x: 130, y: 185 }, A6: { x: 250, y: 185 },
                        B1: { x: 130, y: 310 }, B2: { x: 250, y: 310 }, B3: { x: 370, y: 310 },
                        B4: { x: 490, y: 310 }, B5: { x: 130, y: 435 }, B6: { x: 250, y: 435 },
                        C1: { x: 130, y: 560 }, C2: { x: 250, y: 560 }, C3: { x: 370, y: 560 },
                        C4: { x: 490, y: 560 }, C5: { x: 130, y: 685 }, C6: { x: 250, y: 685 }
                    };
                    setShelfPositions(defaultPos);
                    try {
                        await window.db.collection('settings').doc('shelfPositions').set({
                            positions: defaultPos,
                            lastUpdated: new Date().toISOString()
                        });
                        alert('âœ… Reset to default layout and synced!');
                    } catch (error) {
                        console.error('Reset error:', error);
                        alert('âŒ Reset failed: ' + error.message);
                    }
                }
            };
            
            const handleShelfMouseDown = (shelfId, e) => {
                if (!isEditMode) {
                    setSelectedZone(shelfId[0]);
                    return;
                }
                
                e.stopPropagation();
                const svgRect = e.currentTarget.closest('svg').getBoundingClientRect();
                const pos = shelfPositions[shelfId];
                
                setIsDragging(shelfId);
                setDragOffset({
                    x: e.clientX - svgRect.left - pos.x,
                    y: e.clientY - svgRect.top - pos.y
                });
            };
            
            const handleSVGMouseMove = (e) => {
                if (!isDragging || !isEditMode) return;
                
                const svgRect = e.currentTarget.getBoundingClientRect();
                let newX = e.clientX - svgRect.left - dragOffset.x;
                let newY = e.clientY - svgRect.top - dragOffset.y;
                
                newX = Math.max(130, Math.min(newX, 580));
                newY = Math.max(60, Math.min(newY, 900));
                
                setShelfPositions(prev => ({
                    ...prev,
                    [isDragging]: { x: Math.round(newX), y: Math.round(newY) }
                }));
            };
            
            const handleMouseUp = () => {
                setIsDragging(null);
            };

            
            const [currentPage, setCurrentPage] = useState('search');
            
            // Draggable Shelf Positions - Firebase will sync these
            const [shelfPositions, setShelfPositions] = useState({
                A1: { x: 130, y: 60 }, A2: { x: 250, y: 60 }, A3: { x: 370, y: 60 },
                A4: { x: 490, y: 60 }, A5: { x: 130, y: 185 }, A6: { x: 250, y: 185 },
                B1: { x: 130, y: 310 }, B2: { x: 250, y: 310 }, B3: { x: 370, y: 310 },
                B4: { x: 490, y: 310 }, B5: { x: 130, y: 435 }, B6: { x: 250, y: 435 },
                C1: { x: 130, y: 560 }, C2: { x: 250, y: 560 }, C3: { x: 370, y: 560 },
                C4: { x: 490, y: 560 }, C5: { x: 130, y: 685 }, C6: { x: 250, y: 685 }
            });
            const [isDragging, setIsDragging] = useState(null);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            const [isEditMode, setIsEditMode] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedZone, setSelectedZone] = useState(null);
            const [selectedShelf, setSelectedShelf] = useState(null);
            
            // Stock Count State
            const [countedItems, setCountedItems] = useState(new Set());
            const [selectedCategory, setSelectedCategory] = useState('All');
            const [stockCountSearch, setStockCountSearch] = useState(''); // NEW: Search in stock count
            const [quantities, setQuantities] = useState({});
            
            // Update countedItems when items load from Firebase
            useEffect(() => {
                const counted = new Set();
                items.forEach(item => {
                    // If item has a lastCounted date from today, mark it as counted
                    if (item.lastCounted === new Date().toISOString().split('T')[0]) {
                        counted.add(item.id);
                    }
                });
                setCountedItems(counted);
            }, [items]);
            
            // Shift Log State
            const [logs, setLogs] = useState([]);
            const [showAddLog, setShowAddLog] = useState(false);
            const [itemSearchQuery, setItemSearchQuery] = useState(''); // For searching items to link
            const [newLog, setNewLog] = useState({
                staffName: '',
                selling: '',
                requests: '',
                priceFeedback: '',
                issues: '',
                linkedItems: [] // Array of item IDs this log relates to
                // REMOVED photos - moved to separate Displays section
            });
            const [editingLogIndex, setEditingLogIndex] = useState(null); // Track which log is being edited
            const [editLog, setEditLog] = useState(null); // Store the log being edited
            
            // Displays State (separate from shift logs)
            const [displays, setDisplays] = useState([]);
            const [showAddDisplay, setShowAddDisplay] = useState(false);
            const [newDisplay, setNewDisplay] = useState({
                title: '',
                description: '',
                location: '',
                photo: null
            });
            const [uploadingImage, setUploadingImage] = useState(false); // Track image compression
            
            // Reorder List State
            const [reorderList, setReorderList] = useState([]);
            
            // Restock State
            const [showRestockMode, setShowRestockMode] = useState(false);
            const [restockItems, setRestockItems] = useState({}); // { itemId: { shopQty: 0, storageQty: 0 } }
            
            // Transfer Stock State
            const [showTransferMode, setShowTransferMode] = useState(false);
            const [transferItems, setTransferItems] = useState({}); // { itemId: quantity }
            
            // Alert Editing State
            const [editingAlertItem, setEditingAlertItem] = useState(null);
            const [alertValues, setAlertValues] = useState({ critical: 5, warning: 10 });
            
            // NEW V1.4 STATE - Improvement Features
            const [editingNoteItem, setEditingNoteItem] = useState(null); // Item being edited for notes in search
            const [noteText, setNoteText] = useState(''); // Note text being edited
            const [hiddenAlertItems, setHiddenAlertItems] = useState([]); // Items hidden from alerts
            const [expandedLowStock, setExpandedLowStock] = useState(false); // Show all low stock items
            const [expandedRestock, setExpandedRestock] = useState(false); // Show all restock items
            const [showActivityHistory, setShowActivityHistory] = useState(false); // Show full activity log
            const [activityLogs, setActivityLogs] = useState([]); // All activity logs from Firebase
            
            // NEW V1.5 STATE - Supplier Grouping
            const [collapsedSuppliers, setCollapsedSuppliers] = useState({}); // Track which supplier sections are collapsed
            
            // NEW V1.6 STATE - Activity History Filters
            const [activityFilter, setActivityFilter] = useState('all'); // Filter by activity type
            const [activitySearch, setActivitySearch] = useState(''); // Search activity logs
            const [activityDateRange, setActivityDateRange] = useState('7days'); // Date range filter
            
            // NEW V1.6.1 STATE - Collapsible Notes by Week
            const [collapsedNoteWeeks, setCollapsedNoteWeeks] = useState({}); // Track which note weeks are collapsed
            
            // NEW V2.0.1 STATE - Dynamic Supplier List
            const [uniqueSuppliers, setUniqueSuppliers] = useState([]); // List of all suppliers used in inventory
            
            // NEW V2.1.2 STATE - Dynamic Category List
            const [uniqueCategories, setUniqueCategories] = useState([]); // List of all categories used in inventory
            
            // NEW V2.2.2 STATE - Sales History for Analytics
            const [salesHistory, setSalesHistory] = useState([]); // All sales records from Firebase
            const [loadingSalesHistory, setLoadingSalesHistory] = useState(true); // Loading state
            
            // Load displays from localStorage
            useEffect(() => {
                const savedDisplays = localStorage.getItem('displays');
                if (savedDisplays) {
                    try {
                        setDisplays(JSON.parse(savedDisplays));
                    } catch (e) {
                        console.error('Error loading displays:', e);
                        localStorage.removeItem('displays');
                    }
                }
            }, []);
            
            // Save displays to localStorage when they change
            useEffect(() => {
                if (displays.length > 0) {
                    try {
                        localStorage.setItem('displays', JSON.stringify(displays));
                    } catch (e) {
                        console.error('Error saving displays:', e);
                        alert('âš ï¸ Storage full! Try removing old displays.');
                    }
                }
            }, [displays]);
            
            // Item Notes State
            const [selectedItem, setSelectedItem] = useState(null);
            const [showNotesModal, setShowNotesModal] = useState(false);
            
            // Firebase Upload State
            const [isUploading, setIsUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState(0);
            
            // Add New Item State
            const [showAddItemModal, setShowAddItemModal] = useState(false);
            const [newItem, setNewItem] = useState({
                name: '',
                category: 'General',
                location: '',
                quantityShop: 0,
                quantityStore: 0,
                minStock: 5,
                reorderPoint: 10,
                supplier: 'TBD',
                notes: []
            });
            
            // Edit Item State - NEW FEATURE V1.2
            const [showEditModal, setShowEditModal] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [editForm, setEditForm] = useState({
                name: '',
                category: '',
                location: '',
                supplier: '',
                criticalLevel: 5,
                warningLevel: 10,
                tag: ''
            });
            
            // Water Stock State - NEW FEATURE V1.2
            const [showWaterEditModal, setShowWaterEditModal] = useState(false);
            const [waterStock, setWaterStock] = useState({
                currentPallets: 9,
                maxPallets: 15,
                bottlesPerPallet: 840 // 42 boxes * 20 bottles
            });
            
            // Shelf Images State - NEW FEATURE V1.2
            const [shelfImages, setShelfImages] = useState({}); // { "A1": "url", "B2": "url", ... }
            const [uploadingShelfImage, setUploadingShelfImage] = useState(null); // Track which shelf is uploading
            const [showShelfImageModal, setShowShelfImageModal] = useState(false);
            const [selectedShelfForImage, setSelectedShelfForImage] = useState(null);
            
            // Active inventory - loads from Firebase, falls back to local data
            const [items, setItems] = useState(inventoryData);
            
            // Real-time Firebase sync - listens for changes from all devices
            useEffect(() => {
                console.log('ðŸ”¥ Setting up real-time Firebase sync...');
                
                // Set up real-time listener
                const unsubscribe = window.db.collection('inventory').onSnapshot(
                    (snapshot) => {
                        if (!snapshot.empty) {
                            const firebaseData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            console.log(`âœ… Real-time update: ${firebaseData.length} items`);
                            setItems(firebaseData);
                        } else {
                            console.log('ðŸ“¦ Firebase empty, using local data');
                            setItems(inventoryData);
                        }
                    },
                    (error) => {
                        console.error('âŒ Firebase sync error:', error);
                        setItems(inventoryData);
                    }
                );
                
                // Cleanup function - unsubscribe when component unmounts
                return () => {
                    console.log('ðŸ”Œ Disconnecting Firebase listener');
                    unsubscribe();
                };
            }, []);
            
            // NEW V2.2.2 - Load sales history from Firebase
            useEffect(() => {
                console.log('ðŸ“Š Loading sales history from Firebase...');
                setLoadingSalesHistory(true);
                
                // Set up real-time listener for salesHistory
                const unsubscribe = window.db.collection('salesHistory')
                    .orderBy('importTimestamp', 'desc') // Most recent first
                    .onSnapshot(
                        (snapshot) => {
                            if (!snapshot.empty) {
                                const history = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }));
                                console.log(`âœ… Loaded ${history.length} sales records`);
                                setSalesHistory(history);
                            } else {
                                console.log('ðŸ“Š No sales history yet');
                                setSalesHistory([]);
                            }
                            setLoadingSalesHistory(false);
                        },
                        (error) => {
                            console.error('âŒ Sales history load error:', error);
                            setSalesHistory([]);
                            setLoadingSalesHistory(false);
                        }
                    );
                
                // Cleanup
                return () => unsubscribe();
            }, []);
            
            // Real-time Firebase sync for shelf positions
            useEffect(() => {
                console.log('ðŸ—ºï¸ Setting up shelf positions sync...');
                
                const unsubscribe = window.db.collection('settings').doc('shelfPositions').onSnapshot(
                    (doc) => {
                        if (doc.exists && doc.data().positions) {
                            const data = doc.data();
                            console.log('âœ… Shelf positions synced from Firebase');
                            setShelfPositions(data.positions);
                        } else {
                            console.log('ðŸ“ No shelf positions in Firebase, using defaults');
                        }
                    },
                    (error) => {
                        console.error('âŒ Shelf positions sync error:', error);
                    }
                );
                
                return () => unsubscribe();
            }, []);
            
            // Real-time Firebase sync for reorder list
            useEffect(() => {
                console.log('ðŸ“‹ Setting up reorder list sync...');
                
                const unsubscribe = window.db.collection('reorderList').onSnapshot(
                    (snapshot) => {
                        if (!snapshot.empty) {
                            const list = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            console.log(`âœ… Reorder list synced: ${list.length} items`);
                            setReorderList(list);
                        } else {
                            console.log('ðŸ“‹ No reorder list in Firebase');
                            setReorderList([]);
                        }
                    },
                    (error) => {
                        console.error('âŒ Reorder list sync error:', error);
                    }
                );
                
                return () => unsubscribe();
            }, []);
            
            // Real-time Firebase sync for shift logs
            useEffect(() => {
                console.log('ðŸ“ Setting up shift logs sync...');
                
                const unsubscribe = window.db.collection('shiftLogs')
                    .onSnapshot(
                        (snapshot) => {
                            if (!snapshot.empty) {
                                const logsList = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }))
                                // Sort by timestamp descending (most recent first)
                                .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                                console.log(`âœ… Shift logs synced: ${logsList.length} logs`);
                                setLogs(logsList);
                            } else {
                                console.log('ðŸ“ No shift logs in Firebase');
                                setLogs([]);
                            }
                        },
                        (error) => {
                            console.error('âŒ Shift logs sync error:', error);
                        }
                    );
                
                return () => unsubscribe();
            }, []);
            
            // NEW V1.6 - Real-time Firebase sync for activity logs
            useEffect(() => {
                console.log('ðŸ“Š Setting up activity log sync...');
                
                const unsubscribe = window.db.collection('activityLog')
                    .orderBy('timestamp', 'desc') // Most recent first
                    .limit(500) // Limit to last 500 activities
                    .onSnapshot(
                        (snapshot) => {
                            if (!snapshot.empty) {
                                const activities = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }));
                                console.log(`âœ… Activity logs synced: ${activities.length} activities`);
                                setActivityLogs(activities);
                            } else {
                                console.log('ðŸ“Š No activity logs in Firebase yet');
                                setActivityLogs([]);
                            }
                        },
                        (error) => {
                            console.error('âŒ Activity log sync error:', error);
                        }
                    );
                
                return () => unsubscribe();
            }, []);
            
            // Real-time Firebase sync for water stock - NEW FEATURE V1.2
            useEffect(() => {
                console.log('ðŸ’§ Setting up water stock sync...');
                
                const unsubscribe = window.db.collection('settings').doc('waterStock').onSnapshot(
                    (doc) => {
                        if (doc.exists && doc.data()) {
                            const data = doc.data();
                            console.log('âœ… Water stock synced from Firebase');
                            setWaterStock({
                                currentPallets: data.currentPallets || 9,
                                maxPallets: data.maxPallets || 15,
                                bottlesPerPallet: data.bottlesPerPallet || 840
                            });
                        } else {
                            console.log('ðŸ’§ No water stock in Firebase, using defaults');
                        }
                    },
                    (error) => {
                        console.error('âŒ Water stock sync error:', error);
                    }
                );
                
                return () => unsubscribe();
            }, []);
            
            // Function to save water stock to Firebase
            const saveWaterStock = async (newWaterStock) => {
                try {
                    await window.db.collection('settings').doc('waterStock').set(newWaterStock);
                    console.log('ðŸ’§ Water stock saved to Firebase');
                    return true;
                } catch (error) {
                    console.error('âŒ Water stock save error:', error);
                    alert(`Error saving water stock: ${error.message}`);
                    return false;
                }
            };
            
            // Real-time Firebase sync for shelf images - NEW FEATURE V1.2
            useEffect(() => {
                console.log('ðŸ“¸ Setting up shelf images sync...');
                
                const unsubscribe = window.db.collection('settings').doc('shelfImages').onSnapshot(
                    (doc) => {
                        if (doc.exists && doc.data()) {
                            const data = doc.data();
                            console.log('âœ… Shelf images synced from Firebase');
                            setShelfImages(data.images || {});
                        } else {
                            console.log('ðŸ“¸ No shelf images in Firebase yet');
                        }
                    },
                    (error) => {
                        console.error('âŒ Shelf images sync error:', error);
                    }
                );
                
                return () => unsubscribe();
            }, []);
            
            // NEW V2.0.1 - Extract unique suppliers from items for dynamic dropdown
            useEffect(() => {
                if (items.length === 0) return;
                
                // Extract all suppliers that are not empty or 'TBD'
                const suppliersSet = new Set();
                
                items.forEach(item => {
                    if (item.supplier && item.supplier.trim() !== '' && item.supplier !== 'TBD') {
                        suppliersSet.add(item.supplier.trim());
                    }
                });
                
                // Convert to array and sort alphabetically
                const suppliersList = Array.from(suppliersSet).sort((a, b) => a.localeCompare(b));
                
                // Add the default suppliers if not already present
                const defaultSuppliers = ['Westair', 'Gibraltar Heritage Trust', 'Gibraltar Stamps', 'Pageant Pewter'];
                defaultSuppliers.forEach(supplier => {
                    if (!suppliersList.includes(supplier)) {
                        suppliersList.push(supplier);
                    }
                });
                
                // Sort again after adding defaults
                suppliersList.sort((a, b) => a.localeCompare(b));
                
                // Always include 'TBD' at the end
                suppliersList.push('TBD');
                
                setUniqueSuppliers(suppliersList);
                console.log(`ðŸ“Š Extracted ${suppliersList.length} unique suppliers`);
            }, [items]); // Re-run whenever items change
            
            // NEW V2.1.2 - Extract unique categories from items for dynamic dropdown
            useEffect(() => {
                if (items.length === 0) {
                    // Even if no items, include Bar Stock so users can add first item
                    setUniqueCategories(['Bar Stock']);
                    return;
                }
                
                // Extract all unique categories from items
                const categoriesSet = new Set();
                
                items.forEach(item => {
                    if (item.category && item.category.trim() !== '') {
                        categoriesSet.add(item.category.trim());
                    }
                });
                
                // Convert to array and sort alphabetically
                let categoriesList = Array.from(categoriesSet).sort((a, b) => a.localeCompare(b));
                
                // Always include 'Bar Stock' even if no items have it yet
                if (!categoriesList.includes('Bar Stock')) {
                    categoriesList.unshift('Bar Stock'); // Add at beginning
                }
                
                setUniqueCategories(categoriesList);
                console.log(`ðŸ“Š Extracted ${categoriesList.length} unique categories`);
            }, [items]); // Re-run whenever items change
            
            // Function to upload shelf image
            const uploadShelfImage = async (shelfId, file) => {
                if (!file) return false;
                
                try {
                    console.log(`ðŸ“¸ Starting upload for shelf ${shelfId}...`);
                    setUploadingShelfImage(shelfId);
                    
                    // Compress image before upload
                    console.log(`ðŸ”„ Compressing image...`);
                    const compressed = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                let width = img.width;
                                let height = img.height;
                                
                                console.log(`ðŸ“ Original size: ${width}x${height}`);
                                
                                // Resize if too large (max 1200px width)
                                if (width > 1200) {
                                    height = (height * 1200) / width;
                                    width = 1200;
                                    console.log(`ðŸ“ Resized to: ${width}x${height}`);
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                canvas.toBlob((blob) => {
                                    console.log(`âœ… Compressed to ${(blob.size / 1024).toFixed(2)} KB`);
                                    resolve(blob);
                                }, 'image/jpeg', 0.8);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                    
                    // Convert to base64 for storage in Firestore
                    console.log(`ðŸ”„ Converting to base64...`);
                    const base64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            console.log(`âœ… Base64 created (${(e.target.result.length / 1024).toFixed(2)} KB)`);
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(compressed);
                    });
                    
                    // Update local state immediately for instant display
                    const updatedImages = {
                        ...shelfImages,
                        [shelfId]: base64
                    };
                    console.log(`ðŸ”„ Updating local state for shelf ${shelfId}...`);
                    setShelfImages(updatedImages);
                    console.log(`âœ… Local state updated! Image should display now.`);
                    
                    // Save to Firebase (listener will sync to other devices)
                    console.log(`ðŸ”„ Saving to Firebase...`);
                    await window.db.collection('settings').doc('shelfImages').set({
                        images: updatedImages
                    });
                    
                    console.log(`âœ… Image uploaded for shelf ${shelfId} and synced to Firebase!`);
                    setUploadingShelfImage(null);
                    return true;
                } catch (error) {
                    console.error('âŒ Image upload error:', error);
                    alert(`Error uploading image: ${error.message}`);
                    setUploadingShelfImage(null);
                    return false;
                }
            };
            
            // Function to delete shelf image
            const deleteShelfImage = async (shelfId) => {
                try {
                    const updatedImages = {...shelfImages};
                    delete updatedImages[shelfId];
                    
                    // Update local state immediately
                    setShelfImages(updatedImages);
                    
                    // Save to Firebase
                    await window.db.collection('settings').doc('shelfImages').set({
                        images: updatedImages
                    });
                    
                    console.log(`ðŸ—‘ï¸ Image deleted for shelf ${shelfId}`);
                    return true;
                } catch (error) {
                    console.error('âŒ Image delete error:', error);
                    alert(`Error deleting image: ${error.message}`);
                    return false;
                }
            };
            
            // Function to save an item to Firebase
            const saveItemToFirebase = async (item) => {
                try {
                    if (item.id) {
                        // Update existing item
                        await window.db.collection('inventory').doc(item.id).update(item);
                        console.log(`ðŸ’¾ Saved: ${item.name}`);
                    } else {
                        // Add new item
                        const docRef = await window.db.collection('inventory').add(item);
                        console.log(`âž• Added: ${item.name} (${docRef.id})`);
                    }
                    return true;
                } catch (error) {
                    console.error('âŒ Save error:', error);
                    alert(`Error saving ${item.name}: ${error.message}`);
                    return false;
                }
            };
            
            // Function to update item quantity (used by stock count page)
            const updateItemQuantity = async (itemId, newQuantityShop, newQuantityStore) => {
                const item = items.find(i => i.id === itemId);
                if (!item) return;
                
                const oldShop = item.quantityShop || 0;
                const oldStore = item.quantityStore || 0;
                const oldTotal = item.quantity || 0;
                
                const updatedItem = {
                    ...item,
                    quantityShop: newQuantityShop,
                    quantityStore: newQuantityStore,
                    quantity: newQuantityShop + newQuantityStore,
                    lastRestocked: new Date().toISOString().split('T')[0]
                };
                
                await saveItemToFirebase(updatedItem);
                
                // NEW V1.6 - Log stock change
                if (oldShop !== newQuantityShop || oldStore !== newQuantityStore) {
                    await logActivity(
                        'stock_change',
                        `Stock updated for ${item.name}`,
                        {
                            itemId: item.id,
                            itemName: item.name,
                            changes: `Shop: ${oldShop} â†’ ${newQuantityShop}, Storage: ${oldStore} â†’ ${newQuantityStore}, Total: ${oldTotal} â†’ ${newQuantityShop + newQuantityStore}`
                        }
                    );
                }
            };
            
            // Edit Item Functions - NEW FEATURE V1.2
            const openEditModal = (item) => {
                setEditingItem(item);
                setEditForm({
                    name: item.name || '',
                    category: item.category || '',
                    location: item.location || '',
                    supplier: item.supplier || 'TBD',
                    criticalLevel: item.criticalLevel || 5,
                    warningLevel: item.warningLevel || 10,
                    tag: item.tag || ''
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!editingItem || !editForm.name.trim()) {
                    alert('Item name is required');
                    return;
                }
                
                const updatedItem = {
                    ...editingItem,
                    name: editForm.name.trim(),
                    category: editForm.category,
                    location: editForm.location,
                    supplier: editForm.supplier,
                    criticalLevel: parseInt(editForm.criticalLevel) || 5,
                    warningLevel: parseInt(editForm.warningLevel) || 10,
                    tag: editForm.tag
                };
                
                const success = await saveItemToFirebase(updatedItem);
                
                if (success) {
                    // NEW V1.6 - Log the edit activity
                    const changes = [];
                    if (editingItem.name !== updatedItem.name) changes.push(`name: "${editingItem.name}" â†’ "${updatedItem.name}"`);
                    if (editingItem.category !== updatedItem.category) changes.push(`category: "${editingItem.category}" â†’ "${updatedItem.category}"`);
                    if (editingItem.location !== updatedItem.location) changes.push(`location: "${editingItem.location}" â†’ "${updatedItem.location}"`);
                    if (editingItem.supplier !== updatedItem.supplier) changes.push(`supplier: "${editingItem.supplier || 'None'}" â†’ "${updatedItem.supplier || 'None'}"`);
                    
                    if (changes.length > 0) {
                        await logActivity(
                            'item_edit',
                            `Edited ${updatedItem.name}`,
                            {
                                itemId: editingItem.id,
                                itemName: updatedItem.name,
                                changes: changes.join(', ')
                            }
                        );
                    }
                    
                    // Also update reorder list if item is there
                    try {
                        const reorderDoc = await window.db.collection('reorderList').doc(editingItem.id).get();
                        if (reorderDoc.exists) {
                            await window.db.collection('reorderList').doc(editingItem.id).update({
                                name: updatedItem.name,
                                category: updatedItem.category,
                                supplier: updatedItem.supplier
                            });
                        }
                    } catch (error) {
                        console.log('Item not in reorder list, skipping update');
                    }
                    
                    setShowEditModal(false);
                    setEditingItem(null);
                }
            };

            const handleDeleteItem = async () => {
                if (!editingItem) return;
                
                const confirmDelete = window.confirm(
                    `Are you sure you want to delete "${editingItem.name}"?\n\nThis action cannot be undone.`
                );
                
                if (!confirmDelete) return;
                
                try {
                    // Delete from main inventory
                    await window.db.collection('inventory').doc(editingItem.id).delete();
                    console.log('âœ… Item deleted from inventory');
                    
                    // NEW V1.6 - Log the deletion
                    await logActivity(
                        'item_delete',
                        `Deleted ${editingItem.name}`,
                        {
                            itemName: editingItem.name,
                            category: editingItem.category,
                            location: editingItem.location,
                            lastQuantity: editingItem.quantity
                        }
                    );
                    
                    // Also delete from reorder list if it exists there
                    try {
                        await window.db.collection('reorderList').doc(editingItem.id).delete();
                        console.log('âœ… Item removed from reorder list');
                    } catch (error) {
                        console.log('Item was not in reorder list');
                    }
                    
                    alert(`"${editingItem.name}" has been deleted successfully.`);
                    setShowEditModal(false);
                    setEditingItem(null);
                } catch (error) {
                    console.error('âŒ Error deleting item:', error);
                    alert(`Error deleting item: ${error.message}`);
                }
            };

            // Search filtering
            const searchResults = useMemo(() => {
                if (!searchQuery) return [];
                const query = searchQuery.toLowerCase();
                return items.filter(item =>
                    item.name.toLowerCase().includes(query) ||
                    item.category.toLowerCase().includes(query) ||
                    item.location.toLowerCase().includes(query)
                );
            }, [searchQuery, items]);

            // Zone data
            const zones = {
                'A': { name: 'Zone A', description: 'Shop Merchandise', shelves: 6, color: '#4A90E2' },
                'B': { name: 'Zone B', description: 'Bar Stock & Food', shelves: 6, color: '#E24A4A' },
                'C': { name: 'Zone C', description: 'Events & Glassware', shelves: 6, color: '#FF8C42' }
            };

            // Get items for a specific zone
            const getZoneItems = (zone) => {
                return items.filter(item => item.location && item.location.startsWith(zone));
            };

            // Get items for a specific shelf
            const getShelfItems = (shelf) => {
                return items.filter(item => item.location && item.location.startsWith(shelf));
            };

            // Get alert level for an item based on total quantity
            const getAlertLevel = (item) => {
                const totalQty = item.quantity || 0;
                const critical = item.criticalLevel || 5;
                const warning = item.warningLevel || 10;
                
                if (totalQty <= critical) return 'critical';
                if (totalQty <= warning) return 'warning';
                return 'good';
            };
            
            // Get alert color for an item
            const getAlertColor = (item) => {
                const level = getAlertLevel(item);
                if (level === 'critical') return '#f44336'; // Red
                if (level === 'warning') return '#ff9800'; // Orange
                return '#4caf50'; // Green
            };
            
            // Get alert border style
            const getAlertBorder = (item) => {
                const level = getAlertLevel(item);
                if (level === 'critical') return '3px solid #f44336';
                if (level === 'warning') return '3px solid #ff9800';
                return '1px solid #ddd';
            };
            
            // Check if item is on reorder list
            const isOnReorderList = (itemId) => {
                return reorderList.some(r => r.id === itemId);
            };
            
            // Toggle item on reorder list
            const toggleReorderList = async (item) => {
                try {
                    if (isOnReorderList(item.id)) {
                        // Remove from Firebase
                        await window.db.collection('reorderList').doc(item.id).delete();
                        console.log(`ðŸ—‘ï¸ Removed from reorder list: ${item.name}`);
                        
                        // NEW V1.6 - Log reorder removal
                        await logActivity(
                            'reorder_remove',
                            `Removed ${item.name} from reorder list`,
                            {
                                itemId: item.id,
                                itemName: item.name
                            }
                        );
                    } else {
                        // Add to Firebase with default values for undefined fields
                        const reorderItem = {
                            id: item.id,
                            name: item.name || 'Unnamed Item',
                            category: item.category || 'Uncategorized',
                            currentQty: item.quantity || 0,
                            criticalLevel: item.criticalLevel || 5,  // Default to 5
                            warningLevel: item.warningLevel || 10,   // Default to 10
                            reorderPoint: item.reorderPoint || 10,   // Default to 10
                            supplier: item.supplier || 'TBD',
                            addedDate: new Date().toISOString()
                        };
                        await window.db.collection('reorderList').doc(item.id).set(reorderItem);
                        console.log(`âž• Added to reorder list: ${item.name}`);
                        
                        // NEW V1.6 - Log reorder addition
                        await logActivity(
                            'reorder_add',
                            `Added ${item.name} to reorder list`,
                            {
                                itemId: item.id,
                                itemName: item.name,
                                currentQty: item.quantity,
                                supplier: item.supplier || 'TBD'
                            }
                        );
                    }
                } catch (error) {
                    console.error('âŒ Reorder list error:', error);
                    alert(`Error updating reorder list: ${error.message}`);
                }
            };
            
            // NEW V1.4 - Note editing functions
            const openNoteEditor = (item) => {
                setEditingNoteItem(item);
                // Get existing note if any
                const existingNote = item.notes && item.notes.length > 0 ? item.notes[0].text : '';
                setNoteText(existingNote);
            };
            
            const saveNote = async () => {
                if (!editingNoteItem) return;
                
                try {
                    const updatedNotes = noteText.trim() ? [
                        {
                            text: noteText.trim(),
                            date: new Date().toISOString(),
                            author: 'Staff' // Could be replaced with actual user name
                        }
                    ] : [];
                    
                    const updatedItem = {
                        ...editingNoteItem,
                        notes: updatedNotes
                    };
                    
                    await saveItemToFirebase(updatedItem);
                    
                    // NEW V1.6 - Log note addition/edit
                    await logActivity(
                        'note_edit',
                        noteText.trim() ? `Added note to ${editingNoteItem.name}` : `Removed note from ${editingNoteItem.name}`,
                        {
                            itemId: editingNoteItem.id,
                            itemName: editingNoteItem.name,
                            noteText: noteText.trim() || '(removed)'
                        }
                    );
                    
                    setEditingNoteItem(null);
                    setNoteText('');
                } catch (error) {
                    console.error('Error saving note:', error);
                    alert(`Error saving note: ${error.message}`);
                }
            };
            
            const cancelNoteEdit = () => {
                setEditingNoteItem(null);
                setNoteText('');
            };
            
            // NEW V1.6 - Activity Logging Function
            const logActivity = async (type, description, details = {}) => {
                try {
                    const activity = {
                        type: type, // e.g., 'stock_change', 'item_edit', 'reorder_add', etc.
                        description: description, // Human-readable description
                        details: details, // Additional data (itemName, oldValue, newValue, etc.)
                        timestamp: Date.now(),
                        date: new Date().toISOString(),
                        user: 'Staff' // Could be enhanced with actual user names
                    };
                    
                    await window.db.collection('activityLog').add(activity);
                    console.log(`ðŸ“Š Activity logged: ${type} - ${description}`);
                } catch (error) {
                    console.error('âŒ Error logging activity:', error);
                    // Don't alert user - activity logging should be silent
                }
            };
            
            // NEW V1.6.1 - Generate Retroactive Activities (ONE-TIME USE)
            const generateRetroactiveActivities = async () => {
                if (!confirm('This will create activity logs for recent changes based on current data.\n\nThis should only be done ONCE.\n\nContinue?')) {
                    return;
                }
                
                let activitiesCreated = 0;
                const now = Date.now();
                const sevenDaysAgo = now - (7 * 24 * 60 * 60 * 1000);
                
                try {
                    // 1. Create activities for items with recent lastRestocked dates
                    console.log('ðŸ“Š Generating stock change activities...');
                    for (const item of items) {
                        if (item.lastRestocked) {
                            const restockDate = new Date(item.lastRestocked).getTime();
                            if (restockDate > sevenDaysAgo) {
                                await window.db.collection('activityLog').add({
                                    type: 'stock_change',
                                    description: `Stock updated for ${item.name}`,
                                    details: {
                                        itemId: item.id,
                                        itemName: item.name,
                                        changes: `Current stock: Shop ${item.quantityShop || 0}, Storage ${item.quantityStore || 0}, Total ${item.quantity || 0}`
                                    },
                                    timestamp: restockDate,
                                    date: item.lastRestocked,
                                    user: 'Staff (retroactive)'
                                });
                                activitiesCreated++;
                            }
                        }
                    }
                    
                    // 2. Create activities for items on reorder list
                    console.log('ðŸ“Š Generating reorder activities...');
                    for (const reorderItem of reorderList) {
                        if (reorderItem.addedDate) {
                            const addedTime = new Date(reorderItem.addedDate).getTime();
                            if (addedTime > sevenDaysAgo) {
                                await window.db.collection('activityLog').add({
                                    type: 'reorder_add',
                                    description: `Added ${reorderItem.name} to reorder list`,
                                    details: {
                                        itemId: reorderItem.id,
                                        itemName: reorderItem.name,
                                        currentQty: reorderItem.currentQty,
                                        supplier: reorderItem.supplier || 'TBD'
                                    },
                                    timestamp: addedTime,
                                    date: reorderItem.addedDate,
                                    user: 'Staff (retroactive)'
                                });
                                activitiesCreated++;
                            }
                        }
                    }
                    
                    // 3. Create activities for items with notes
                    console.log('ðŸ“Š Generating note activities...');
                    for (const item of items) {
                        if (item.notes && item.notes.length > 0) {
                            const note = item.notes[0];
                            if (note.date) {
                                const noteTime = new Date(note.date).getTime();
                                if (noteTime > sevenDaysAgo) {
                                    await window.db.collection('activityLog').add({
                                        type: 'note_edit',
                                        description: `Added note to ${item.name}`,
                                        details: {
                                            itemId: item.id,
                                            itemName: item.name,
                                            noteText: note.text
                                        },
                                        timestamp: noteTime,
                                        date: note.date,
                                        user: 'Staff (retroactive)'
                                    });
                                    activitiesCreated++;
                                }
                            }
                        }
                    }
                    
                    alert(`âœ… Successfully created ${activitiesCreated} retroactive activity logs!\n\nThese represent actions from the last 7 days based on timestamps in your data.`);
                    console.log(`âœ… Created ${activitiesCreated} retroactive activities`);
                    
                } catch (error) {
                    console.error('âŒ Error generating retroactive activities:', error);
                    alert(`Error generating activities: ${error.message}`);
                }
            };
            
            // NEW V1.4 - Hide/unhide items from alerts
            const toggleHideItem = async (itemId) => {
                const newHidden = hiddenAlertItems.includes(itemId)
                    ? hiddenAlertItems.filter(id => id !== itemId)
                    : [...hiddenAlertItems, itemId];
                
                setHiddenAlertItems(newHidden);
                
                // Save to localStorage
                try {
                    localStorage.setItem('hiddenAlertItems', JSON.stringify(newHidden));
                } catch (error) {
                    console.error('Error saving hidden items:', error);
                }
            };
            
            // Load hidden items from localStorage on mount
            useEffect(() => {
                const savedHidden = localStorage.getItem('hiddenAlertItems');
                if (savedHidden) {
                    try {
                        setHiddenAlertItems(JSON.parse(savedHidden));
                    } catch (error) {
                        console.error('Error loading hidden items:', error);
                    }
                }
            }, []);

            const renderSearch = () => (
                <div className="search-container">
                    <h2 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>ðŸ” Search Inventory</h2>
                    <input
                        type="text"
                        className="search-box"
                        placeholder="Search by item name, category, or location..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                    />

                    {searchQuery && (
                        <div className="search-results">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--text-gray)' }}>
                                Found {searchResults.length} results
                            </h3>
                            {searchResults.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">ðŸ“¦</div>
                                    <p>No items found matching "{searchQuery}"</p>
                                </div>
                            ) : (
                                searchResults.map(item => {
                                    // Use actual item quantities instead of old demo data
                                    const stock = { 
                                        shopFloor: item.quantityShop || 0, 
                                        storage: item.quantityStore || 0, 
                                        lastRestocked: item.lastRestocked || 'Unknown', 
                                        notes: item.notes || [] 
                                    };
                                    const totalStock = stock.shopFloor + stock.storage;
                                    const isLowStock = stock.shopFloor < 5;
                                    const alertLevel = getAlertLevel(item);
                                    const alertBorder = getAlertBorder(item);
                                    
                                    return (
                                        <div key={item.id} className="result-item" style={{ border: alertBorder }}>
                                            {/* Alert Status Badge */}
                                            {alertLevel !== 'good' && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '10px',
                                                    right: '10px',
                                                    background: alertLevel === 'critical' ? '#f44336' : '#ff9800',
                                                    color: 'white',
                                                    padding: '0.25rem 0.75rem',
                                                    borderRadius: '12px',
                                                    fontSize: '0.75rem',
                                                    fontWeight: 'bold'
                                                }}>
                                                    {alertLevel === 'critical' ? 'ðŸ”´ CRITICAL' : 'ðŸŸ¡ LOW STOCK'}
                                                </div>
                                            )}
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                                <div style={{ flex: 1 }}>
                                                    <h3>{item.name}</h3>
                                                    <p><strong>Category:</strong> {item.category}</p>
                                                    <div style={{ marginTop: '0.5rem', display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
                                                        <span style={{ fontSize: '0.9rem' }}>
                                                            ðŸª Shop: <strong style={{ color: isLowStock ? '#f44336' : '#4CAF50' }}>{stock.shopFloor}</strong>
                                                        </span>
                                                        <span style={{ fontSize: '0.9rem' }}>
                                                            ðŸ“¦ Storage: <strong>{stock.storage}</strong>
                                                        </span>
                                                        <span style={{ fontSize: '0.9rem', color: 'var(--text-gray)' }}>
                                                            Total: {totalStock}
                                                        </span>
                                                    </div>
                                                    {isLowStock && (
                                                        <div style={{ 
                                                            marginTop: '0.5rem', 
                                                            padding: '0.25rem 0.5rem', 
                                                            background: '#fff3cd', 
                                                            borderRadius: '4px',
                                                            fontSize: '0.85rem',
                                                            display: 'inline-block'
                                                        }}>
                                                            âš ï¸ Low stock on shop floor - restock soon
                                                        </div>
                                                    )}
                                                    <div style={{ marginTop: '0.5rem', fontSize: '0.85rem', color: 'var(--text-gray)' }}>
                                                        Last restocked: {stock.lastRestocked}
                                                    </div>
                                                    
                                                    {/* NEW V1.4 - Editable Notes Section */}
                                                    {editingNoteItem && editingNoteItem.id === item.id ? (
                                                        <div style={{ 
                                                            marginTop: '0.5rem', 
                                                            padding: '0.75rem', 
                                                            background: '#fff9c4', 
                                                            borderRadius: '4px',
                                                            border: '2px solid #fbc02d'
                                                        }}>
                                                            <div style={{ marginBottom: '0.5rem', fontWeight: 'bold', fontSize: '0.9rem' }}>
                                                                âœï¸ Edit Note
                                                            </div>
                                                            <textarea
                                                                value={noteText}
                                                                onChange={(e) => setNoteText(e.target.value)}
                                                                placeholder="Add a note about this item..."
                                                                style={{
                                                                    width: '100%',
                                                                    minHeight: '60px',
                                                                    padding: '0.5rem',
                                                                    border: '1px solid #ddd',
                                                                    borderRadius: '4px',
                                                                    fontSize: '0.85rem',
                                                                    resize: 'vertical',
                                                                    fontFamily: 'inherit'
                                                                }}
                                                            />
                                                            <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.5rem' }}>
                                                                <button
                                                                    onClick={saveNote}
                                                                    style={{
                                                                        background: '#4caf50',
                                                                        color: 'white',
                                                                        border: 'none',
                                                                        padding: '0.4rem 0.8rem',
                                                                        borderRadius: '4px',
                                                                        fontSize: '0.8rem',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '600'
                                                                    }}
                                                                >
                                                                    ðŸ’¾ Save
                                                                </button>
                                                                <button
                                                                    onClick={cancelNoteEdit}
                                                                    style={{
                                                                        background: '#999',
                                                                        color: 'white',
                                                                        border: 'none',
                                                                        padding: '0.4rem 0.8rem',
                                                                        borderRadius: '4px',
                                                                        fontSize: '0.8rem',
                                                                        cursor: 'pointer'
                                                                    }}
                                                                >
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <>
                                                            {stock.notes.length > 0 ? (
                                                                <div style={{ 
                                                                    marginTop: '0.5rem', 
                                                                    padding: '0.5rem', 
                                                                    background: '#e3f2fd', 
                                                                    borderRadius: '4px',
                                                                    fontSize: '0.85rem',
                                                                    display: 'flex',
                                                                    justifyContent: 'space-between',
                                                                    alignItems: 'start'
                                                                }}>
                                                                    <div style={{ flex: 1 }}>
                                                                        ðŸ’¬ <strong>Note:</strong> {stock.notes[0].text}
                                                                        {stock.notes.length > 1 && (
                                                                            <span style={{ marginLeft: '0.5rem', color: 'var(--primary-orange)' }}>
                                                                                +{stock.notes.length - 1} more
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                    <button
                                                                        onClick={() => openNoteEditor(item)}
                                                                        style={{
                                                                            background: 'transparent',
                                                                            border: 'none',
                                                                            color: '#1976d2',
                                                                            cursor: 'pointer',
                                                                            padding: '0 0.5rem',
                                                                            fontSize: '0.85rem',
                                                                            fontWeight: '600'
                                                                        }}
                                                                    >
                                                                        âœï¸ Edit
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <button
                                                                    onClick={() => openNoteEditor(item)}
                                                                    style={{
                                                                        marginTop: '0.5rem',
                                                                        background: '#e3f2fd',
                                                                        border: '1px dashed #2196f3',
                                                                        padding: '0.5rem',
                                                                        borderRadius: '4px',
                                                                        fontSize: '0.85rem',
                                                                        cursor: 'pointer',
                                                                        color: '#1976d2',
                                                                        width: '100%',
                                                                        textAlign: 'left'
                                                                    }}
                                                                >
                                                                    ðŸ’¬ Add note...
                                                                </button>
                                                            )}
                                                        </>
                                                    )}
                                                    
                                                    {/* Display shift log notes linked to this item */}
                                                    {(() => {
                                                        const relatedLogs = logs.filter(log => 
                                                            log.linkedItems && log.linkedItems.includes(item.id)
                                                        );
                                                        
                                                        if (relatedLogs.length === 0) return null;
                                                        
                                                        return (
                                                            <div style={{ 
                                                                marginTop: '0.5rem', 
                                                                padding: '0.75rem', 
                                                                background: '#f3e5f5', 
                                                                borderRadius: '4px',
                                                                fontSize: '0.85rem',
                                                                borderLeft: '3px solid #9c27b0'
                                                            }}>
                                                                <strong style={{ color: '#9c27b0' }}>ðŸ“‹ Shift Log Notes ({relatedLogs.length}):</strong>
                                                                {relatedLogs.slice(0, 2).map((log, idx) => {
                                                                    const logDate = new Date(log.date).toLocaleDateString('en-GB', { 
                                                                        month: 'short', 
                                                                        day: 'numeric' 
                                                                    });
                                                                    
                                                                    return (
                                                                        <div key={idx} style={{ marginTop: '0.5rem', paddingLeft: '0.5rem' }}>
                                                                            <div style={{ color: '#666', fontSize: '0.8rem' }}>
                                                                                {logDate} - {log.staffName}
                                                                            </div>
                                                                            {log.selling && (
                                                                                <div style={{ marginTop: '0.25rem' }}>
                                                                                    ðŸ’° {log.selling}
                                                                                </div>
                                                                            )}
                                                                            {log.requests && (
                                                                                <div style={{ marginTop: '0.25rem' }}>
                                                                                    ðŸ™‹ {log.requests}
                                                                                </div>
                                                                            )}
                                                                            {log.issues && (
                                                                                <div style={{ marginTop: '0.25rem' }}>
                                                                                    âš ï¸ {log.issues}
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    );
                                                                })}
                                                                {relatedLogs.length > 2 && (
                                                                    <div style={{ marginTop: '0.5rem', color: '#9c27b0', fontStyle: 'italic' }}>
                                                                        +{relatedLogs.length - 2} more notes in Shift Log tab
                                                                    </div>
                                                                )}
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', marginLeft: '1rem' }}>
                                                    <button
                                                        onClick={() => openEditModal(item)}
                                                        style={{
                                                            background: 'var(--primary-orange)',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.5rem 1rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem',
                                                            whiteSpace: 'nowrap',
                                                            fontWeight: '600'
                                                        }}
                                                    >
                                                        âœï¸ Edit
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setEditingAlertItem(item);
                                                            setAlertValues({
                                                                critical: item.criticalLevel || 5,
                                                                warning: item.warningLevel || 10
                                                            });
                                                        }}
                                                        style={{
                                                            background: '#2196f3',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.5rem 1rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem',
                                                            whiteSpace: 'nowrap'
                                                        }}
                                                    >
                                                        âš™ï¸ Set Alerts
                                                    </button>
                                                    <button
                                                        onClick={() => toggleReorderList(item)}
                                                        style={{
                                                            background: isOnReorderList(item.id) ? '#4caf50' : '#9c27b0',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.5rem 1rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem',
                                                            whiteSpace: 'nowrap'
                                                        }}
                                                    >
                                                        {isOnReorderList(item.id) ? 'âœ“ On List' : 'ðŸ“‹ Reorder'}
                                                    </button>
                                                    {(item.quantityStore || 0) > 0 && (
                                                        <button
                                                            onClick={() => {
                                                                const storageQty = item.quantityStore || 0;
                                                                const quantity = prompt(`Transfer from storage to shop:\n\nAvailable in storage: ${storageQty}\n\nHow many to transfer?`, '0');
                                                                if (quantity && parseInt(quantity) > 0) {
                                                                    const qty = parseInt(quantity);
                                                                    if (qty > storageQty) {
                                                                        alert(`âŒ Cannot transfer ${qty} - only ${storageQty} in storage!`);
                                                                        return;
                                                                    }
                                                                    
                                                                    const newShop = (item.quantityShop || 0) + qty;
                                                                    const newStorage = storageQty - qty;
                                                                    
                                                                    saveItemToFirebase({
                                                                        ...item,
                                                                        quantityShop: newShop,
                                                                        quantityStore: newStorage
                                                                    }).then(() => {
                                                                        alert(`âœ… Transferred ${qty} to shop!\n\nShop: ${newShop}\nStorage: ${newStorage}`);
                                                                    });
                                                                }
                                                            }}
                                                            style={{
                                                                background: '#ff9800',
                                                                color: 'white',
                                                                border: 'none',
                                                                padding: '0.5rem 1rem',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                fontSize: '0.85rem',
                                                                whiteSpace: 'nowrap'
                                                            }}
                                                        >
                                                            â†—ï¸ Transfer ({item.quantityStore})
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => {
                                                            setSelectedItem(item);
                                                            setShowNotesModal(true);
                                                        }}
                                                        style={{
                                                            background: 'var(--primary-orange)',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.5rem 1rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem',
                                                            whiteSpace: 'nowrap'
                                                        }}
                                                    >
                                                        ðŸ“ Notes ({stock.notes.length})
                                                    </button>
                                                </div>
                                            </div>
                                            <div style={{ marginTop: '0.75rem' }}>
                                                <span className="result-location">ðŸ“ {item.location || 'Location TBD'}</span>
                                                <span className="result-tag">{item.tag}</span>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    )}

                    {!searchQuery && (
                        <div className="empty-state">
                            <div className="empty-state-icon">ðŸ”</div>
                            <p>Start typing to search your inventory</p>
                            <p style={{ fontSize: '0.85rem', marginTop: '0.5rem' }}>
                                Try searching for "Spitfire", "Wine", "A1", etc.
                            </p>
                        </div>
                    )}
                </div>
            );

            
            const renderFirebasePage = () => {
                // Initial upload function - uploads all base items from inventoryData
                const uploadAllItemsToFirebase = async () => {
                    if (!confirm(`This will REPLACE all ${items.length} items in Firebase with the ${inventoryData.length} base items from the hardcoded data. Any new items you've added will be lost. Continue?`)) return;
                    
                    setIsUploading(true);
                    setUploadProgress(0);
                    
                    try {
                        const db = window.db;
                        
                        // Step 1: Clear existing items
                        console.log('Clearing existing Firebase data...');
                        const existingDocs = await db.collection('inventory').get();
                        for (const doc of existingDocs.docs) {
                            await doc.ref.delete();
                        }
                        
                        // Step 2: Upload all base items
                        console.log(`Uploading ${inventoryData.length} base items...`);
                        for (let i = 0; i < inventoryData.length; i++) {
                            const item = inventoryData[i];
                            await db.collection('inventory').add(item);
                            setUploadProgress(Math.round(((i + 1) / inventoryData.length) * 100));
                        }
                        
                        alert(`âœ… Success! Uploaded ${inventoryData.length} items to Firebase`);
                        setIsUploading(false);
                        setUploadProgress(0);
                    } catch (error) {
                        console.error('Upload error:', error);
                        alert(`âŒ Upload error: ${error.message}`);
                        setIsUploading(false);
                        setUploadProgress(0);
                    }
                };
                
                // Excel export function
                const exportToExcel = () => {
                    const data = items.map(item => ({
                        'Item Name': item.name,
                        'Category': item.category,
                        'Location': item.location || '',
                        'Shop Quantity': item.quantityShop || 0,
                        'Storage Quantity': item.quantityStore || 0,
                        'Total Quantity': item.quantity || 0,
                        'Min Stock': item.minStock || 5,
                        'Reorder Point': item.reorderPoint || 10,
                        'Supplier': item.supplier || '',
                        'Last Restocked': item.lastRestocked || '',
                        'Last Counted': item.lastCounted || ''
                    }));
                    
                    // Convert to CSV
                    const headers = Object.keys(data[0]);
                    const csvContent = [
                        headers.join(','),
                        ...data.map(row => 
                            headers.map(header => {
                                const value = row[header];
                                // Wrap in quotes if contains comma
                                return typeof value === 'string' && value.includes(',') 
                                    ? `"${value}"` 
                                    : value;
                            }).join(',')
                        )
                    ].join('\n');
                    
                    // Download
                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `inventory-export-${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                };
                
                // Excel import function
                const importFromExcel = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const text = e.target.result;
                            const lines = text.split('\n').filter(line => line.trim());
                            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                            
                            let updatedCount = 0;
                            let newCount = 0;
                            
                            for (let i = 1; i < lines.length; i++) {
                                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                                const row = {};
                                headers.forEach((header, idx) => {
                                    row[header] = values[idx];
                                });
                                
                                // Find item by name
                                const existingItem = items.find(item => 
                                    item.name.toLowerCase() === row['Item Name']?.toLowerCase()
                                );
                                
                                const itemData = {
                                    name: row['Item Name'],
                                    category: row['Category'] || 'General',
                                    location: row['Location'] || '',
                                    quantityShop: parseInt(row['Shop Quantity']) || 0,
                                    quantityStore: parseInt(row['Storage Quantity']) || 0,
                                    quantity: parseInt(row['Total Quantity']) || 0,
                                    minStock: parseInt(row['Min Stock']) || 5,
                                    reorderPoint: parseInt(row['Reorder Point']) || 10,
                                    supplier: row['Supplier'] || 'TBD',
                                    lastRestocked: row['Last Restocked'] || new Date().toISOString().split('T')[0],
                                    lastCounted: row['Last Counted'] || ''
                                };
                                
                                if (existingItem) {
                                    // Update existing
                                    await saveItemToFirebase({ ...existingItem, ...itemData });
                                    updatedCount++;
                                } else {
                                    // Add new
                                    await saveItemToFirebase(itemData);
                                    newCount++;
                                }
                            }
                            
                            alert(`âœ… Import complete!\n${updatedCount} items updated\n${newCount} new items added`);
                        } catch (error) {
                            alert(`âŒ Import error: ${error.message}`);
                        }
                    };
                    reader.readAsText(file);
                };
                
                // Fuzzy Matching Function for Lightspeed - NEW!
                const fuzzyMatch = (str1, str2, threshold = 0.7) => {
                    // Normalize strings: lowercase, remove extra spaces
                    const normalize = (s) => s.toLowerCase().replace(/\s+/g, ' ').trim();
                    const s1 = normalize(str1);
                    const s2 = normalize(str2);
                    
                    // Exact match
                    if (s1 === s2) return { match: true, score: 1.0 };
                    
                    // Calculate similarity using Levenshtein-like approach
                    // Simple approach: count matching words
                    const words1 = s1.split(' ');
                    const words2 = s2.split(' ');
                    
                    // Check if one string contains the other (partial match)
                    if (s1.includes(s2) || s2.includes(s1)) {
                        return { match: true, score: 0.9 };
                    }
                    
                    // Count matching words
                    let matchingWords = 0;
                    const maxWords = Math.max(words1.length, words2.length);
                    
                    words1.forEach(w1 => {
                        if (words2.some(w2 => w2 === w1 || w2.includes(w1) || w1.includes(w2))) {
                            matchingWords++;
                        }
                    });
                    
                    const score = matchingWords / maxWords;
                    return { match: score >= threshold, score };
                };
                
                // Find best match for an item name in inventory
                const findBestMatch = (itemName, inventory) => {
                    const cleanName = itemName.trim();
                    
                    // Try exact match first (case-insensitive)
                    const exactMatch = inventory.find(item => 
                        item.name.toLowerCase() === cleanName.toLowerCase()
                    );
                    if (exactMatch) return { item: exactMatch, score: 1.0, type: 'exact' };
                    
                    // Try fuzzy matching
                    let bestMatch = null;
                    let bestScore = 0;
                    
                    inventory.forEach(item => {
                        const result = fuzzyMatch(cleanName, item.name, 0.6);
                        if (result.match && result.score > bestScore) {
                            bestMatch = item;
                            bestScore = result.score;
                        }
                    });
                    
                    if (bestMatch) {
                        return { item: bestMatch, score: bestScore, type: 'fuzzy' };
                    }
                    
                    return null;
                };
                
                // Lightspeed Sales Import - For actual Lightspeed Excel exports
                const importLightspeedSales = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            // Read Excel file using SheetJS
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                            
                            console.log('Lightspeed import: Read', rows.length, 'rows');
                            
                            // Categories to exclude (counted by box, not individual items)
                            const excludedCategories = [
                                'Beer/Cider',
                                'Hot Drinks', 
                                'Snacks',
                                'Soft Drinks',
                                'Spirits',
                                'Wine'
                            ];
                            
                            let updatedCount = 0;
                            let notFoundItems = [];
                            const updates = [];
                            let currentCategory = null;
                            
                            // Parse Lightspeed data
                            // Column 0 = Item Name, Column 4 = Total Transaction Count
                            for (let i = 1; i < rows.length; i++) {
                                const row = rows[i];
                                if (!row || row.length === 0) continue;
                                
                                const itemName = row[0];
                                const quantitySold = parseInt(row[4]) || 0;
                                
                                if (!itemName) continue;
                                
                                // Check if this is a category header (no leading spaces)
                                if (!itemName.toString().startsWith(' ') && !itemName.toString().startsWith('\t')) {
                                    currentCategory = itemName.toString().trim();
                                    continue;
                                }
                                
                                // Skip items from excluded categories
                                if (excludedCategories.includes(currentCategory)) {
                                    console.log(`Skipping ${itemName.toString().trim()} (${currentCategory})`);
                                    continue;
                                }
                                
                                // Skip if no quantity sold
                                if (quantitySold === 0) continue;
                                
                                // Clean item name (remove leading spaces/tabs)
                                const cleanItemName = itemName.toString().trim();
                                
                                // Find matching item in inventory using fuzzy matching
                                const matchResult = findBestMatch(cleanItemName, items);
                                
                                if (matchResult) {
                                    const existingItem = matchResult.item;
                                    const currentShopQty = existingItem.quantityShop || 0;
                                    const newShopQty = Math.max(0, currentShopQty - quantitySold);
                                    updates.push({
                                        id: existingItem.id,
                                        name: cleanItemName,
                                        matchedName: existingItem.name,
                                        soldQty: quantitySold,
                                        oldQty: currentShopQty,
                                        newQty: newShopQty,
                                        category: currentCategory,
                                        matchType: matchResult.type,
                                        matchScore: matchResult.score
                                    });
                                } else {
                                    notFoundItems.push(cleanItemName);
                                }
                            }
                            
                            if (updates.length === 0) {
                                alert('âŒ No matching items found in your inventory.\n\nTip: Check that item names are similar between Lightspeed and your inventory.');
                                return;
                            }
                            
                            // Show preview with match confidence - FULL LIST
                            let confirmMessage = `Found ${updates.length} items to update:\n\n`;
                            confirmMessage += updates.map(u => {
                                const matchIndicator = u.matchType === 'exact' ? 'âœ“' : `~${Math.round(u.matchScore * 100)}%`;
                                const nameInfo = u.matchType === 'fuzzy' ? `\n  (matched to: "${u.matchedName}")` : '';
                                return `${matchIndicator} ${u.name}: ${u.oldQty} â†’ ${u.newQty} (sold ${u.soldQty})${nameInfo}`;
                            }).join('\n');
                            if (notFoundItems.length > 0) {
                                confirmMessage += `\n\nâš ï¸ ${notFoundItems.length} items not found:\n`;
                                confirmMessage += notFoundItems.slice(0, 5).join(', ');
                                if (notFoundItems.length > 5) {
                                    confirmMessage += ` ...and ${notFoundItems.length - 5} more`;
                                }
                            }
                            confirmMessage += '\n\nâœ… Proceed with updating shop quantities?';
                            
                            if (!confirm(confirmMessage)) {
                                return;
                            }
                            
                            // NEW V2.2 - Save sales history to Firebase for analytics
                            const importDate = new Date().toISOString();
                            const importTimestamp = Date.now();
                            
                            console.log('ðŸ’¾ Saving sales history to Firebase...');
                            for (const update of updates) {
                                try {
                                    // Save each sale to salesHistory collection
                                    await window.db.collection('salesHistory').add({
                                        // Item identification
                                        itemId: update.id,
                                        itemName: update.matchedName, // Your inventory name
                                        lightspeedName: update.name, // Original Lightspeed name
                                        
                                        // Sales data
                                        quantitySold: update.soldQty,
                                        oldShopQty: update.oldQty,
                                        newShopQty: update.newQty,
                                        
                                        // Context
                                        category: update.category || 'Unknown',
                                        lightspeedCategory: update.category,
                                        
                                        // Match information
                                        matchType: update.matchType, // 'exact' or 'fuzzy'
                                        matchScore: update.matchScore,
                                        
                                        // Timestamps
                                        importDate: importDate,
                                        importTimestamp: importTimestamp,
                                        weekEnding: new Date().toISOString().split('T')[0], // You can adjust this
                                        
                                        // Metadata
                                        source: 'lightspeed_import',
                                        version: 'v2.2'
                                    });
                                } catch (error) {
                                    console.error(`âŒ Error saving sales history for ${update.name}:`, error);
                                    // Continue with other items even if one fails
                                }
                            }
                            console.log(`âœ… Saved ${updates.length} sales records to history`);
                            
                            // Apply updates to Firebase
                            for (const update of updates) {
                                const item = items.find(i => i.id === update.id);
                                if (item) {
                                    const newShopQty = update.newQty;
                                    const totalQty = newShopQty + (item.quantityStore || 0);
                                    
                                    await saveItemToFirebase({
                                        ...item,
                                        quantityShop: newShopQty,
                                        quantity: totalQty,
                                        lastRestocked: new Date().toISOString().split('T')[0]
                                    });
                                    updatedCount++;
                                }
                            }
                            
                            // Wait for Firebase real-time listener to update
                            await new Promise(resolve => setTimeout(resolve, 1500));
                            
                            let resultMessage = `âœ… Lightspeed import complete!\n\n${updatedCount} items updated`;
                            resultMessage += '\nðŸ“Š Sales history saved for analytics';
                            resultMessage += '\n\nðŸ“Š Quantities updated in Search and Analytics.';
                            if (notFoundItems.length > 0) {
                                resultMessage += `\n\nâš ï¸ ${notFoundItems.length} items not found:\n`;
                                resultMessage += notFoundItems.slice(0, 10).join(', ');
                                if (notFoundItems.length > 10) {
                                    resultMessage += `\n... and ${notFoundItems.length - 10} more`;
                                }
                                resultMessage += '\n\nTip: Check item names match exactly between Lightspeed and your inventory.';
                            }
                            alert(resultMessage);
                            
                        } catch (error) {
                            alert(`âŒ Import error: ${error.message}\n\nMake sure you're uploading a Lightspeed Excel export file.`);
                            console.error('Lightspeed import error:', error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                };
                
                // NEW V2.2.1 - Import Sales History ONLY (no stock updates)
                const importSalesHistoryOnly = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            // Read Excel file using SheetJS
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                            
                            console.log('ðŸ“œ History import: Read', rows.length, 'rows');
                            
                            // Categories to exclude
                            const excludedCategories = [
                                'Beer/Cider',
                                'Hot Drinks', 
                                'Snacks',
                                'Soft Drinks',
                                'Spirits',
                                'Wine'
                            ];
                            
                            let savedCount = 0;
                            let notFoundItems = [];
                            const historyRecords = [];
                            let currentCategory = null;
                            
                            // Parse Lightspeed data (same logic as regular import)
                            for (let i = 1; i < rows.length; i++) {
                                const row = rows[i];
                                if (!row || row.length === 0) continue;
                                
                                const itemName = row[0];
                                const quantitySold = parseInt(row[4]) || 0;
                                
                                if (!itemName) continue;
                                
                                // Check if category header
                                if (!itemName.toString().startsWith(' ') && !itemName.toString().startsWith('\t')) {
                                    currentCategory = itemName.toString().trim();
                                    continue;
                                }
                                
                                // Skip excluded categories
                                if (excludedCategories.includes(currentCategory)) {
                                    continue;
                                }
                                
                                // Skip if no quantity sold
                                if (quantitySold === 0) continue;
                                
                                // Clean item name
                                const cleanItemName = itemName.toString().trim();
                                
                                // Find matching item in inventory
                                const matchResult = findBestMatch(cleanItemName, items);
                                
                                if (matchResult) {
                                    const existingItem = matchResult.item;
                                    historyRecords.push({
                                        itemId: existingItem.id,
                                        itemName: existingItem.name,
                                        lightspeedName: cleanItemName,
                                        quantitySold: quantitySold,
                                        category: currentCategory || 'Unknown',
                                        matchType: matchResult.type,
                                        matchScore: matchResult.score
                                    });
                                } else {
                                    notFoundItems.push(cleanItemName);
                                }
                            }
                            
                            if (historyRecords.length === 0) {
                                alert('âŒ No matching items found in your inventory for this historical import.');
                                return;
                            }
                            
                            // Confirm before saving
                            const confirmMsg = `Found ${historyRecords.length} sales records from this file.\n\n` +
                                `This will ONLY save sales history for analytics.\n` +
                                `It will NOT update your current stock quantities.\n\n` +
                                `Continue with history import?`;
                            
                            if (!confirm(confirmMsg)) {
                                return;
                            }
                            
                            // Ask for week ending date ONCE
                            const weekEnding = prompt(
                                'What week does this sales data represent?\n\n' +
                                'Enter the LAST day of the week (e.g., 2026-01-11 for week ending Jan 11)\n\n' +
                                'Format: YYYY-MM-DD',
                                new Date().toISOString().split('T')[0]
                            );
                            
                            // Handle cancellation
                            if (!weekEnding) {
                                alert('Import cancelled - no date provided.');
                                return;
                            }
                            
                            // Save to Firebase salesHistory collection
                            const importDate = new Date().toISOString();
                            const importTimestamp = Date.now();
                            
                            console.log('ðŸ’¾ Saving historical sales data...');
                            for (const record of historyRecords) {
                                try {
                                    await window.db.collection('salesHistory').add({
                                        ...record,
                                        importDate: importDate,
                                        importTimestamp: importTimestamp,
                                        weekEnding: weekEnding, // Use the date from before loop
                                        source: 'historical_import',
                                        version: 'v2.2.2'
                                    });
                                    savedCount++;
                                } catch (error) {
                                    console.error(`âŒ Error saving history for ${record.itemName}:`, error);
                                }
                            }
                            
                            console.log(`âœ… Saved ${savedCount} historical sales records`);
                            
                            // Show success message
                            let resultMessage = `âœ… Historical import complete!\n\n${savedCount} sales records saved`;
                            resultMessage += '\nðŸ“Š History saved for future analytics';
                            resultMessage += '\nâœ… Stock quantities NOT changed';
                            
                            if (notFoundItems.length > 0) {
                                resultMessage += `\n\nâš ï¸ ${notFoundItems.length} items not found:\n`;
                                resultMessage += notFoundItems.slice(0, 10).join(', ');
                                if (notFoundItems.length > 10) {
                                    resultMessage += `\n... and ${notFoundItems.length - 10} more`;
                                }
                            }
                            
                            alert(resultMessage);
                            
                        } catch (error) {
                            alert(`âŒ Import error: ${error.message}\n\nMake sure you're uploading a Lightspeed Excel export file.`);
                            console.error('Historical import error:', error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                };
                
                // NEW V2.2.4 - Clear all sales history
                const clearSalesHistory = async () => {
                    const confirmMsg = 'âš ï¸ WARNING: Delete ALL Sales History?\n\n' +
                        'This will permanently delete all sales records from Firebase.\n' +
                        'Your inventory data will NOT be affected.\n\n' +
                        'Current sales records: ' + salesHistory.length + '\n\n' +
                        'This action CANNOT be undone!\n\n' +
                        'Type "DELETE" to confirm:';
                    
                    const confirmation = prompt(confirmMsg);
                    
                    if (confirmation !== 'DELETE') {
                        if (confirmation !== null) {
                            alert('âŒ Cancelled - Sales history NOT deleted.\n\nYou must type "DELETE" exactly to confirm.');
                        }
                        return;
                    }
                    
                    try {
                        console.log('ðŸ—‘ï¸ Deleting all sales history...');
                        
                        // Get all salesHistory documents
                        const snapshot = await window.db.collection('salesHistory').get();
                        
                        if (snapshot.empty) {
                            alert('âœ… Sales history is already empty - nothing to delete!');
                            return;
                        }
                        
                        // Delete all documents in batches
                        const batch = window.db.batch();
                        let deleteCount = 0;
                        
                        snapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                            deleteCount++;
                        });
                        
                        // Commit the batch delete
                        await batch.commit();
                        
                        console.log(`âœ… Deleted ${deleteCount} sales records`);
                        
                        // Success message
                        alert(`âœ… Sales history cleared!\n\n${deleteCount} records deleted\n\n` +
                            `Analytics will now show "No Sales Data Yet".\n\n` +
                            `You can re-import your files with correct dates.`);
                        
                    } catch (error) {
                        console.error('âŒ Error clearing sales history:', error);
                        alert(`âŒ Error deleting sales history: ${error.message}\n\nPlease try again or check Firebase Console.`);
                    }
                };
                
                return (
                    <div style={{padding: '2rem', maxWidth: '800px', margin: '0 auto'}}>
                        <h2 style={{marginBottom: '2rem'}}>ðŸ“Š Data Management</h2>
                        
                        {/* Firebase Upload/Reset Section - Always visible */}
                        <div style={{
                            background: items.length === 0 ? '#fff3cd' : '#e3f2fd',
                            padding: '2rem',
                            borderRadius: '12px',
                            border: items.length === 0 ? '3px solid #ff9800' : '3px solid #2196f3',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{color: items.length === 0 ? '#856404' : '#1565c0', marginBottom: '1rem'}}>
                                {items.length === 0 ? 'ðŸš€ First Time Setup' : 'ðŸ”„ Reset Inventory'}
                            </h3>
                            <p style={{color: items.length === 0 ? '#856404' : '#1565c0', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                {items.length === 0 ? (
                                    <>
                                        Your Firebase database is empty. Click below to upload your base inventory items.
                                        <br/><strong>This only needs to be done once!</strong>
                                    </>
                                ) : (
                                    <>
                                        Currently {items.length} items in Firebase.
                                        <br/><strong>âš ï¸ Warning: This will DELETE all items and restore base inventory!</strong>
                                        {(() => {
                                            // Detect actual duplicates (same name + location)
                                            const duplicates = [];
                                            const seen = new Map();
                                            items.forEach(item => {
                                                const key = `${item.name}-${item.location}`;
                                                if (seen.has(key)) {
                                                    duplicates.push(item.name);
                                                } else {
                                                    seen.set(key, item);
                                                }
                                            });
                                            
                                            if (duplicates.length > 0) {
                                                return (
                                                    <><br/><span style={{color: '#f44336', fontWeight: 'bold'}}>
                                                        ðŸ”´ {duplicates.length} duplicate items detected: {duplicates.slice(0, 3).join(', ')}
                                                        {duplicates.length > 3 && '...'}
                                                    </span></>
                                                );
                                            }
                                            return null;
                                        })()}
                                    </>
                                )}
                            </p>
                            {isUploading ? (
                                <div>
                                    <div style={{
                                        width: '100%',
                                        height: '30px',
                                        background: '#f0f0f0',
                                        borderRadius: '15px',
                                        overflow: 'hidden',
                                        marginBottom: '1rem'
                                    }}>
                                        <div style={{
                                            width: `${uploadProgress}%`,
                                            height: '100%',
                                            background: '#4caf50',
                                            transition: 'width 0.3s'
                                        }}></div>
                                    </div>
                                    <p style={{textAlign: 'center', color: '#666'}}>
                                        {uploadProgress < 50 ? 'Clearing old data...' : 'Uploading fresh items...'} {uploadProgress}%
                                    </p>
                                </div>
                            ) : (
                                <button
                                    onClick={uploadAllItemsToFirebase}
                                    style={{
                                        padding: '1rem 2rem',
                                        background: items.length === 0 ? '#4caf50' : '#ff9800',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '8px',
                                        fontSize: '1.1rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        boxShadow: '0 4px 12px rgba(255, 152, 0, 0.4)'
                                    }}
                                >
                                    {items.length === 0 ? 'ðŸš€ Upload Base Items to Firebase' : 'ðŸ”„ Reset to Base Inventory'}
                                </button>
                            )}
                        </div>
                        
                        {/* JSON Upload - NEW! */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{color: '#333', marginBottom: '1rem'}}>ðŸ“¤ Upload Inventory from JSON</h3>
                            <p style={{color: '#666', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                Upload your full inventory from the inventory-data.json file.
                                <br/>Use this to initialize Firebase if it's empty, or to bulk update all items.
                                <br/><strong>âš ï¸ This will replace all existing items in Firebase!</strong>
                            </p>
                            <input
                                type="file"
                                id="jsonFileInput"
                                accept=".json"
                                style={{ display: 'none' }}
                                onChange={async (e) => {
                                    const file = e.target.files[0];
                                    if (!file) return;
                                    
                                    try {
                                        const text = await file.text();
                                        const jsonData = JSON.parse(text);
                                        
                                        if (!Array.isArray(jsonData)) {
                                            alert('âŒ Invalid JSON: Must be an array of items');
                                            return;
                                        }
                                        
                                        const itemCount = jsonData.length;
                                        if (!confirm(`Upload ${itemCount} items to Firebase?\n\nâš ï¸ This will DELETE existing items and upload these ${itemCount} items.\n\nProceed?`)) {
                                            e.target.value = '';
                                            return;
                                        }
                                        
                                        setIsUploading(true);
                                        setUploadProgress(0);
                                        
                                        // Delete all existing items
                                        const existingDocs = await window.db.collection('inventory').get();
                                        setUploadProgress(10);
                                        
                                        for (const doc of existingDocs.docs) {
                                            await doc.ref.delete();
                                        }
                                        setUploadProgress(30);
                                        
                                        // Upload new items
                                        let uploaded = 0;
                                        for (let i = 0; i < jsonData.length; i++) {
                                            const item = jsonData[i];
                                            await window.db.collection('inventory').doc(`item-${i + 1}`).set({
                                                ...item,
                                                id: `item-${i + 1}`
                                            });
                                            uploaded++;
                                            setUploadProgress(30 + Math.round((uploaded / itemCount) * 70));
                                        }
                                        
                                        setUploadProgress(100);
                                        setIsUploading(false);
                                        
                                        // Wait for sync
                                        await new Promise(resolve => setTimeout(resolve, 1500));
                                        
                                        alert(`âœ… Successfully uploaded ${itemCount} items to Firebase!\n\nðŸ“Š All tabs will update automatically.`);
                                        e.target.value = '';
                                        
                                    } catch (error) {
                                        setIsUploading(false);
                                        alert(`âŒ Error uploading JSON:\n\n${error.message}\n\nMake sure the file is valid JSON format.`);
                                        e.target.value = '';
                                    }
                                }}
                            />
                            <button
                                onClick={() => document.getElementById('jsonFileInput').click()}
                                style={{
                                    padding: '1rem 2rem',
                                    background: '#2196f3',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(33, 150, 243, 0.4)'
                                }}
                            >
                                ðŸ“¤ Upload JSON File
                            </button>
                            <p style={{fontSize: '0.85rem', color: '#999', marginTop: '1rem'}}>
                                ðŸ’¡ Download inventory-data.json from your outputs folder and upload it here.
                            </p>
                        </div>
                        
                        {/* Excel Export */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{color: '#333', marginBottom: '1rem'}}>ðŸ“¥ Export to Excel/CSV</h3>
                            <p style={{color: '#666', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                Download all {items.length} items with current quantities to Excel/CSV format. 
                                Perfect for backup or offline analysis.
                            </p>
                            <button
                                onClick={exportToExcel}
                                style={{
                                    padding: '1rem 2rem',
                                    background: '#4caf50',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(76, 175, 80, 0.4)'
                                }}
                            >
                                ðŸ“¥ Export Inventory to CSV
                            </button>
                        </div>
                        
                        {/* Excel Import */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{color: '#333', marginBottom: '1rem'}}>ðŸ“¤ Import from Excel/CSV</h3>
                            <p style={{color: '#666', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                Upload a CSV file to update inventory. File must have these columns:<br/>
                                <code style={{background: '#f5f5f5', padding: '0.25rem 0.5rem', borderRadius: '4px'}}>
                                    Item Name, Category, Location, Shop Quantity, Storage Quantity, Total Quantity
                                </code>
                            </p>
                            <input
                                type="file"
                                accept=".csv"
                                onChange={importFromExcel}
                                style={{display: 'none'}}
                                id="csv-import"
                            />
                            <button
                                onClick={() => document.getElementById('csv-import').click()}
                                style={{
                                    padding: '1rem 2rem',
                                    background: '#ff9800',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(255, 152, 0, 0.4)'
                                }}
                            >
                                ðŸ“¤ Import from CSV
                            </button>
                        </div>
                        
                        {/* Lightspeed Sales Import */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{color: '#333', marginBottom: '1rem'}}>ðŸ“Š Lightspeed Sales Import</h3>
                            <p style={{color: '#666', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                Upload your Lightspeed weekly sales Excel file to automatically update shop quantities.
                                <br/><strong>File must include columns:</strong> Item Name (or Description) and Quantity Sold
                            </p>
                            <input
                                type="file"
                                accept=".csv,.xlsx,.xls"
                                onChange={importLightspeedSales}
                                style={{display: 'none'}}
                                id="lightspeed-import"
                            />
                            <button
                                onClick={() => document.getElementById('lightspeed-import').click()}
                                style={{
                                    padding: '1rem 2rem',
                                    background: '#9c27b0',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(156, 39, 176, 0.4)'
                                }}
                            >
                                ðŸ“Š Import Lightspeed Sales
                            </button>
                            <div style={{
                                marginTop: '1rem',
                                padding: '1rem',
                                background: '#f5f5f5',
                                borderRadius: '6px',
                                fontSize: '0.9rem',
                                color: '#666'
                            }}>
                                <strong>How it works:</strong>
                                <ol style={{marginTop: '0.5rem', paddingLeft: '1.5rem'}}>
                                    <li>Export weekly sales from Lightspeed (Excel/CSV)</li>
                                    <li>Upload the file here</li>
                                    <li>App matches item names and SUBTRACTS sold quantities from shop stock</li>
                                    <li>Review changes before finalizing</li>
                                </ol>
                            </div>
                        </div>
                        
                        {/* NEW V2.2.1 - Import Sales History (No Stock Updates) */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem',
                            border: '2px solid #4caf50'
                        }}>
                            <h3 style={{color: '#2e7d32', marginBottom: '1rem'}}>ðŸ“œ Import Sales History (For Analytics)</h3>
                            <p style={{color: '#666', marginBottom: '1.5rem', lineHeight: '1.6'}}>
                                Upload past Lightspeed exports to build sales history for analytics.
                                <br/><strong>âš ï¸ This will ONLY save sales data - it will NOT update your current stock quantities!</strong>
                            </p>
                            <input
                                type="file"
                                accept=".csv,.xlsx,.xls"
                                onChange={importSalesHistoryOnly}
                                style={{display: 'none'}}
                                id="history-import"
                            />
                            <button
                                onClick={() => document.getElementById('history-import').click()}
                                style={{
                                    padding: '1rem 2rem',
                                    background: '#4caf50',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(76, 175, 80, 0.4)'
                                }}
                            >
                                ðŸ“œ Import History Only
                            </button>
                            
                            {/* NEW V2.2.4 - Clear Sales History Button */}
                            {salesHistory.length > 0 && (
                                <button
                                    onClick={clearSalesHistory}
                                    style={{
                                        padding: '1rem 2rem',
                                        background: '#f44336',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '8px',
                                        fontSize: '1rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        boxShadow: '0 4px 12px rgba(244, 67, 54, 0.4)',
                                        marginLeft: '1rem'
                                    }}
                                >
                                    ðŸ—‘ï¸ Clear All Sales History ({salesHistory.length})
                                </button>
                            )}
                            
                            <div style={{
                                marginTop: '1rem',
                                padding: '1rem',
                                background: '#e8f5e9',
                                borderRadius: '6px',
                                fontSize: '0.9rem',
                                color: '#2e7d32'
                            }}>
                                <strong>Use this for:</strong>
                                <ul style={{marginTop: '0.5rem', paddingLeft: '1.5rem'}}>
                                    <li>Uploading past Lightspeed exports to build analytics history</li>
                                    <li>Backfilling historical sales data</li>
                                    <li>Building trend analysis without affecting current stock</li>
                                </ul>
                                <strong style={{marginTop: '0.5rem', display: 'block'}}>âœ… Stock quantities will NOT be changed!</strong>
                            </div>
                        </div>
                        
                        {/* NEW V2.2.1 - Smart Alerts (Coming Soon) */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem',
                            border: '2px solid #2196f3'
                        }}>
                            <h3 style={{color: '#1565c0', marginBottom: '1rem'}}>ðŸŽ¯ Predictive Stock Alerts</h3>
                            <div style={{
                                padding: '2rem',
                                background: '#e3f2fd',
                                borderRadius: '8px',
                                textAlign: 'center'
                            }}>
                                <div style={{fontSize: '3rem', marginBottom: '1rem'}}>ðŸ”®</div>
                                <h4 style={{color: '#1565c0', marginBottom: '0.5rem'}}>Coming Soon!</h4>
                                <p style={{color: '#666', margin: 0}}>
                                    Smart reorder suggestions based on sales velocity and supplier lead times.
                                </p>
                                <div style={{
                                    marginTop: '1.5rem',
                                    padding: '1rem',
                                    background: 'white',
                                    borderRadius: '6px',
                                    textAlign: 'left'
                                }}>
                                    <strong style={{color: '#1565c0'}}>Future features:</strong>
                                    <ul style={{marginTop: '0.5rem', paddingLeft: '1.5rem', color: '#666'}}>
                                        <li>ðŸ”´ Critical: Order NOW alerts (2-3 days until stockout)</li>
                                        <li>ðŸŸ¡ Warning: Order soon (1 week until stockout)</li>
                                        <li>ðŸ“¦ Optimal reorder quantities based on sales velocity</li>
                                        <li>ðŸšš Supplier lead time tracking</li>
                                        <li>ðŸ“ˆ Seasonal pattern predictions</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        {/* Status */}
                        <div style={{
                            background: '#e3f2fd',
                            padding: '1.5rem',
                            borderRadius: '8px',
                            border: '2px solid #2196f3'
                        }}>
                            <h4 style={{color: '#1565c0', marginBottom: '0.5rem'}}>â„¹ï¸ Status</h4>
                            <p style={{color: '#1565c0', margin: 0}}>
                                Firebase is connected and ready. Current items: {items.length}
                            </p>
                        </div>
                        
                        {/* Instructions */}
                        <div style={{
                            background: '#fff3cd',
                            padding: '1.5rem',
                            borderRadius: '8px',
                            border: '2px solid #ffa500',
                            marginTop: '2rem'
                        }}>
                            <h4 style={{color: '#856404', marginBottom: '0.5rem'}}>ðŸ’¡ How to Update from Lightspeed</h4>
                            <ol style={{color: '#856404', margin: '0.5rem 0 0 1.5rem', lineHeight: '1.8'}}>
                                <li>Export inventory from Lightspeed to CSV</li>
                                <li>Open the CSV and ensure column names match (or rename them)</li>
                                <li>Click "Import from CSV" above</li>
                                <li>Select your Lightspeed export file</li>
                                <li>All matching items will be updated automatically!</li>
                            </ol>
                        </div>
                    </div>
                );
            };

            const renderStorageMap = () => {
                // Helper function to get bulk storage items
                const getBulkItems = () => {
                    return items.filter(item => item.location === 'Bulk Storage');
                };
            
                // LEVEL 4: Individual shelf level view (e.g., A1.1, A1.2, A1.3, A1.4)
                if (selectedShelf) {
                    // Get all items on this shelf
                    const shelfItems = getShelfItems(selectedShelf);
                    
                    // Group by level (A1.1, A1.2, A1.3, A1.4)
                    const levels = {};
                    shelfItems.forEach(item => {
                        const level = item.location;
                        if (!levels[level]) {
                            levels[level] = [];
                        }
                        levels[level].push(item);
                        
                        // Handle multi-level items (e.g., B3.2/3 should be in both B3.2 AND B3.3)
                        if (level.includes('/')) {
                            const parts = level.split('/');
                            const base = parts[0]; // e.g., "B3.2"
                            const extraLevel = parts[1]; // e.g., "3"
                            const shelfPart = base.substring(0, base.lastIndexOf('.')); // e.g., "B3"
                            const extraLocation = `${shelfPart}.${extraLevel}`; // e.g., "B3.3"
                            
                            if (!levels[extraLocation]) {
                                levels[extraLocation] = [];
                            }
                            levels[extraLocation].push(item);
                        }
                    });
                    
                    const levelKeys = Object.keys(levels).sort();
                    
                    return (
                        <div className="storage-map">
                            <button className="back-button" onClick={() => setSelectedShelf(null)}>
                                â† Back to {selectedZone}
                            </button>
                            <h2 className="map-title">Shelf {selectedShelf}</h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1.5rem' }}>
                                {shelfItems.length} items â€¢ {levelKeys.length} levels in use
                            </p>
                            
                            {/* Shelf visualization with levels */}
                            <div style={{ marginBottom: '2rem', background: 'white', padding: '1.5rem', borderRadius: '8px' }}>
                                
                                <div style={{ display: 'flex', gap: '2rem', alignItems: 'flex-start' }}>
                                    {/* Actual shelf photo with labeled levels */}
                                    <div style={{ flex: '0 0 300px', position: 'relative' }}>
                                        {shelfImages[selectedShelf] ? (
                                            <img 
                                                key={`${selectedShelf}-${shelfImages[selectedShelf] ? 'loaded' : 'empty'}`}
                                                src={shelfImages[selectedShelf]}
                                                alt={`Shelf ${selectedShelf}`}
                                                onLoad={() => console.log(`âœ… Image loaded for shelf ${selectedShelf}`)}
                                                onError={(e) => {
                                                    console.error(`âŒ Image failed to load for shelf ${selectedShelf}`);
                                                    console.error('Error details:', e);
                                                }}
                                                style={{ 
                                                    width: '100%', 
                                                    height: 'auto', 
                                                    borderRadius: '8px',
                                                    border: '3px solid #333',
                                                    display: 'block',
                                                    cursor: 'pointer'
                                                }}
                                                onClick={() => {
                                                    setSelectedShelfForImage(selectedShelf);
                                                    setShowShelfImageModal(true);
                                                }}
                                            />
                                        ) : (
                                            <svg width="300" height="500" viewBox="0 0 300 500" style={{ 
                                                borderRadius: '8px',
                                                border: '3px solid #333',
                                                display: 'block',
                                                background: '#2a2a2a'
                                            }}>
                                                {/* Shelf background */}
                                                <rect width="300" height="500" fill="#2a2a2a"/>
                                                
                                                {/* Side supports */}
                                                <rect x="10" y="0" width="15" height="500" fill="#1a1a1a"/>
                                                <rect x="275" y="0" width="15" height="500" fill="#1a1a1a"/>
                                                
                                                {/* Level 4 (Top) */}
                                                <rect x="10" y="20" width="280" height="8" fill="#444"/>
                                                <rect x="10" y="28" width="280" height="3" fill="#1a1a1a"/>
                                                <line x1="25" y1="31" x2="25" y2="115" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                <line x1="275" y1="31" x2="275" y2="115" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                
                                                {/* Level 3 */}
                                                <rect x="10" y="115" width="280" height="8" fill="#444"/>
                                                <rect x="10" y="123" width="280" height="3" fill="#1a1a1a"/>
                                                <line x1="25" y1="126" x2="25" y2="240" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                <line x1="275" y1="126" x2="275" y2="240" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                
                                                {/* Level 2 */}
                                                <rect x="10" y="240" width="280" height="8" fill="#444"/>
                                                <rect x="10" y="248" width="280" height="3" fill="#1a1a1a"/>
                                                <line x1="25" y1="251" x2="25" y2="365" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                <line x1="275" y1="251" x2="275" y2="365" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                
                                                {/* Level 1 (Bottom) */}
                                                <rect x="10" y="365" width="280" height="8" fill="#444"/>
                                                <rect x="10" y="373" width="280" height="3" fill="#1a1a1a"/>
                                                <line x1="25" y1="376" x2="25" y2="490" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                <line x1="275" y1="376" x2="275" y2="490" stroke="#555" strokeWidth="1" strokeDasharray="3,3"/>
                                                
                                                {/* Base */}
                                                <rect x="10" y="490" width="280" height="10" fill="#1a1a1a"/>
                                                
                                                {/* Level numbers */}
                                                <text x="150" y="75" textAnchor="middle" fill="#888" fontSize="32" fontWeight="bold" fontFamily="Arial">4</text>
                                                <text x="150" y="185" textAnchor="middle" fill="#888" fontSize="32" fontWeight="bold" fontFamily="Arial">3</text>
                                                <text x="150" y="310" textAnchor="middle" fill="#888" fontSize="32" fontWeight="bold" fontFamily="Arial">2</text>
                                                <text x="150" y="435" textAnchor="middle" fill="#888" fontSize="32" fontWeight="bold" fontFamily="Arial">1</text>
                                                
                                                {/* "Upload Photo" text */}
                                                <text x="150" y="260" textAnchor="middle" fill="#666" fontSize="14" fontFamily="Arial">Upload photo to replace</text>
                                            </svg>
                                        )}
                                        {/* Level markers on the photo */}
                                        {[
                                            { num: 4, top: '2%', levelKey: `${selectedShelf}.4` },
                                            { num: 3, top: '28%', levelKey: `${selectedShelf}.3` },
                                            { num: 2, top: '54%', levelKey: `${selectedShelf}.2` },
                                            { num: 1, top: '78%', levelKey: `${selectedShelf}.1` }
                                        ].map(({ num, top, levelKey }) => {
                                            const hasItems = levels[levelKey];
                                            return (
                                                <div
                                                    key={num}
                                                    style={{
                                                        position: 'absolute',
                                                        left: '-15px',
                                                        top: top,
                                                        width: '35px',
                                                        height: '35px',
                                                        borderRadius: '50%',
                                                        background: hasItems ? '#FF8C42' : '#999',
                                                        border: '3px solid white',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        color: 'white',
                                                        fontWeight: 'bold',
                                                        fontSize: '1.2rem',
                                                        boxShadow: '0 2px 8px rgba(0,0,0,0.3)',
                                                        zIndex: 10
                                                    }}
                                                >
                                                    {num}
                                                </div>
                                            );
                                        })}
                                        {/* Arrow pointing to shelf */}
                                        {[
                                            { num: 4, top: '2%' },
                                            { num: 3, top: '28%' },
                                            { num: 2, top: '54%' },
                                            { num: 1, top: '78%' }
                                        ].map(({ num, top }) => (
                                            <div
                                                key={`arrow-${num}`}
                                                style={{
                                                    position: 'absolute',
                                                    left: '25px',
                                                    top: top,
                                                    width: '40px',
                                                    height: '3px',
                                                    background: '#FF8C42',
                                                    transform: 'translateY(15px)',
                                                    zIndex: 5
                                                }}
                                            >
                                                <div style={{
                                                    position: 'absolute',
                                                    right: '-8px',
                                                    top: '-4px',
                                                    width: 0,
                                                    height: 0,
                                                    borderLeft: '8px solid #FF8C42',
                                                    borderTop: '5px solid transparent',
                                                    borderBottom: '5px solid transparent'
                                                }} />
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {/* Legend showing what's on each level */}
                                    <div style={{ flex: 1 }}>
                                        <h4 style={{ marginBottom: '1rem' }}>Items by Level:</h4>
                                        {[4, 3, 2, 1].map(levelNum => {
                                            const levelKey = `${selectedShelf}.${levelNum}`;
                                            const items = levels[levelKey] || [];
                                            return (
                                                <div key={levelNum} style={{ marginBottom: '1rem', padding: '0.75rem', background: '#f5f5f5', borderRadius: '6px' }}>
                                                    <div style={{ fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                        â—‹ Level {levelNum} ({levelKey}) - {items.length} items
                                                    </div>
                                                    {items.length > 0 ? (
                                                        <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                            {items.map(item => item.name).join(', ')}
                                                        </div>
                                                    ) : (
                                                        <div style={{ fontSize: '0.85rem', color: '#999', fontStyle: 'italic' }}>Empty</div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Full item list */}
                            <h3 style={{ marginBottom: '1rem' }}>All Items on {selectedShelf}:</h3>
                            <div className="search-results">
                                {shelfItems.map(item => (
                                    <div key={item.id} className="result-item">
                                        <h3>{item.name}</h3>
                                        <p><strong>Category:</strong> {item.category}</p>
                                        <span className="result-location">ðŸ“ {item.location}</span>
                                        <span className="result-tag">{item.tag}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    );
                }
            
                // LEVEL 2: Bulk storage view (CHECK THIS BEFORE GENERIC selectedZone!)
                if (selectedZone === 'BULK') {
                    const bulkItems = getBulkItems();
                    return (
                        <div className="storage-map">
                            <button className="back-button" onClick={() => setSelectedZone(null)}>
                                â† Back to Storage Room
                            </button>
                            <h2 className="map-title">ðŸ’§ Bulk Storage - Water Pallets</h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1.5rem' }}>
                                Items stored on pallets (left side of storage room)
                            </p>
                            
                            {/* Water Stock Health Bar */}
                            <div style={{ 
                                background: 'white', 
                                padding: '2rem', 
                                borderRadius: '12px', 
                                marginBottom: '2rem',
                                border: '2px solid #e0e0e0'
                            }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <h3 style={{ color: '#01579b', display: 'flex', alignItems: 'center', gap: '0.5rem', margin: 0 }}>
                                        ðŸ’§ Water Stock Level
                                    </h3>
                                    <button
                                        onClick={() => setShowWaterEditModal(true)}
                                        style={{
                                            background: 'var(--primary-orange)',
                                            color: 'white',
                                            border: 'none',
                                            padding: '0.5rem 1rem',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            fontSize: '0.85rem',
                                            fontWeight: '600'
                                        }}
                                    >
                                        âœï¸ Edit Stock
                                    </button>
                                </div>
                                
                                {(() => {
                                    // Calculate dynamic values
                                    const percentage = Math.round((waterStock.currentPallets / waterStock.maxPallets) * 100);
                                    const currentBoxes = waterStock.currentPallets * 42; // 42 boxes per pallet
                                    const maxBoxes = waterStock.maxPallets * 42;
                                    const currentBottles = waterStock.currentPallets * waterStock.bottlesPerPallet;
                                    const maxBottles = waterStock.maxPallets * waterStock.bottlesPerPallet;
                                    
                                    // Determine status
                                    let statusColor, statusBg, statusText;
                                    if (percentage >= 50) {
                                        statusColor = '#1b5e20';
                                        statusBg = '#c8e6c9';
                                        statusText = 'Good';
                                    } else if (percentage >= 25) {
                                        statusColor = '#f57c00';
                                        statusBg = '#fff3e0';
                                        statusText = 'Low';
                                    } else {
                                        statusColor = '#c62828';
                                        statusBg = '#ffebee';
                                        statusText = 'Critical';
                                    }
                                    
                                    return (
                                        <div style={{ display: 'flex', gap: '3rem', alignItems: 'center', justifyContent: 'center' }}>
                                            {/* Vertical Water Tube */}
                                            <div style={{ textAlign: 'center' }}>
                                                <div style={{ 
                                                    width: '120px', 
                                                    height: '300px', 
                                                    border: '4px solid #333',
                                                    borderRadius: '12px',
                                                    position: 'relative',
                                                    background: '#f5f5f5',
                                                    overflow: 'hidden',
                                                    boxShadow: 'inset 0 0 20px rgba(0,0,0,0.1)'
                                                }}>
                                                    {/* Water level - DYNAMIC */}
                                                    <div style={{
                                                        position: 'absolute',
                                                        bottom: 0,
                                                        left: 0,
                                                        right: 0,
                                                        height: `${percentage}%`,
                                                        background: 'linear-gradient(to top, #0288d1, #4fc3f7)',
                                                        transition: 'height 0.5s ease',
                                                        borderRadius: '0 0 8px 8px'
                                                    }}>
                                                        {/* Water wave effect */}
                                                        <div style={{
                                                            position: 'absolute',
                                                            top: '-5px',
                                                            left: 0,
                                                            right: 0,
                                                            height: '10px',
                                                            background: '#81d4fa',
                                                            opacity: 0.8
                                                        }} />
                                                    </div>
                                                    
                                                    {/* Percentage label inside tube - DYNAMIC */}
                                                    <div style={{
                                                        position: 'absolute',
                                                        top: '50%',
                                                        left: '50%',
                                                        transform: 'translate(-50%, -50%)',
                                                        fontSize: '2rem',
                                                        fontWeight: 'bold',
                                                        color: '#01579b',
                                                        textShadow: '0 2px 4px rgba(255,255,255,0.8)',
                                                        zIndex: 10
                                                    }}>
                                                        {percentage}%
                                                    </div>
                                                    
                                                    {/* Tick marks */}
                                                    {[100, 75, 50, 25, 0].map(mark => (
                                                        <div key={mark} style={{
                                                            position: 'absolute',
                                                            left: '-25px',
                                                            bottom: `${mark}%`,
                                                            fontSize: '0.75rem',
                                                            color: '#666',
                                                            fontWeight: '600'
                                                        }}>
                                                            {mark}%
                                                        </div>
                                                    ))}
                                                </div>
                                                <div style={{ marginTop: '1rem', fontSize: '0.9rem', color: '#666', fontWeight: '600' }}>
                                                    Water Level
                                                </div>
                                            </div>
                                            
                                            {/* Stock Details - DYNAMIC */}
                                            <div style={{ flex: 1, maxWidth: '400px' }}>
                                                <div style={{ 
                                                    background: '#e3f2fd', 
                                                    padding: '1.5rem', 
                                                    borderRadius: '8px',
                                                    marginBottom: '1rem',
                                                    border: '2px solid #90caf9'
                                                }}>
                                                    <h4 style={{ marginBottom: '1rem', color: '#01579b' }}>Current Stock:</h4>
                                                    <div style={{ fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                                                        <strong>ðŸ“¦ Pallets:</strong> {waterStock.currentPallets} / {waterStock.maxPallets} ({percentage}%)
                                                    </div>
                                                    <div style={{ fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                                                        <strong>ðŸ“¦ Boxes:</strong> {currentBoxes.toLocaleString()} / {maxBoxes.toLocaleString()}
                                                    </div>
                                                    <div style={{ fontSize: '1.1rem' }}>
                                                        <strong>ðŸ’§ Bottles:</strong> {currentBottles.toLocaleString()} / {maxBottles.toLocaleString()}
                                                    </div>
                                                </div>
                                                
                                                <div style={{ 
                                                    background: statusBg, 
                                                    padding: '1rem', 
                                                    borderRadius: '8px',
                                                    border: `2px solid ${statusColor}`
                                                }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '1.1rem', fontWeight: 'bold', color: statusColor }}>
                                                        {percentage >= 50 ? 'âœ…' : percentage >= 25 ? 'âš ï¸' : 'ðŸ”´'} Stock Status: <span>{statusText}</span>
                                                    </div>
                                                    <div style={{ fontSize: '0.9rem', marginTop: '0.5rem', color: '#555' }}>
                                                        {percentage >= 50 
                                                            ? 'Above minimum threshold (50%)' 
                                                            : percentage >= 25 
                                                            ? 'Below 50% - consider reordering soon'
                                                            : 'CRITICAL - Reorder immediately!'}
                                                    </div>
                                                </div>
                                                
                                                <div style={{ marginTop: '1.5rem', fontSize: '0.85rem', color: '#666', fontStyle: 'italic' }}>
                                                    ðŸ’¡ Tip: Update stock levels regularly. Warning triggers at 25% ({Math.round(waterStock.maxPallets * 0.25)} pallets remaining).
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                            
                            <h3 style={{ marginBottom: '1rem', marginTop: '1rem' }}>Items in Bulk Storage:</h3>
                            <div className="search-results">
                                {bulkItems.map(item => (
                                    <div key={item.id} className="result-item">
                                        <h3>{item.name}</h3>
                                        <p><strong>Category:</strong> {item.category}</p>
                                        <span className="result-location">ðŸ“¦ Bulk Storage (Pallets)</span>
                                        <span className="result-tag">{item.tag}</span>
                                    </div>
                                ))}
                                {bulkItems.length === 0 && (
                                    <div style={{ textAlign: 'center', padding: '2rem', color: '#999' }}>
                                        No items in bulk storage
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }
            
                // LEVEL 3: Zone view showing individual shelves (e.g., A1, A2, A3, A4, A5, A6)
                if (selectedZone) {
                    const zoneInfo = zones[selectedZone];
                    const shelves = Array.from({ length: zoneInfo.shelves }, (_, i) => `${selectedZone}${i + 1}`);
            
                    return (
                        <div className="storage-map">
                            <button className="back-button" onClick={() => setSelectedZone(null)}>
                                â† Back to Storage Room
                            </button>
                            <h2 className="map-title">{zoneInfo.name}</h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1.5rem' }}>
                                {zoneInfo.description} â€¢ {getZoneItems(selectedZone).length} items total
                            </p>
                            <div className="shelf-grid">
                                {shelves.map(shelf => {
                                    const items = getShelfItems(shelf);
                                    return (
                                        <div
                                            key={shelf}
                                            className="shelf-card"
                                            onClick={() => setSelectedShelf(shelf)}
                                        >
                                            <h4>Shelf {shelf}</h4>
                                            <p style={{ color: 'var(--text-gray)', fontSize: '0.9rem' }}>
                                                {items.length} items
                                            </p>
                                            {items.length > 0 && (
                                                <p style={{ fontSize: '0.85rem', marginTop: '0.5rem', color: 'var(--primary-orange)' }}>
                                                    Click to view â†’
                                                </p>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    );
                }
            
                // LEVEL 1: Full storage room floor plan
                return (
                    <div className="storage-map">
                        <h2 className="map-title">ðŸ›ï¸ WWII Tunnels Storage Room</h2>
                        <p style={{ color: 'var(--text-gray)', marginBottom: '2rem' }}>
                            Click any zone to explore â€¢ Room: 11.5m Ã— 7m
                        </p>
            
                        {/* Edit Mode Toggle */}
                        <div style={{marginBottom: '1rem', display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center'}}>
                            <button
                                onClick={() => setIsEditMode(!isEditMode)}
                                style={{
                                    padding: '0.75rem 1.5rem',
                                    background: isEditMode ? '#4caf50' : '#FF8C42',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
                                }}
                            >
                                {isEditMode ? 'âœ… Edit Mode ON - Drag shelves!' : 'âœï¸ Edit Layout'}
                            </button>
                            
                            {isEditMode && (
                                <>
                                    <button
                                        onClick={saveShelfPositions}
                                        style={{
                                            padding: '0.75rem 1.5rem',
                                            background: '#2196f3',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
                                        }}
                                    >
                                        ðŸ’¾ Save Layout
                                    </button>
                                    
                                    <button
                                        onClick={resetShelfPositions}
                                        style={{
                                            padding: '0.75rem 1.5rem',
                                            background: '#f44336',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
                                        }}
                                    >
                                        ðŸ”„ Reset to Default
                                    </button>
                                </>
                            )}
                        </div>

                        {/* Interactive SVG Storage Map */}
                        <svg 
                            viewBox="0 0 700 1150" 
                            style={{
                                width: '100%', 
                                maxWidth: '600px', 
                                margin: '0 auto 2rem', 
                                display: 'block', 
                                background: 'white', 
                                borderRadius: '8px', 
                                padding: '1rem', 
                                boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
                                cursor: isEditMode ? 'crosshair' : 'default'
                            }}
                            onMouseMove={handleSVGMouseMove}
                            onMouseUp={handleMouseUp}
                            onMouseLeave={handleMouseUp}
                        >
                            {/* Gradients */}
                            <defs>
                                <linearGradient id="shelfGradientA" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style={{stopColor: '#fff3e0', stopOpacity: 1}} />
                                    <stop offset="100%" style={{stopColor: '#ffe0b2', stopOpacity: 1}} />
                                </linearGradient>
                                <linearGradient id="shelfGradientB" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style={{stopColor: '#e8f5e9', stopOpacity: 1}} />
                                    <stop offset="100%" style={{stopColor: '#c8e6c9', stopOpacity: 1}} />
                                </linearGradient>
                                <linearGradient id="shelfGradientC" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style={{stopColor: '#f3e5f5', stopOpacity: 1}} />
                                    <stop offset="100%" style={{stopColor: '#e1bee7', stopOpacity: 1}} />
                                </linearGradient>
                                <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style={{stopColor: '#b3e5fc', stopOpacity: 1}} />
                                    <stop offset="100%" style={{stopColor: '#81d4fa', stopOpacity: 1}} />
                                </linearGradient>
                                <filter id="shadow">
                                    <feDropShadow dx="2" dy="2" stdDeviation="3" floodOpacity="0.3"/>
                                </filter>
                            </defs>
                            
                            {/* Room outline */}
                            <rect x="10" y="10" width="680" height="1130" fill="#f9f9f9" stroke="#333" strokeWidth="3" rx="4"/>
                            
                            {/* Labels */}
                            <text x="350" y="35" textAnchor="middle" fontSize="16" fontWeight="600" fill="#666">
                                BACK WALL (7m)
                            </text>
                            
                            {/* Water Pallets */}
                            <g onClick={() => setSelectedZone('BULK')} style={{cursor: 'pointer'}}>
                                <rect x="20" y="60" width="90" height="950" fill="url(#waterGradient)" stroke="#0288d1" strokeWidth="2" rx="4" filter="url(#shadow)"/>
                                <rect x="24" y="64" width="4" height="942" fill="#01579b" opacity="0.3"/>
                                <text x="65" y="95" textAnchor="middle" fontSize="20" fill="#01579b">ðŸ’§</text>
                                <text x="65" y="118" textAnchor="middle" fontSize="10" fontWeight="600" fill="#01579b">WATER</text>
                                <text x="65" y="130" textAnchor="middle" fontSize="10" fontWeight="600" fill="#01579b">PALLETS</text>
                                <text x="65" y="520" textAnchor="middle" fontSize="11" fontWeight="600" fill="#01579b">
                                    ({getBulkItems().length})
                                </text>
                            </g>
                            
                            {/* Draggable Shelves */}
                            {Object.keys(shelfPositions).map(shelfId => {
                                const pos = shelfPositions[shelfId];
                                const zone = shelfId[0];
                                const colors = {
                                    'A': { grad: 'shelfGradientA', stroke: '#f57c00', text: '#e65100', icon: 'ðŸ›’' },
                                    'B': { grad: 'shelfGradientB', stroke: '#388e3c', text: '#1b5e20', icon: 'ðŸº' },
                                    'C': { grad: 'shelfGradientC', stroke: '#7b1fa2', text: '#4a148c', icon: 'ðŸŽ‰' }
                                };
                                const color = colors[zone];
                                
                                return (
                                    <g 
                                        key={shelfId}
                                        onMouseDown={(e) => handleShelfMouseDown(shelfId, e)}
                                        style={{cursor: isEditMode ? 'move' : 'pointer'}}
                                        opacity={isDragging === shelfId ? 0.7 : 1}
                                    >
                                        <rect 
                                            x={pos.x} 
                                            y={pos.y} 
                                            width="90" 
                                            height="110" 
                                            fill={`url(#${color.grad})`} 
                                            stroke={color.stroke} 
                                            strokeWidth="2" 
                                            rx="4" 
                                            filter="url(#shadow)"
                                        />
                                        <rect x={pos.x + 4} y={pos.y + 4} width="4" height="102" fill={color.text} opacity="0.3"/>
                                        <text x={pos.x + 45} y={pos.y + 60} textAnchor="middle" fontSize="20" fontWeight="700" fill={color.text}>
                                            {shelfId}
                                        </text>
                                        {zone === 'A' && (
                                            <text x={pos.x + 45} y={pos.y + 80} textAnchor="middle" fontSize="12" fill={color.stroke}>
                                                {color.icon}
                                            </text>
                                        )}
                                        {zone === 'B' && (
                                            <text x={pos.x + 45} y={pos.y + 80} textAnchor="middle" fontSize="12" fill={color.stroke}>
                                                {color.icon}
                                            </text>
                                        )}
                                        {zone === 'C' && (
                                            <text x={pos.x + 45} y={pos.y + 80} textAnchor="middle" fontSize="12" fill={color.stroke}>
                                                {color.icon}
                                            </text>
                                        )}
                                    </g>
                                );
                            })}
                            
                            {/* Entrance */}
                            <rect x="10" y="1020" width="680" height="120" fill="white" stroke="#333" strokeWidth="3"/>
                            <text x="350" y="1085" textAnchor="middle" fontSize="18" fontWeight="600" fill="#333">
                                â†‘ ENTRANCE (7m) â†‘
                            </text>
                        </svg>

            
                        {/* Quick Stats */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem'}}>
                            <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #f57c00', cursor: 'pointer'}} onClick={() => setSelectedZone('A')}>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#e65100'}}>{getZoneItems('A').length}</div>
                                <div style={{fontSize: '0.85rem', color: '#e65100'}}>Zone A Items</div>
                            </div>
                            <div style={{background: '#e8f5e9', padding: '1rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #388e3c', cursor: 'pointer'}} onClick={() => setSelectedZone('B')}>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#1b5e20'}}>{getZoneItems('B').length}</div>
                                <div style={{fontSize: '0.85rem', color: '#1b5e20'}}>Zone B Items</div>
                            </div>
                            <div style={{background: '#f3e5f5', padding: '1rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #7b1fa2', cursor: 'pointer'}} onClick={() => setSelectedZone('C')}>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#4a148c'}}>{getZoneItems('C').length}</div>
                                <div style={{fontSize: '0.85rem', color: '#4a148c'}}>Zone C Items</div>
                            </div>
                            <div style={{background: '#b3e5fc', padding: '1rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #0288d1', cursor: 'pointer'}} onClick={() => setSelectedZone('BULK')}>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#01579b'}}>{getBulkItems().length}</div>
                                <div style={{fontSize: '0.85rem', color: '#01579b'}}>Bulk Storage</div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderInbox = () => {
                // Get today's date for comparison
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];
                
                // Helper: Filter out Section C (event items) and Bar Stock from alerts
                const isAlertableItem = (item) => {
                    const location = item.location || '';
                    const category = item.category || '';
                    // Exclude C-location items AND Bar Stock items from alerts
                    return !location.startsWith('C') && category !== 'Bar Stock';
                };
                
                // NEW V1.4 - Filter out hidden items
                const isVisible = (item) => !hiddenAlertItems.includes(item.id);
                
                // Critical alerts - items that need immediate attention
                const allCriticalItems = items.filter(item => {
                    const shopQty = item.quantityShop || 0;
                    const criticalLevel = item.criticalLevel || 5;
                    return isAlertableItem(item) &&
                           shopQty > 0 &&
                           shopQty <= criticalLevel;
                }).sort((a, b) => (a.quantityShop || 0) - (b.quantityShop || 0));
                
                const criticalItems = allCriticalItems.filter(isVisible);
                const hiddenCritical = allCriticalItems.length - criticalItems.length;
                
                // Low stock - needs attention soon
                const allLowStockItems = items.filter(item => {
                    const shopQty = item.quantityShop || 0;
                    const criticalLevel = item.criticalLevel || 5;
                    const warningLevel = item.warningLevel || 10;
                    return isAlertableItem(item) &&
                           shopQty > 0 &&
                           shopQty > criticalLevel &&
                           shopQty <= warningLevel;
                });
                
                const lowStockItems = allLowStockItems.filter(isVisible);
                const hiddenLowStock = allLowStockItems.length - lowStockItems.length;
                
                // Items that need restocking from storage
                const allNeedsRestock = items.filter(item => {
                    const shopQty = item.quantityShop || 0;
                    const storageQty = item.quantityStore || 0;
                    return isAlertableItem(item) &&
                           shopQty > 0 &&
                           shopQty < 5 && 
                           storageQty > 0;
                });
                
                const needsRestock = allNeedsRestock.filter(isVisible);
                const hiddenRestock = allNeedsRestock.length - needsRestock.length;
                
                // Recent shift logs (last 7 days)
                const recentLogs = logs.filter(log => {
                    const logDate = log.date ? log.date.split('T')[0] : '';
                    return logDate >= weekAgo;
                }).slice(0, 5);

                return (
                    <div>
                        <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                            ðŸ“¬ Inbox & Alerts
                        </h2>
                        
                        {/* Critical Alerts */}
                        {criticalItems.length > 0 && (
                            <div className="alert-section" style={{ marginBottom: '1.5rem' }}>
                                <div className="alert-header" style={{ background: '#ffebee' }}>
                                    <span className="alert-icon">ðŸ”´</span>
                                    <h3 className="alert-title" style={{ color: '#c62828' }}>
                                        CRITICAL - Immediate Action Required
                                    </h3>
                                    <span className="alert-count" style={{ background: '#c62828' }}>
                                        {criticalItems.length}{hiddenCritical > 0 && ` (+${hiddenCritical} hidden)`}
                                    </span>
                                </div>
                                <ul className="alert-list">
                                    {criticalItems.map((item, i) => (
                                        <li key={i} className="alert-item" style={{ 
                                            borderLeft: '4px solid #c62828',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '0.75rem'
                                        }}>
                                            <div style={{ flex: 1 }}>
                                                <strong>{item.name}</strong>
                                                <p style={{ fontSize: '0.85rem', marginTop: '0.25rem', color: 'var(--text-gray)' }}>
                                                    Only {item.quantityShop || 0} left in shop â€¢ ðŸ“ {item.location || 'TBD'}
                                                    {(item.quantityStore || 0) > 0 && (
                                                        <span style={{ color: '#4caf50', marginLeft: '0.5rem' }}>
                                                            â€¢ {item.quantityStore} available in storage
                                                        </span>
                                                    )}
                                                </p>
                                            </div>
                                            <div style={{ display: 'flex', gap: '0.5rem', marginLeft: '1rem', flexShrink: 0 }}>
                                                <button
                                                    onClick={() => toggleReorderList(item)}
                                                    style={{
                                                        background: isOnReorderList(item.id) ? '#4caf50' : '#f44336',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.4rem 0.8rem',
                                                        borderRadius: '6px',
                                                        fontSize: '0.75rem',
                                                        cursor: 'pointer',
                                                        fontWeight: '600',
                                                        whiteSpace: 'nowrap'
                                                    }}
                                                >
                                                    {isOnReorderList(item.id) ? 'âœ“ On List' : '+ Reorder'}
                                                </button>
                                                <button
                                                    onClick={() => toggleHideItem(item.id)}
                                                    style={{
                                                        background: '#999',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.4rem 0.8rem',
                                                        borderRadius: '6px',
                                                        fontSize: '0.75rem',
                                                        cursor: 'pointer',
                                                        whiteSpace: 'nowrap'
                                                    }}
                                                >
                                                    ðŸ‘ï¸ Hide
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                        
                        {/* Low Stock Alerts */}
                        {lowStockItems.length > 0 && (
                            <div className="alert-section" style={{ marginBottom: '1.5rem' }}>
                                <div className="alert-header">
                                    <span className="alert-icon">ðŸŸ¡</span>
                                    <h3 className="alert-title">Low Stock - Monitor Closely</h3>
                                    <span className="alert-count" style={{ background: '#ffa500' }}>
                                        {lowStockItems.length}{hiddenLowStock > 0 && ` (+${hiddenLowStock} hidden)`}
                                    </span>
                                </div>
                                <ul className="alert-list">
                                    {(expandedLowStock ? lowStockItems : lowStockItems.slice(0, 5)).map((item, i) => (
                                        <li key={i} className="alert-item warning" style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '0.75rem'
                                        }}>
                                            <div style={{ flex: 1 }}>
                                                <strong>{item.name}</strong>
                                                <p style={{ fontSize: '0.85rem', marginTop: '0.25rem', color: 'var(--text-gray)' }}>
                                                    {item.quantityShop || 0} in shop â€¢ ðŸ“ {item.location || 'TBD'}
                                                </p>
                                            </div>
                                            <div style={{ display: 'flex', gap: '0.5rem', marginLeft: '1rem', flexShrink: 0 }}>
                                                <button
                                                    onClick={() => toggleReorderList(item)}
                                                    style={{
                                                        background: isOnReorderList(item.id) ? '#4caf50' : '#ff9800',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.4rem 0.8rem',
                                                        borderRadius: '6px',
                                                        fontSize: '0.75rem',
                                                        cursor: 'pointer',
                                                        fontWeight: '600',
                                                        whiteSpace: 'nowrap'
                                                    }}
                                                >
                                                    {isOnReorderList(item.id) ? 'âœ“ On List' : '+ Reorder'}
                                                </button>
                                                <button
                                                    onClick={() => toggleHideItem(item.id)}
                                                    style={{
                                                        background: '#999',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.4rem 0.8rem',
                                                        borderRadius: '6px',
                                                        fontSize: '0.75rem',
                                                        cursor: 'pointer',
                                                        whiteSpace: 'nowrap'
                                                    }}
                                                >
                                                    ðŸ‘ï¸ Hide
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                    {lowStockItems.length > 5 && (
                                        <li style={{ padding: '0.75rem', textAlign: 'center' }}>
                                            <button
                                                onClick={() => setExpandedLowStock(!expandedLowStock)}
                                                style={{
                                                    background: '#fff3e0',
                                                    border: '1px solid #ff9800',
                                                    color: '#e65100',
                                                    padding: '0.5rem 1rem',
                                                    borderRadius: '6px',
                                                    fontSize: '0.85rem',
                                                    cursor: 'pointer',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                {expandedLowStock 
                                                    ? 'â–² Show less' 
                                                    : `â–¼ Show all ${lowStockItems.length} items`}
                                            </button>
                                        </li>
                                    )}
                                </ul>
                            </div>
                        )}
                        
                        {/* Transfer from Storage Recommendations */}
                        {needsRestock.length > 0 && (
                            <div className="alert-section" style={{ marginBottom: '1.5rem' }}>
                                <div className="alert-header">
                                    <span className="alert-icon">ðŸ“¦</span>
                                    <h3 className="alert-title">Transfer from Storage to Shop</h3>
                                    <span className="alert-count" style={{ background: '#2196f3' }}>
                                        {needsRestock.length}{hiddenRestock > 0 && ` (+${hiddenRestock} hidden)`}
                                    </span>
                                </div>
                                <ul className="alert-list">
                                    {(expandedRestock ? needsRestock : needsRestock.slice(0, 5)).map((item, i) => (
                                        <li key={i} className="alert-item info" style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '0.75rem'
                                        }}>
                                            <div style={{ flex: 1 }}>
                                                <strong>{item.name}</strong>
                                                <p style={{ fontSize: '0.85rem', marginTop: '0.25rem', color: 'var(--text-gray)' }}>
                                                    Shop: {item.quantityShop || 0} â€¢ Storage: {item.quantityStore || 0} â€¢ ðŸ“ {item.location || 'TBD'}
                                                </p>
                                            </div>
                                            <div style={{ display: 'flex', gap: '0.5rem', marginLeft: '1rem', flexShrink: 0 }}>
                                                <button
                                                    onClick={() => toggleHideItem(item.id)}
                                                    style={{
                                                        background: '#999',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.4rem 0.8rem',
                                                        borderRadius: '6px',
                                                        fontSize: '0.75rem',
                                                        cursor: 'pointer',
                                                        whiteSpace: 'nowrap'
                                                    }}
                                                >
                                                    ðŸ‘ï¸ Hide
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                    {needsRestock.length > 5 && (
                                        <li style={{ padding: '0.75rem', textAlign: 'center' }}>
                                            <button
                                                onClick={() => setExpandedRestock(!expandedRestock)}
                                                style={{
                                                    background: '#e3f2fd',
                                                    border: '1px solid #2196f3',
                                                    color: '#1565c0',
                                                    padding: '0.5rem 1rem',
                                                    borderRadius: '6px',
                                                    fontSize: '0.85rem',
                                                    cursor: 'pointer',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                {expandedRestock 
                                                    ? 'â–² Show less' 
                                                    : `â–¼ Show all ${needsRestock.length} items`}
                                            </button>
                                        </li>
                                    )}
                                </ul>
                            </div>
                        )}
                        
                        {/* Show Hidden Items Button */}
                        {hiddenAlertItems.length > 0 && (
                            <div style={{ marginBottom: '1.5rem', textAlign: 'center' }}>
                                <button
                                    onClick={() => {
                                        if (confirm(`Unhide all ${hiddenAlertItems.length} hidden items?`)) {
                                            setHiddenAlertItems([]);
                                            localStorage.removeItem('hiddenAlertItems');
                                        }
                                    }}
                                    style={{
                                        background: '#f5f5f5',
                                        border: '1px dashed #999',
                                        color: '#666',
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '6px',
                                        fontSize: '0.9rem',
                                        cursor: 'pointer'
                                    }}
                                >
                                    ðŸ‘ï¸ {hiddenAlertItems.length} items hidden - Click to unhide all
                                </button>
                            </div>
                        )}
                        
                        {/* Recent Activity - Shift Logs - NEW V1.6.1: Grouped by Week */}
                        {recentLogs.length > 0 && (
                            <div className="alert-section" style={{ marginBottom: '1.5rem' }}>
                                <div className="alert-header">
                                    <span className="alert-icon">ðŸ“</span>
                                    <h3 className="alert-title">Recent Staff Notes</h3>
                                    <span className="alert-count" style={{ background: '#9c27b0' }}>{recentLogs.length}</span>
                                </div>
                                
                                {/* Group notes by week */}
                                {(() => {
                                    // Helper to get week label
                                    const getWeekLabel = (date) => {
                                        const logDate = new Date(date);
                                        const today = new Date();
                                        const daysDiff = Math.floor((today - logDate) / (1000 * 60 * 60 * 24));
                                        
                                        if (daysDiff < 7) return 'This Week';
                                        if (daysDiff < 14) return 'Last Week';
                                        if (daysDiff < 21) return '2 Weeks Ago';
                                        if (daysDiff < 28) return '3 Weeks Ago';
                                        return 'Older';
                                    };
                                    
                                    // Group logs by week
                                    const groupedByWeek = recentLogs.reduce((acc, log) => {
                                        const weekLabel = getWeekLabel(log.date);
                                        if (!acc[weekLabel]) acc[weekLabel] = [];
                                        acc[weekLabel].push(log);
                                        return acc;
                                    }, {});
                                    
                                    // Week order
                                    const weekOrder = ['This Week', 'Last Week', '2 Weeks Ago', '3 Weeks Ago', 'Older'];
                                    const sortedWeeks = weekOrder.filter(week => groupedByWeek[week]);
                                    
                                    const toggleWeek = (week) => {
                                        setCollapsedNoteWeeks({
                                            ...collapsedNoteWeeks,
                                            [week]: !collapsedNoteWeeks[week]
                                        });
                                    };
                                    
                                    return (
                                        <div style={{ display: 'grid', gap: '0.5rem' }}>
                                            {sortedWeeks.map(week => {
                                                const weekLogs = groupedByWeek[week];
                                                const isCollapsed = collapsedNoteWeeks[week];
                                                
                                                return (
                                                    <div 
                                                        key={week}
                                                        style={{
                                                            border: '1px solid #e0e0e0',
                                                            borderRadius: '8px',
                                                            overflow: 'hidden',
                                                            background: 'white'
                                                        }}
                                                    >
                                                        {/* Week Header */}
                                                        <div 
                                                            onClick={() => toggleWeek(week)}
                                                            style={{
                                                                background: '#f3e5f5',
                                                                padding: '0.75rem 1rem',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                justifyContent: 'space-between',
                                                                alignItems: 'center',
                                                                borderBottom: isCollapsed ? 'none' : '1px solid #e0e0e0'
                                                            }}
                                                        >
                                                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                                                <span style={{ fontSize: '1rem', fontWeight: 'bold' }}>
                                                                    {isCollapsed ? 'â–¶' : 'â–¼'}
                                                                </span>
                                                                <h4 style={{ 
                                                                    color: '#9c27b0',
                                                                    margin: 0,
                                                                    fontSize: '0.95rem',
                                                                    fontWeight: '600'
                                                                }}>
                                                                    ðŸ“… {week}
                                                                </h4>
                                                                <span style={{ 
                                                                    fontSize: '0.8rem', 
                                                                    color: '#666',
                                                                    background: 'white',
                                                                    padding: '0.15rem 0.5rem',
                                                                    borderRadius: '10px'
                                                                }}>
                                                                    {weekLogs.length} note{weekLogs.length !== 1 ? 's' : ''}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* Week Notes */}
                                                        {!isCollapsed && (
                                                            <ul className="alert-list" style={{ margin: 0 }}>
                                                                {weekLogs.map((log, i) => (
                                                                    <li key={i} style={{ 
                                                                        padding: '0.75rem 1rem', 
                                                                        borderLeft: 'none',
                                                                        borderBottom: i < weekLogs.length - 1 ? '1px solid #f0f0f0' : 'none'
                                                                    }}>
                                                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                                                            <strong style={{ fontSize: '0.9rem', color: '#333' }}>
                                                                                {log.staffName}
                                                                            </strong>
                                                                            <span style={{ fontSize: '0.75rem', color: '#999' }}>
                                                                                {new Date(log.date).toLocaleDateString('en-GB', { 
                                                                                    month: 'short', 
                                                                                    day: 'numeric' 
                                                                                })}
                                                                            </span>
                                                                        </div>
                                                                        <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                                            {log.selling && (
                                                                                <div style={{ marginBottom: '0.25rem' }}>
                                                                                    <strong>Selling:</strong> {log.selling.slice(0, 100)}
                                                                                    {log.selling.length > 100 && '...'}
                                                                                </div>
                                                                            )}
                                                                            {log.requests && (
                                                                                <div style={{ marginBottom: '0.25rem' }}>
                                                                                    <strong>Requests:</strong> {log.requests.slice(0, 100)}
                                                                                    {log.requests.length > 100 && '...'}
                                                                                </div>
                                                                            )}
                                                                            {log.issues && (
                                                                                <div style={{ color: '#f44336' }}>
                                                                                    <strong>Issues:</strong> {log.issues.slice(0, 100)}
                                                                                    {log.issues.length > 100 && '...'}
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    );
                                })()}
                            </div>
                        )}
                        
                        {/* All Clear Message */}
                        {criticalItems.length === 0 && lowStockItems.length === 0 && needsRestock.length === 0 && (
                            <div className="alert-section">
                                <div style={{ padding: '2rem', textAlign: 'center', color: 'var(--text-gray)' }}>
                                    <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>âœ…</div>
                                    <h3 style={{ color: '#4caf50', marginBottom: '0.5rem' }}>All Clear!</h3>
                                    <p>No urgent alerts at this time. Everything looks good.</p>
                                </div>
                            </div>
                        )}
                        
                        {/* NEW V1.6 - Activity History Section */}
                        <div style={{ marginTop: '2rem', paddingTop: '2rem', borderTop: '2px solid var(--border-gray)' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem', flexWrap: 'wrap', gap: '0.5rem' }}>
                                <h2 style={{ color: 'var(--primary-black)', margin: 0 }}>
                                    ðŸ“Š Activity History
                                </h2>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    {/* NEW V1.6.1 - Retroactive Generation Button - V1.6.2: Always visible */}
                                    <button
                                        onClick={generateRetroactiveActivities}
                                        style={{
                                            background: '#ff9800',
                                            color: 'white',
                                            border: 'none',
                                            padding: '0.5rem 1rem',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            fontSize: '0.85rem',
                                            fontWeight: '600'
                                        }}
                                    >
                                        ðŸ”„ Generate Recent History
                                    </button>
                                    <button
                                        onClick={() => setShowActivityHistory(!showActivityHistory)}
                                        style={{
                                            background: showActivityHistory ? '#666' : '#2196f3',
                                            color: 'white',
                                            border: 'none',
                                            padding: '0.5rem 1rem',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            fontSize: '0.85rem',
                                            fontWeight: '600'
                                        }}
                                    >
                                        {showActivityHistory ? 'â–² Hide History' : 'â–¼ Show Full History'}
                                    </button>
                                </div>
                            </div>
                            
                            {showActivityHistory && (
                                <>
                                    {/* Filters */}
                                    <div style={{
                                        background: '#f5f5f5',
                                        padding: '1rem',
                                        borderRadius: '8px',
                                        marginBottom: '1rem',
                                        display: 'grid',
                                        gap: '1rem',
                                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))'
                                    }}>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: '600' }}>
                                                Filter by Type:
                                            </label>
                                            <select
                                                value={activityFilter}
                                                onChange={(e) => setActivityFilter(e.target.value)}
                                                style={{
                                                    width: '100%',
                                                    padding: '0.5rem',
                                                    border: '1px solid #ddd',
                                                    borderRadius: '4px',
                                                    fontSize: '0.9rem'
                                                }}
                                            >
                                                <option value="all">All Activities</option>
                                                <option value="stock_change">Stock Changes</option>
                                                <option value="item_edit">Item Edits</option>
                                                <option value="item_delete">Item Deletions</option>
                                                <option value="reorder_add">Reorder Additions</option>
                                                <option value="reorder_remove">Reorder Removals</option>
                                                <option value="note_edit">Note Changes</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: '600' }}>
                                                Time Period:
                                            </label>
                                            <select
                                                value={activityDateRange}
                                                onChange={(e) => setActivityDateRange(e.target.value)}
                                                style={{
                                                    width: '100%',
                                                    padding: '0.5rem',
                                                    border: '1px solid #ddd',
                                                    borderRadius: '4px',
                                                    fontSize: '0.9rem'
                                                }}
                                            >
                                                <option value="today">Today</option>
                                                <option value="7days">Last 7 Days</option>
                                                <option value="30days">Last 30 Days</option>
                                                <option value="all">All Time</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: '600' }}>
                                                Search:
                                            </label>
                                            <input
                                                type="text"
                                                value={activitySearch}
                                                onChange={(e) => setActivitySearch(e.target.value)}
                                                placeholder="Search activities..."
                                                style={{
                                                    width: '100%',
                                                    padding: '0.5rem',
                                                    border: '1px solid #ddd',
                                                    borderRadius: '4px',
                                                    fontSize: '0.9rem'
                                                }}
                                            />
                                        </div>
                                    </div>
                                    
                                    {/* Activity Log Display */}
                                    {(() => {
                                        // Filter activities
                                        const now = Date.now();
                                        const oneDayMs = 24 * 60 * 60 * 1000;
                                        
                                        let filtered = activityLogs.filter(activity => {
                                            // Type filter
                                            if (activityFilter !== 'all' && activity.type !== activityFilter) return false;
                                            
                                            // Date filter
                                            const activityTime = activity.timestamp || 0;
                                            if (activityDateRange === 'today' && (now - activityTime) > oneDayMs) return false;
                                            if (activityDateRange === '7days' && (now - activityTime) > 7 * oneDayMs) return false;
                                            if (activityDateRange === '30days' && (now - activityTime) > 30 * oneDayMs) return false;
                                            
                                            // Search filter
                                            if (activitySearch) {
                                                const searchLower = activitySearch.toLowerCase();
                                                const matchesDescription = activity.description?.toLowerCase().includes(searchLower);
                                                const matchesItemName = activity.details?.itemName?.toLowerCase().includes(searchLower);
                                                if (!matchesDescription && !matchesItemName) return false;
                                            }
                                            
                                            return true;
                                        });
                                        
                                        // Get activity icon and color
                                        const getActivityIcon = (type) => {
                                            switch(type) {
                                                case 'stock_change': return 'ðŸ“¦';
                                                case 'item_edit': return 'âœï¸';
                                                case 'item_delete': return 'ðŸ—‘ï¸';
                                                case 'reorder_add': return 'âž•';
                                                case 'reorder_remove': return 'âž–';
                                                case 'note_edit': return 'ðŸ’¬';
                                                default: return 'ðŸ“Š';
                                            }
                                        };
                                        
                                        const getActivityColor = (type) => {
                                            switch(type) {
                                                case 'stock_change': return '#2196f3';
                                                case 'item_edit': return '#ff9800';
                                                case 'item_delete': return '#f44336';
                                                case 'reorder_add': return '#4caf50';
                                                case 'reorder_remove': return '#666';
                                                case 'note_edit': return '#9c27b0';
                                                default: return '#666';
                                            }
                                        };
                                        
                                        if (filtered.length === 0) {
                                            return (
                                                <div style={{ textAlign: 'center', padding: '2rem', color: '#666' }}>
                                                    <p>No activity found matching filters.</p>
                                                </div>
                                            );
                                        }
                                        
                                        return (
                                            <div style={{ display: 'grid', gap: '0.5rem', maxHeight: '500px', overflowY: 'auto' }}>
                                                {filtered.map((activity, index) => {
                                                    const activityDate = new Date(activity.date || activity.timestamp);
                                                    const isToday = activityDate.toDateString() === new Date().toDateString();
                                                    const timeString = activityDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                                                    const dateString = isToday ? 'Today' : activityDate.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' });
                                                    
                                                    return (
                                                        <div
                                                            key={activity.id || index}
                                                            style={{
                                                                background: 'white',
                                                                padding: '0.75rem 1rem',
                                                                borderRadius: '6px',
                                                                border: '1px solid #e0e0e0',
                                                                borderLeft: `4px solid ${getActivityColor(activity.type)}`,
                                                                display: 'flex',
                                                                alignItems: 'start',
                                                                gap: '0.75rem'
                                                            }}
                                                        >
                                                            <span style={{ fontSize: '1.2rem' }}>{getActivityIcon(activity.type)}</span>
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{ fontSize: '0.9rem', color: '#333', marginBottom: '0.25rem' }}>
                                                                    <strong>{activity.description}</strong>
                                                                </div>
                                                                {activity.details?.changes && (
                                                                    <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '0.25rem' }}>
                                                                        {activity.details.changes}
                                                                    </div>
                                                                )}
                                                                <div style={{ fontSize: '0.75rem', color: '#999' }}>
                                                                    {dateString} at {timeString} â€¢ {activity.user || 'Staff'}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        );
                                    })()}
                                </>
                            )}
                        </div>
                    </div>
                );
            };

            const renderStockCount = () => {
                const totalItems = items.length;
                const countedCount = countedItems.size;
                const progress = (countedCount / totalItems) * 100;

                // Get unique categories
                const categories = ['All', ...new Set(items.map(item => item.category))];

                // Filter items by category AND search query
                const filteredItems = items.filter(item => {
                    // Category filter
                    const categoryMatch = selectedCategory === 'All' || item.category === selectedCategory;
                    
                    // Search filter (checks name and category)
                    const searchMatch = !stockCountSearch || 
                        item.name.toLowerCase().includes(stockCountSearch.toLowerCase()) ||
                        (item.category && item.category.toLowerCase().includes(stockCountSearch.toLowerCase()));
                    
                    return categoryMatch && searchMatch;
                });

                const handleQuantityChange = (itemId, type, value) => {
                    setQuantities(prev => ({
                        ...prev,
                        [itemId]: {
                            ...(prev[itemId] || {}),
                            [type]: value
                        }
                    }));
                };

                const handleMarkCounted = async (itemId) => {
                    const shopQty = parseInt(quantities[itemId]?.shop) || 0;
                    const storageQty = parseInt(quantities[itemId]?.storage) || 0;
                    const item = items.find(i => i.id === itemId);
                    
                    if (item) {
                        // Save to Firebase with separate shop and storage quantities
                        const updatedItem = {
                            ...item,
                            quantityShop: shopQty,
                            quantityStore: storageQty,
                            quantity: shopQty + storageQty,
                            lastRestocked: new Date().toISOString().split('T')[0],
                            lastCounted: new Date().toISOString().split('T')[0] // Track when counted
                        };
                        
                        const success = await saveItemToFirebase(updatedItem);
                        
                        if (success) {
                            // Mark as counted locally (will also be updated via Firebase listener)
                            const newCounted = new Set(countedItems);
                            newCounted.add(itemId);
                            setCountedItems(newCounted);
                            
                            // Clear quantities for this item
                            setQuantities(prev => {
                                const newQ = {...prev};
                                delete newQ[itemId];
                                return newQ;
                            });
                        }
                    }
                };

                return (
                    <div>
                        {/* Progress Section */}
                        <div className="stock-count-container" style={{ marginBottom: '1.5rem' }}>
                            <h2 style={{ marginBottom: '0.5rem', color: 'var(--primary-black)' }}>
                                ðŸ“Š Stock Count Progress
                            </h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1rem', fontSize: '1.1rem' }}>
                                {countedCount} of {totalItems} items counted ({Math.round(progress)}%)
                            </p>
                            <div className="progress-bar">
                                <div className="progress-fill" style={{ width: `${progress}%` }}></div>
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', marginTop: '1.5rem' }}>
                                <div style={{ background: 'var(--light-gray)', padding: '1rem', borderRadius: '8px', textAlign: 'center' }}>
                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: 'var(--primary-orange)' }}>
                                        {countedCount}
                                    </div>
                                    <div style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.25rem' }}>
                                        Items Counted
                                    </div>
                                </div>
                                <div style={{ background: 'var(--light-gray)', padding: '1rem', borderRadius: '8px', textAlign: 'center' }}>
                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: 'var(--primary-black)' }}>
                                        {totalItems - countedCount}
                                    </div>
                                    <div style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.25rem' }}>
                                        Remaining
                                    </div>
                                </div>
                                <div style={{ background: 'var(--light-gray)', padding: '1rem', borderRadius: '8px', textAlign: 'center' }}>
                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#4CAF50' }}>
                                        {Math.round(progress)}%
                                    </div>
                                    <div style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.25rem' }}>
                                        Complete
                                    </div>
                                </div>
                            </div>
                            
                            {/* Reset Count Button */}
                            {countedCount > 0 && (
                                <div style={{ marginTop: '1.5rem', textAlign: 'center' }}>
                                    <button
                                        onClick={() => {
                                            if (confirm('Reset all counted items? This will clear today\'s count status but keep the quantities you entered.')) {
                                                setCountedItems(new Set());
                                            }
                                        }}
                                        style={{
                                            padding: '0.75rem 1.5rem',
                                            background: '#f44336',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '0.95rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        ðŸ”„ Start New Count
                                    </button>
                                    <p style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                                        (Quantities are saved, only count status will reset)
                                    </p>
                                </div>
                            )}
                        </div>

                        {/* Search Bar - NEW FEATURE */}
                        <div className="stock-count-container" style={{ marginBottom: '1.5rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸ” Search Items
                            </h3>
                            <input
                                type="text"
                                className="search-box"
                                placeholder="Search by item name or category..."
                                value={stockCountSearch}
                                onChange={(e) => setStockCountSearch(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '0.75rem 1rem',
                                    fontSize: '1rem',
                                    border: '2px solid var(--border-gray)',
                                    borderRadius: '8px',
                                    marginBottom: '0'
                                }}
                            />
                            {stockCountSearch && (
                                <div style={{ 
                                    marginTop: '0.5rem', 
                                    fontSize: '0.9rem', 
                                    color: 'var(--text-gray)' 
                                }}>
                                    Found {filteredItems.length} items matching "{stockCountSearch}"
                                    <button
                                        onClick={() => setStockCountSearch('')}
                                        style={{
                                            marginLeft: '1rem',
                                            padding: '0.25rem 0.75rem',
                                            background: '#f44336',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '4px',
                                            fontSize: '0.85rem',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Clear
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Filter Section */}
                        <div className="stock-count-container" style={{ marginBottom: '1.5rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸ” Filter by Category
                            </h3>
                            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => setSelectedCategory(cat)}
                                        style={{
                                            padding: '0.5rem 1rem',
                                            border: selectedCategory === cat ? '2px solid var(--primary-orange)' : '2px solid var(--border-gray)',
                                            background: selectedCategory === cat ? 'var(--primary-orange)' : 'white',
                                            color: selectedCategory === cat ? 'white' : 'var(--primary-black)',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            fontWeight: selectedCategory === cat ? '600' : '400',
                                            fontSize: '0.9rem',
                                            transition: 'all 0.3s'
                                        }}
                                    >
                                        {cat}
                                        {cat !== 'All' && (
                                            <span style={{ 
                                                marginLeft: '0.5rem', 
                                                opacity: 0.8,
                                                fontSize: '0.85rem'
                                            }}>
                                                ({items.filter(item => item.category === cat).length})
                                            </span>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Items List */}
                        <div className="stock-count-container">
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                <h3 style={{ color: 'var(--primary-black)' }}>
                                    ðŸ“¦ Items to Count
                                </h3>
                                <p style={{ color: 'var(--text-gray)', fontSize: '0.9rem' }}>
                                    Showing {filteredItems.length} items
                                </p>
                            </div>

                            {filteredItems.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">ðŸ“¦</div>
                                    <p>No items in this category</p>
                                </div>
                            ) : (
                                <div>
                                    {filteredItems.map(item => (
                                        <div 
                                            key={item.id} 
                                            className="count-item"
                                            style={{
                                                background: countedItems.has(item.id) ? '#e8f5e9' : 'var(--light-gray)',
                                                borderLeft: countedItems.has(item.id) ? '4px solid #4CAF50' : '4px solid var(--border-gray)'
                                            }}
                                        >
                                            <div style={{ flex: 1 }}>
                                                <strong style={{ fontSize: '1rem' }}>{item.name}</strong>
                                                <p style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.25rem' }}>
                                                    <span style={{ 
                                                        background: 'var(--primary-black)', 
                                                        color: 'white', 
                                                        padding: '0.15rem 0.5rem', 
                                                        borderRadius: '3px',
                                                        fontSize: '0.8rem',
                                                        marginRight: '0.5rem'
                                                    }}>
                                                        {item.category}
                                                    </span>
                                                    {item.tag && (
                                                        <span style={{ 
                                                            background: 'var(--primary-orange)', 
                                                            color: 'white', 
                                                            padding: '0.15rem 0.5rem', 
                                                            borderRadius: '3px',
                                                            fontSize: '0.8rem',
                                                            marginRight: '0.5rem'
                                                        }}>
                                                            {item.tag}
                                                        </span>
                                                    )}
                                                    {item.location && (
                                                        <span>ðŸ“ {item.location}</span>
                                                    )}
                                                    {!item.location && (
                                                        <span style={{ opacity: 0.6 }}>ðŸ“ Location TBD</span>
                                                    )}
                                                </p>
                                                <p style={{ fontSize: '0.9rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                                                    Current: ðŸª {item.quantityShop || 0} in shop â€¢ ðŸ“¦ {item.quantityStore || 0} in storage â€¢ Total: {(item.quantityShop || 0) + (item.quantityStore || 0)}
                                                </p>
                                            </div>
                                            <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', flexWrap: 'wrap' }}>
                                                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                                                    <label style={{ fontSize: '0.75rem', color: 'var(--text-gray)', marginBottom: '0.25rem' }}>
                                                        Shop Qty
                                                    </label>
                                                    <input
                                                        type="number"
                                                        className="count-input"
                                                        placeholder="0"
                                                        min="0"
                                                        value={quantities[item.id]?.shop !== undefined ? quantities[item.id].shop : ''}
                                                        onChange={(e) => handleQuantityChange(item.id, 'shop', e.target.value)}
                                                        disabled={countedItems.has(item.id)}
                                                        style={{
                                                            opacity: countedItems.has(item.id) ? 0.6 : 1,
                                                            width: '80px'
                                                        }}
                                                    />
                                                </div>
                                                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                                                    <label style={{ fontSize: '0.75rem', color: 'var(--text-gray)', marginBottom: '0.25rem' }}>
                                                        Storage Qty
                                                    </label>
                                                    <input
                                                        type="number"
                                                        className="count-input"
                                                        placeholder="0"
                                                        min="0"
                                                        value={quantities[item.id]?.storage !== undefined ? quantities[item.id].storage : ''}
                                                        onChange={(e) => handleQuantityChange(item.id, 'storage', e.target.value)}
                                                        disabled={countedItems.has(item.id)}
                                                        style={{
                                                            opacity: countedItems.has(item.id) ? 0.6 : 1,
                                                            width: '80px'
                                                        }}
                                                    />
                                                </div>
                                                <button
                                                    onClick={() => openEditModal(item)}
                                                    style={{
                                                        background: '#2196f3',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.5rem 1rem',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        fontSize: '0.85rem',
                                                        whiteSpace: 'nowrap',
                                                        fontWeight: '600'
                                                    }}
                                                >
                                                    âœï¸ Edit
                                                </button>
                                                {item.quantityStore > 0 && !countedItems.has(item.id) && (
                                                    <button
                                                        onClick={() => {
                                                            setTransferItem(item);
                                                            setTransferQty(0);
                                                        }}
                                                        style={{
                                                            background: '#ff9800',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.5rem 1rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem',
                                                            whiteSpace: 'nowrap'
                                                        }}
                                                    >
                                                        â†”ï¸ Transfer
                                                    </button>
                                                )}
                                                <button
                                                    className="count-button"
                                                    onClick={() => handleMarkCounted(item.id)}
                                                    disabled={countedItems.has(item.id)}
                                                    style={{
                                                        opacity: countedItems.has(item.id) ? 0.6 : 1,
                                                        cursor: countedItems.has(item.id) ? 'not-allowed' : 'pointer',
                                                        background: countedItems.has(item.id) ? '#4CAF50' : 'var(--primary-orange)',
                                                        minWidth: '120px'
                                                    }}
                                                >
                                                    {countedItems.has(item.id) ? 'âœ“ Counted' : 'Mark Counted'}
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderShiftLog = () => {
                return (
                    <div>
                        {/* Add New Log Button */}
                        <div style={{ marginBottom: '2rem' }}>
                            <button
                                onClick={() => setShowAddLog(!showAddLog)}
                                style={{
                                    background: 'var(--primary-orange)',
                                    color: 'white',
                                    border: 'none',
                                    padding: '1rem 2rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                                }}
                            >
                                âž• Add New Shift Log
                            </button>
                        </div>

                        {/* Add Log Form */}
                        {showAddLog && (
                            <div className="stock-count-container" style={{ marginBottom: '2rem', background: '#f0f8ff' }}>
                                <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                    ðŸ“ New Shift Log Entry
                                </h3>
                                <div style={{ display: 'grid', gap: '1rem' }}>
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Your Name:
                                        </label>
                                        <input
                                            type="text"
                                            value={newLog.staffName}
                                            onChange={(e) => setNewLog({...newLog, staffName: e.target.value})}
                                            placeholder="Enter your name"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '1rem'
                                            }}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            ðŸ’° What's selling well today?
                                        </label>
                                        <textarea
                                            value={newLog.selling}
                                            onChange={(e) => setNewLog({...newLog, selling: e.target.value})}
                                            placeholder="e.g., Spitfire magnets - sold 20 units this morning"
                                            rows="3"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '0.95rem',
                                                resize: 'vertical'
                                            }}
                                        />
                                    </div>

                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            ðŸ™‹ Customer requests/questions:
                                        </label>
                                        <textarea
                                            value={newLog.requests}
                                            onChange={(e) => setNewLog({...newLog, requests: e.target.value})}
                                            placeholder="e.g., 3 customers asked for Gibraltar flag patches"
                                            rows="3"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '0.95rem',
                                                resize: 'vertical'
                                            }}
                                        />
                                    </div>

                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            ðŸ’¬ Price feedback from customers:
                                        </label>
                                        <textarea
                                            value={newLog.priceFeedback}
                                            onChange={(e) => setNewLog({...newLog, priceFeedback: e.target.value})}
                                            placeholder="e.g., Customer said caps too expensive"
                                            rows="2"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '0.95rem',
                                                resize: 'vertical'
                                            }}
                                        />
                                    </div>

                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            âš ï¸ Issues or notes:
                                        </label>
                                        <textarea
                                            value={newLog.issues}
                                            onChange={(e) => setNewLog({...newLog, issues: e.target.value})}
                                            placeholder="e.g., Barcode scanner running slow, shelf needs restocking"
                                            rows="2"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '0.95rem',
                                                resize: 'vertical'
                                            }}
                                        />
                                    </div>

                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            ðŸ·ï¸ Link to specific items (optional):
                                        </label>
                                        
                                        {/* Search box */}
                                        <input
                                            type="text"
                                            value={itemSearchQuery}
                                            onChange={(e) => setItemSearchQuery(e.target.value)}
                                            placeholder="ðŸ” Search items to link..."
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                fontSize: '0.95rem',
                                                marginBottom: '0.5rem'
                                            }}
                                        />
                                        
                                        {/* Selected items as removable chips */}
                                        {newLog.linkedItems.length > 0 && (
                                            <div style={{ 
                                                display: 'flex', 
                                                gap: '0.5rem', 
                                                flexWrap: 'wrap',
                                                marginBottom: '0.5rem',
                                                padding: '0.5rem',
                                                background: '#f5f5f5',
                                                borderRadius: '6px'
                                            }}>
                                                {newLog.linkedItems.map(itemId => {
                                                    const item = items.find(i => i.id === itemId);
                                                    return item ? (
                                                        <span
                                                            key={itemId}
                                                            style={{
                                                                background: '#9c27b0',
                                                                color: 'white',
                                                                padding: '0.5rem 0.75rem',
                                                                borderRadius: '16px',
                                                                fontSize: '0.85rem',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '0.5rem'
                                                            }}
                                                        >
                                                            {item.name}
                                                            <button
                                                                onClick={() => {
                                                                    setNewLog({
                                                                        ...newLog,
                                                                        linkedItems: newLog.linkedItems.filter(id => id !== itemId)
                                                                    });
                                                                }}
                                                                style={{
                                                                    background: 'rgba(255,255,255,0.3)',
                                                                    border: 'none',
                                                                    color: 'white',
                                                                    borderRadius: '50%',
                                                                    width: '20px',
                                                                    height: '20px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '0.9rem',
                                                                    padding: 0
                                                                }}
                                                            >
                                                                Ã—
                                                            </button>
                                                        </span>
                                                    ) : null;
                                                })}
                                            </div>
                                        )}
                                        
                                        {/* Filtered items to select */}
                                        {itemSearchQuery && (
                                            <div style={{
                                                maxHeight: '200px',
                                                overflowY: 'auto',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '6px',
                                                marginTop: '0.5rem'
                                            }}>
                                                {items
                                                    .filter(item => 
                                                        item.name.toLowerCase().includes(itemSearchQuery.toLowerCase()) ||
                                                        item.category.toLowerCase().includes(itemSearchQuery.toLowerCase())
                                                    )
                                                    .sort((a, b) => a.name.localeCompare(b.name))
                                                    .slice(0, 20)
                                                    .map(item => {
                                                        const isSelected = newLog.linkedItems.includes(item.id);
                                                        return (
                                                            <div
                                                                key={item.id}
                                                                onClick={() => {
                                                                    if (isSelected) {
                                                                        setNewLog({
                                                                            ...newLog,
                                                                            linkedItems: newLog.linkedItems.filter(id => id !== item.id)
                                                                        });
                                                                    } else {
                                                                        setNewLog({
                                                                            ...newLog,
                                                                            linkedItems: [...newLog.linkedItems, item.id]
                                                                        });
                                                                    }
                                                                }}
                                                                style={{
                                                                    padding: '0.75rem',
                                                                    cursor: 'pointer',
                                                                    background: isSelected ? '#f3e5f5' : 'white',
                                                                    borderBottom: '1px solid #eee',
                                                                    display: 'flex',
                                                                    justifyContent: 'space-between',
                                                                    alignItems: 'center'
                                                                }}
                                                            >
                                                                <div>
                                                                    <strong>{item.name}</strong>
                                                                    <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                                        {item.category} {item.location && `â€¢ ${item.location}`}
                                                                    </div>
                                                                </div>
                                                                {isSelected && (
                                                                    <span style={{ color: '#9c27b0', fontSize: '1.2rem' }}>âœ“</span>
                                                                )}
                                                            </div>
                                                        );
                                                    })
                                                }
                                                {items.filter(item => 
                                                    item.name.toLowerCase().includes(itemSearchQuery.toLowerCase()) ||
                                                    item.category.toLowerCase().includes(itemSearchQuery.toLowerCase())
                                                ).length === 0 && (
                                                    <div style={{ padding: '1rem', textAlign: 'center', color: '#666' }}>
                                                        No items found
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        <p style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                                            Search and click items to link them. Notes will appear when you search for these items.
                                        </p>
                                    </div>

                                    <div style={{ display: 'flex', gap: '1rem' }}>
                                        <button
                                            onClick={async () => {
                                                if (!newLog.staffName.trim()) {
                                                    alert('Please enter your name');
                                                    return;
                                                }
                                                
                                                try {
                                                    const logEntry = {
                                                        ...newLog,
                                                        date: new Date().toISOString(),
                                                        timestamp: Date.now()
                                                    };
                                                    
                                                    // Save to Firebase
                                                    await window.db.collection('shiftLogs').add(logEntry);
                                                    console.log('âœ… Shift log saved to Firebase');
                                                    
                                                    setNewLog({
                                                        staffName: '',
                                                        selling: '',
                                                        requests: '',
                                                        priceFeedback: '',
                                                        issues: '',
                                                        linkedItems: []
                                                    });
                                                    setItemSearchQuery('');
                                                    setShowAddLog(false);
                                                    alert('âœ… Shift log saved and synced!');
                                                } catch (error) {
                                                    console.error('âŒ Save error:', error);
                                                    alert('âŒ Failed to save log: ' + error.message);
                                                }
                                            }}
                                            style={{
                                                background: '#4CAF50',
                                                color: 'white',
                                                border: 'none',
                                                padding: '0.75rem 1.5rem',
                                                borderRadius: '6px',
                                                cursor: 'pointer',
                                                fontWeight: '600'
                                            }}
                                        >
                                            âœ“ Save Log
                                        </button>
                                        <button
                                            onClick={() => {
                                                setNewLog({
                                                    staffName: '',
                                                    selling: '',
                                                    requests: '',
                                                    priceFeedback: '',
                                                    issues: '',
                                                    linkedItems: []
                                                });
                                                setItemSearchQuery('');
                                                setShowAddLog(false);
                                            }}
                                            style={{
                                                background: 'var(--text-gray)',
                                                color: 'white',
                                                border: 'none',
                                                padding: '0.75rem 1.5rem',
                                                borderRadius: '6px',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Shift Log History */}
                        <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                            ðŸ“‹ Shift Log History
                        </h2>

                        {logs.length === 0 && (
                            <div style={{ textAlign: 'center', padding: '3rem', color: 'var(--text-gray)' }}>
                                <p>No shift logs yet. Click "Add New Shift Log" to create one.</p>
                            </div>
                        )}

                        {logs.map((log, index) => {
                            const logDate = new Date(log.date);
                            const formattedDate = logDate.toLocaleDateString('en-GB', { 
                                weekday: 'short', 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric' 
                            });
                            const formattedTime = logDate.toLocaleTimeString('en-GB', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            });
                            
                            return (
                                <div key={log.timestamp || index} className="stock-count-container" style={{ marginBottom: '1.5rem' }}>
                                    <div style={{ 
                                        borderBottom: '2px solid var(--border-gray)', 
                                        paddingBottom: '0.75rem',
                                        marginBottom: '1rem',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <div>
                                            <h3 style={{ color: 'var(--primary-black)', marginBottom: '0.25rem' }}>
                                                {formattedDate} at {formattedTime}
                                            </h3>
                                            <p style={{ color: 'var(--text-gray)', fontSize: '0.9rem' }}>
                                                Staff: {log.staffName}
                                            </p>
                                        </div>
                                        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                            {index === 0 && (
                                                <span style={{
                                                    background: 'var(--primary-orange)',
                                                    color: 'white',
                                                    padding: '0.25rem 0.75rem',
                                                    borderRadius: '12px',
                                                    fontSize: '0.85rem',
                                                    fontWeight: '600'
                                                }}>
                                                    ðŸ”´ Latest
                                                </span>
                                            )}
                                            <button
                                                onClick={() => {
                                                    setEditingLogIndex(index);
                                                    setEditLog({...log});
                                                    setItemSearchQuery('');
                                                }}
                                                style={{
                                                    background: '#2196f3',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.5rem 0.75rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.85rem',
                                                    fontWeight: '600',
                                                    marginRight: '0.5rem'
                                                }}
                                            >
                                                âœï¸ Edit
                                            </button>
                                            <button
                                                onClick={async () => {
                                                    if (confirm('Delete this shift log? This will sync to all devices.')) {
                                                        try {
                                                            await window.db.collection('shiftLogs').doc(log.id).delete();
                                                            console.log('ðŸ—‘ï¸ Shift log deleted from Firebase');
                                                            alert('âœ… Log deleted and synced!');
                                                        } catch (error) {
                                                            console.error('âŒ Delete error:', error);
                                                            alert('âŒ Failed to delete log: ' + error.message);
                                                        }
                                                    }
                                                }}
                                                style={{
                                                    background: '#f44336',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.5rem 0.75rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.85rem',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                ðŸ—‘ï¸ Delete
                                            </button>
                                        </div>
                                    </div>

                                    {/* If editing this log, show edit form */}
                                    {editingLogIndex === index ? (
                                        <div style={{ background: '#f0f8ff', padding: '1.5rem', borderRadius: '8px', marginTop: '1rem' }}>
                                            <h4 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>âœï¸ Editing Log</h4>
                                            
                                            <div style={{ display: 'grid', gap: '1rem' }}>
                                                <div>
                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                        Your Name:
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={editLog.staffName}
                                                        onChange={(e) => setEditLog({...editLog, staffName: e.target.value})}
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.75rem',
                                                            border: '2px solid var(--border-gray)',
                                                            borderRadius: '6px',
                                                            fontSize: '1rem'
                                                        }}
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                        ðŸ’° What's selling well:
                                                    </label>
                                                    <textarea
                                                        value={editLog.selling}
                                                        onChange={(e) => setEditLog({...editLog, selling: e.target.value})}
                                                        rows="3"
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.75rem',
                                                            border: '2px solid var(--border-gray)',
                                                            borderRadius: '6px',
                                                            fontSize: '0.95rem',
                                                            resize: 'vertical'
                                                        }}
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                        ðŸ™‹ Customer requests:
                                                    </label>
                                                    <textarea
                                                        value={editLog.requests}
                                                        onChange={(e) => setEditLog({...editLog, requests: e.target.value})}
                                                        rows="3"
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.75rem',
                                                            border: '2px solid var(--border-gray)',
                                                            borderRadius: '6px',
                                                            fontSize: '0.95rem',
                                                            resize: 'vertical'
                                                        }}
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                        ðŸ’¬ Price feedback:
                                                    </label>
                                                    <textarea
                                                        value={editLog.priceFeedback}
                                                        onChange={(e) => setEditLog({...editLog, priceFeedback: e.target.value})}
                                                        rows="2"
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.75rem',
                                                            border: '2px solid var(--border-gray)',
                                                            borderRadius: '6px',
                                                            fontSize: '0.95rem',
                                                            resize: 'vertical'
                                                        }}
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                        âš ï¸ Issues or notes:
                                                    </label>
                                                    <textarea
                                                        value={editLog.issues}
                                                        onChange={(e) => setEditLog({...editLog, issues: e.target.value})}
                                                        rows="2"
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.75rem',
                                                            border: '2px solid var(--border-gray)',
                                                            borderRadius: '6px',
                                                            fontSize: '0.95rem',
                                                            resize: 'vertical'
                                                        }}
                                                    />
                                                </div>
                                                
                                                <div style={{ display: 'flex', gap: '1rem' }}>
                                                    <button
                                                        onClick={async () => {
                                                            try {
                                                                const log = logs[index];
                                                                await window.db.collection('shiftLogs').doc(log.id).update(editLog);
                                                                console.log('âœ… Shift log updated in Firebase');
                                                                setEditingLogIndex(null);
                                                                setEditLog(null);
                                                                alert('âœ… Log updated and synced!');
                                                            } catch (error) {
                                                                console.error('âŒ Update error:', error);
                                                                alert('âŒ Failed to update log: ' + error.message);
                                                            }
                                                        }}
                                                        style={{
                                                            background: '#4CAF50',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.75rem 1.5rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontWeight: '600'
                                                        }}
                                                    >
                                                        âœ“ Save Changes
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setEditingLogIndex(null);
                                                            setEditLog(null);
                                                        }}
                                                        style={{
                                                            background: 'var(--text-gray)',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.75rem 1.5rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            {/* Normal log display */}
                                            {log.selling && (
                                                <div style={{ marginBottom: '1rem' }}>
                                                    <strong style={{ color: '#4CAF50', fontSize: '0.95rem' }}>ðŸ’° Selling Well:</strong>
                                                    <p style={{ marginTop: '0.5rem', color: 'var(--text-gray)', paddingLeft: '1.5rem' }}>
                                                        {log.selling}
                                                    </p>
                                                </div>
                                            )}

                                            {log.requests && (
                                                <div style={{ marginBottom: '1rem' }}>
                                                    <strong style={{ color: 'var(--primary-orange)', fontSize: '0.95rem' }}>ðŸ™‹ Customer Requests:</strong>
                                                    <p style={{ marginTop: '0.5rem', color: 'var(--text-gray)', paddingLeft: '1.5rem' }}>
                                                        {log.requests}
                                                    </p>
                                                </div>
                                            )}

                                            {log.priceFeedback && (
                                                <div style={{ marginBottom: '1rem' }}>
                                                    <strong style={{ color: '#2196F3', fontSize: '0.95rem' }}>ðŸ’¬ Price Feedback:</strong>
                                                    <p style={{ marginTop: '0.5rem', color: 'var(--text-gray)', paddingLeft: '1.5rem' }}>
                                                        {log.priceFeedback}
                                                    </p>
                                                </div>
                                            )}

                                            {log.issues && (
                                                <div style={{ marginBottom: '1rem' }}>
                                                    <strong style={{ color: '#f44336', fontSize: '0.95rem' }}>âš ï¸ Issues/Notes:</strong>
                                                    <p style={{ marginTop: '0.5rem', color: 'var(--text-gray)', paddingLeft: '1.5rem' }}>
                                                        {log.issues}
                                                    </p>
                                                </div>
                                            )}
                                    
                                            {log.linkedItems && log.linkedItems.length > 0 && (
                                                <div style={{ marginBottom: '1rem' }}>
                                                    <strong style={{ color: '#9c27b0', fontSize: '0.95rem' }}>ðŸ·ï¸ Related Items:</strong>
                                                    <div style={{ marginTop: '0.5rem', paddingLeft: '1.5rem', display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                                                        {log.linkedItems.map(itemId => {
                                                            const item = items.find(i => i.id === itemId);
                                                            return item ? (
                                                                <span 
                                                                    key={itemId}
                                                                    style={{
                                                                        background: 'var(--light-gray)',
                                                                        padding: '0.25rem 0.75rem',
                                                                        borderRadius: '12px',
                                                                        fontSize: '0.85rem',
                                                                        color: 'var(--primary-black)'
                                                                    }}
                                                                >
                                                                    {item.name}
                                                                </span>
                                                            ) : null;
                                                        })}
                                                    </div>
                                                </div>
                                            )}
                                        </>
                                    )}
                                </div>
                            );
                        })}
                        
                        {/* REORDER LIST SECTION */}
                        <div style={{ marginTop: '3rem', paddingTop: '2rem', borderTop: '2px solid var(--border-gray)' }}>
                            <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                                ðŸ“‹ Reorder List
                            </h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1.5rem' }}>
                                Items marked for reordering from suppliers.
                            </p>
                            
                            {reorderList.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: '3rem', color: 'var(--text-gray)' }}>
                                    <p>No items on reorder list yet.</p>
                                    <p style={{ fontSize: '0.9rem', marginTop: '0.5rem' }}>
                                        Use the "ðŸ“‹ Reorder" button in Search results to add items here.
                                    </p>
                                </div>
                            ) : (
                                <>
                                    <div style={{ marginBottom: '1rem', display: 'flex', gap: '1rem', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap' }}>
                                        <p style={{ color: '#666', margin: 0 }}>
                                            <strong>{reorderList.length}</strong> items to order
                                        </p>
                                        <div style={{ display: 'flex', gap: '1rem' }}>
                                            <button
                                                onClick={() => {
                                                    setShowRestockMode(!showRestockMode);
                                                    if (!showRestockMode) {
                                                        // Initialize restock items from reorder list
                                                        const initialRestock = {};
                                                        reorderList.forEach(item => {
                                                            initialRestock[item.id] = { shopQty: 0, storageQty: 0 };
                                                        });
                                                        setRestockItems(initialRestock);
                                                    }
                                                }}
                                                style={{
                                                    background: showRestockMode ? '#666' : '#4caf50',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.5rem 1rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.85rem',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                {showRestockMode ? 'âœ• Cancel Restock' : 'ðŸ“¦ Restock Items'}
                                            </button>
                                            <button
                                                onClick={() => {
                                                    if (confirm('Clear all items from reorder list?')) {
                                                        setReorderList([]);
                                                    }
                                                }}
                                                style={{
                                                    background: '#f44336',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.5rem 1rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.85rem'
                                                }}
                                            >
                                                Clear List
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* RESTOCK MODE */}
                                    {showRestockMode && (
                                        <div style={{
                                            background: '#e8f5e9',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '3px solid #4caf50',
                                            marginBottom: '2rem'
                                        }}>
                                            <h3 style={{ color: '#2e7d32', marginBottom: '1rem' }}>
                                                ðŸ“¦ Restock Items
                                            </h3>
                                            <p style={{ color: '#666', marginBottom: '1.5rem' }}>
                                                Enter quantities received for each item. You can add to Shop, Storage, or both.
                                            </p>
                                            
                                            <div style={{ display: 'grid', gap: '1rem', marginBottom: '1.5rem' }}>
                                                {reorderList.map((item) => {
                                                    const fullItem = items.find(i => i.id === item.id);
                                                    if (!fullItem) return null;
                                                    
                                                    return (
                                                        <div 
                                                            key={item.id}
                                                            style={{
                                                                background: 'white',
                                                                padding: '1rem',
                                                                borderRadius: '8px',
                                                                border: '2px solid #ddd'
                                                            }}
                                                        >
                                                            <h4 style={{ marginBottom: '0.75rem', color: '#333' }}>
                                                                {item.name}
                                                            </h4>
                                                            <p style={{ fontSize: '0.85rem', color: '#666', marginBottom: '1rem' }}>
                                                                Current: Shop {fullItem.quantityShop || 0} | Storage {fullItem.quantityStore || 0}
                                                            </p>
                                                            
                                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                                                <div>
                                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '600' }}>
                                                                        ðŸª Add to Shop:
                                                                    </label>
                                                                    <input
                                                                        type="number"
                                                                        min="0"
                                                                        value={restockItems[item.id]?.shopQty || 0}
                                                                        onChange={(e) => {
                                                                            setRestockItems({
                                                                                ...restockItems,
                                                                                [item.id]: {
                                                                                    ...restockItems[item.id],
                                                                                    shopQty: parseInt(e.target.value) || 0
                                                                                }
                                                                            });
                                                                        }}
                                                                        style={{
                                                                            width: '100%',
                                                                            padding: '0.5rem',
                                                                            border: '2px solid #ddd',
                                                                            borderRadius: '6px',
                                                                            fontSize: '1rem'
                                                                        }}
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '600' }}>
                                                                        ðŸ“¦ Add to Storage:
                                                                    </label>
                                                                    <input
                                                                        type="number"
                                                                        min="0"
                                                                        value={restockItems[item.id]?.storageQty || 0}
                                                                        onChange={(e) => {
                                                                            setRestockItems({
                                                                                ...restockItems,
                                                                                [item.id]: {
                                                                                    ...restockItems[item.id],
                                                                                    storageQty: parseInt(e.target.value) || 0
                                                                                }
                                                                            });
                                                                        }}
                                                                        style={{
                                                                            width: '100%',
                                                                            padding: '0.5rem',
                                                                            border: '2px solid #ddd',
                                                                            borderRadius: '6px',
                                                                            fontSize: '1rem'
                                                                        }}
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            
                                            <div style={{ display: 'flex', gap: '1rem' }}>
                                                <button
                                                    onClick={async () => {
                                                        // Apply restock updates
                                                        let updatedCount = 0;
                                                        const updates = [];
                                                        
                                                        for (const [itemId, quantities] of Object.entries(restockItems)) {
                                                            const shopAdd = quantities.shopQty || 0;
                                                            const storageAdd = quantities.storageQty || 0;
                                                            
                                                            if (shopAdd > 0 || storageAdd > 0) {
                                                                const item = items.find(i => i.id === itemId);
                                                                if (item) {
                                                                    const newShopQty = (item.quantityShop || 0) + shopAdd;
                                                                    const newStorageQty = (item.quantityStore || 0) + storageAdd;
                                                                    const newTotalQty = newShopQty + newStorageQty;
                                                                    
                                                                    await saveItemToFirebase({
                                                                        ...item,
                                                                        quantityShop: newShopQty,
                                                                        quantityStore: newStorageQty,
                                                                        quantity: newTotalQty,
                                                                        lastRestocked: new Date().toISOString().split('T')[0]
                                                                    });
                                                                    
                                                                    updates.push({
                                                                        name: item.name,
                                                                        shopAdd,
                                                                        storageAdd,
                                                                        newShop: newShopQty,
                                                                        newStorage: newStorageQty
                                                                    });
                                                                    updatedCount++;
                                                                }
                                                            }
                                                        }
                                                        
                                                        if (updatedCount === 0) {
                                                            alert('âš ï¸ Please enter quantities to restock.');
                                                            return;
                                                        }
                                                        
                                                        // Wait for Firebase sync
                                                        await new Promise(resolve => setTimeout(resolve, 1500));
                                                        
                                                        let message = `âœ… Restock complete!\n\n${updatedCount} items updated:\n\n`;
                                                        message += updates.map(u => 
                                                            `${u.name}:\n  Shop: +${u.shopAdd} â†’ ${u.newShop}\n  Storage: +${u.storageAdd} â†’ ${u.newStorage}`
                                                        ).join('\n\n');
                                                        message += '\n\nðŸ“Š Quantities updated in Search and Analytics.';
                                                        
                                                        if (confirm(message + '\n\nRemove restocked items from reorder list?')) {
                                                            // Remove restocked items from Firebase reorder list
                                                            const restockedIds = Object.keys(restockItems).filter(id => {
                                                                const qty = restockItems[id];
                                                                return (qty.shopQty || 0) > 0 || (qty.storageQty || 0) > 0;
                                                            });
                                                            
                                                            // Delete from Firebase using batch
                                                            try {
                                                                const batch = window.db.batch();
                                                                restockedIds.forEach(id => {
                                                                    batch.delete(window.db.collection('reorderList').doc(id));
                                                                });
                                                                await batch.commit();
                                                                console.log(`ðŸ—‘ï¸ Removed ${restockedIds.length} items from reorder list`);
                                                            } catch (error) {
                                                                console.error('âŒ Error removing from reorder list:', error);
                                                            }
                                                        }
                                                        
                                                        // Reset restock mode
                                                        setShowRestockMode(false);
                                                        setRestockItems({});
                                                    }}
                                                    style={{
                                                        flex: 1,
                                                        background: '#4caf50',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.75rem 1.5rem',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        fontWeight: '600',
                                                        fontSize: '1rem'
                                                    }}
                                                >
                                                    âœ“ Apply Restock
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setShowRestockMode(false);
                                                        setRestockItems({});
                                                    }}
                                                    style={{
                                                        flex: 1,
                                                        background: '#666',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.75rem 1.5rem',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* NEW V1.5 - GROUPED BY SUPPLIER VIEW */}
                                    {(() => {
                                        // Group items by supplier
                                        const groupedBySupplier = reorderList.reduce((acc, item) => {
                                            const supplier = item.supplier && item.supplier.trim() !== '' && item.supplier !== 'TBD' 
                                                ? item.supplier 
                                                : 'â“ No Supplier Set';
                                            if (!acc[supplier]) acc[supplier] = [];
                                            acc[supplier].push(item);
                                            return acc;
                                        }, {});
                                        
                                        // Sort suppliers: named suppliers first alphabetically, then "No Supplier Set"
                                        const sortedSuppliers = Object.keys(groupedBySupplier).sort((a, b) => {
                                            if (a === 'â“ No Supplier Set') return 1;
                                            if (b === 'â“ No Supplier Set') return -1;
                                            return a.localeCompare(b);
                                        });
                                        
                                        const toggleSupplier = (supplier) => {
                                            setCollapsedSuppliers({
                                                ...collapsedSuppliers,
                                                [supplier]: !collapsedSuppliers[supplier]
                                            });
                                        };
                                        
                                        const copySupplierList = (supplier, items) => {
                                            const text = `${supplier} - Order List\n\n` + 
                                                items.map(item => `â€¢ ${item.name} (Current: ${item.currentQty}, Critical: ${item.criticalLevel})`).join('\n');
                                            navigator.clipboard.writeText(text);
                                            alert(`ðŸ“‹ Copied ${items.length} items for ${supplier} to clipboard!`);
                                        };
                                        
                                        return (
                                            <div style={{ display: 'grid', gap: '1.5rem' }}>
                                                {/* Summary Stats */}
                                                <div style={{
                                                    background: '#f5f5f5',
                                                    padding: '1rem',
                                                    borderRadius: '8px',
                                                    display: 'flex',
                                                    gap: '2rem',
                                                    flexWrap: 'wrap'
                                                }}>
                                                    <div>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#333' }}>
                                                            {sortedSuppliers.length}
                                                        </div>
                                                        <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                            Suppliers
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#f44336' }}>
                                                            {reorderList.filter(item => {
                                                                const fullItem = items.find(i => i.id === item.id);
                                                                return fullItem && getAlertLevel(fullItem) === 'critical';
                                                            }).length}
                                                        </div>
                                                        <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                            Critical Items
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#ff9800' }}>
                                                            {reorderList.filter(item => {
                                                                const supplier = item.supplier;
                                                                return !supplier || supplier.trim() === '' || supplier === 'TBD';
                                                            }).length}
                                                        </div>
                                                        <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                                            Need Supplier
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {/* Supplier Groups */}
                                                {sortedSuppliers.map(supplier => {
                                                    const supplierItems = groupedBySupplier[supplier];
                                                    const isCollapsed = collapsedSuppliers[supplier];
                                                    const criticalCount = supplierItems.filter(item => {
                                                        const fullItem = items.find(i => i.id === item.id);
                                                        return fullItem && getAlertLevel(fullItem) === 'critical';
                                                    }).length;
                                                    
                                                    return (
                                                        <div 
                                                            key={supplier}
                                                            style={{
                                                                border: '2px solid #ddd',
                                                                borderRadius: '12px',
                                                                overflow: 'hidden',
                                                                background: 'white'
                                                            }}
                                                        >
                                                            {/* Supplier Header */}
                                                            <div 
                                                                onClick={() => toggleSupplier(supplier)}
                                                                style={{
                                                                    background: supplier === 'â“ No Supplier Set' ? '#fff3e0' : '#e3f2fd',
                                                                    padding: '1rem 1.5rem',
                                                                    cursor: 'pointer',
                                                                    display: 'flex',
                                                                    justifyContent: 'space-between',
                                                                    alignItems: 'center',
                                                                    borderBottom: isCollapsed ? 'none' : '2px solid #ddd'
                                                                }}
                                                            >
                                                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                                                    <span style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#333' }}>
                                                                        {isCollapsed ? 'â–¶' : 'â–¼'}
                                                                    </span>
                                                                    <div>
                                                                        <h3 style={{ 
                                                                            color: supplier === 'â“ No Supplier Set' ? '#e65100' : '#1976d2',
                                                                            margin: 0,
                                                                            fontSize: '1.1rem'
                                                                        }}>
                                                                            {supplier === 'â“ No Supplier Set' ? 'ðŸ¢' : 'ðŸ“¦'} {supplier}
                                                                        </h3>
                                                                        <p style={{ 
                                                                            margin: '0.25rem 0 0 0', 
                                                                            fontSize: '0.85rem', 
                                                                            color: '#666' 
                                                                        }}>
                                                                            {supplierItems.length} item{supplierItems.length !== 1 ? 's' : ''}
                                                                            {criticalCount > 0 && (
                                                                                <span style={{ color: '#f44336', marginLeft: '0.5rem', fontWeight: 'bold' }}>
                                                                                    â€¢ {criticalCount} critical
                                                                                </span>
                                                                            )}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                
                                                                {!isCollapsed && supplier !== 'â“ No Supplier Set' && (
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            copySupplierList(supplier, supplierItems);
                                                                        }}
                                                                        style={{
                                                                            background: '#4caf50',
                                                                            color: 'white',
                                                                            border: 'none',
                                                                            padding: '0.5rem 1rem',
                                                                            borderRadius: '6px',
                                                                            cursor: 'pointer',
                                                                            fontSize: '0.85rem',
                                                                            fontWeight: '600'
                                                                        }}
                                                                    >
                                                                        ðŸ“‹ Copy List
                                                                    </button>
                                                                )}
                                                            </div>
                                                            
                                                            {/* Supplier Items */}
                                                            {!isCollapsed && (
                                                                <div style={{ padding: '1rem', display: 'grid', gap: '1rem' }}>
                                                                    {supplierItems.map((item) => {
                                                                        const fullItem = items.find(i => i.id === item.id);
                                                                        const alertLevel = fullItem ? getAlertLevel(fullItem) : 'warning';
                                                                        
                                                                        return (
                                                                            <div 
                                                                                key={item.id}
                                                                                style={{
                                                                                    background: '#f9f9f9',
                                                                                    padding: '1rem',
                                                                                    borderRadius: '8px',
                                                                                    borderLeft: `4px solid ${alertLevel === 'critical' ? '#f44336' : '#ff9800'}`
                                                                                }}
                                                                            >
                                                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                                                                    <div style={{ flex: 1 }}>
                                                                                        <h4 style={{ color: '#333', marginBottom: '0.5rem', fontSize: '1rem' }}>
                                                                                            {alertLevel === 'critical' && 'ðŸ”´ '}
                                                                                            {item.name}
                                                                                        </h4>
                                                                                        <div style={{ display: 'grid', gap: '0.25rem', fontSize: '0.85rem', color: '#666' }}>
                                                                                            <p><strong>Category:</strong> {item.category}</p>
                                                                                            <p>
                                                                                                <strong>Stock:</strong> {item.currentQty} 
                                                                                                <span style={{ color: alertLevel === 'critical' ? '#f44336' : '#ff9800', marginLeft: '0.5rem' }}>
                                                                                                    (Critical: {item.criticalLevel})
                                                                                                </span>
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', marginLeft: '1rem' }}>
                                                                                        <button
                                                                                            onClick={() => openEditModal(fullItem || item)}
                                                                                            style={{
                                                                                                background: '#2196f3',
                                                                                                color: 'white',
                                                                                                border: 'none',
                                                                                                padding: '0.4rem 0.8rem',
                                                                                                borderRadius: '6px',
                                                                                                cursor: 'pointer',
                                                                                                fontSize: '0.8rem',
                                                                                                whiteSpace: 'nowrap'
                                                                                            }}
                                                                                        >
                                                                                            âœï¸ Edit
                                                                                        </button>
                                                                                        <button
                                                                                            onClick={() => toggleReorderList(fullItem || item)}
                                                                                            style={{
                                                                                                background: '#f44336',
                                                                                                color: 'white',
                                                                                                border: 'none',
                                                                                                padding: '0.4rem 0.8rem',
                                                                                                borderRadius: '6px',
                                                                                                cursor: 'pointer',
                                                                                                fontSize: '0.8rem',
                                                                                                whiteSpace: 'nowrap'
                                                                                            }}
                                                                                        >
                                                                                            âœ• Remove
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        );
                                                                    })}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        );
                                    })()}
                                    
                                    <div style={{ 
                                        marginTop: '1.5rem',
                                        padding: '1rem',
                                        background: '#f5f5f5',
                                        borderRadius: '8px'
                                    }}>
                                        <p style={{ margin: 0, fontSize: '0.9rem', color: '#666' }}>
                                            ðŸ’¡ <strong>Tip:</strong> Take a screenshot of this list or write down items before ordering from suppliers.
                                        </p>
                                    </div>
                                </>
                            )}
                        </div>
                        
                        {/* TRANSFER STOCK SECTION */}
                        <div style={{ marginTop: '3rem', paddingTop: '2rem', borderTop: '2px solid var(--border-gray)' }}>
                            <div style={{ marginBottom: '1.5rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem' }}>
                                <div>
                                    <h2 style={{ marginBottom: '0.5rem', color: 'var(--primary-black)' }}>
                                        â†—ï¸ Transfer Stock to Shop
                                    </h2>
                                    <p style={{ color: 'var(--text-gray)', margin: 0 }}>
                                        Move items from storage to the shop floor.
                                    </p>
                                </div>
                                <button
                                    onClick={() => {
                                        setShowTransferMode(!showTransferMode);
                                        if (!showTransferMode) {
                                            // Initialize transfer items
                                            const initialTransfer = {};
                                            items.filter(i => (i.quantityStore || 0) > 0).forEach(item => {
                                                initialTransfer[item.id] = 0;
                                            });
                                            setTransferItems(initialTransfer);
                                        }
                                    }}
                                    style={{
                                        background: showTransferMode ? '#666' : '#ff9800',
                                        color: 'white',
                                        border: 'none',
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '0.95rem',
                                        fontWeight: '600'
                                    }}
                                >
                                    {showTransferMode ? 'âœ• Cancel' : 'â†—ï¸ Transfer Mode'}
                                </button>
                            </div>
                            
                            {!showTransferMode ? (
                                <div style={{ textAlign: 'center', padding: '2rem', background: '#f5f5f5', borderRadius: '8px' }}>
                                    <p style={{ color: '#666', marginBottom: '0.5rem' }}>
                                        Click "â†—ï¸ Transfer Mode" to move items from storage to shop floor.
                                    </p>
                                    <p style={{ fontSize: '0.85rem', color: '#999' }}>
                                        {items.filter(i => (i.quantityStore || 0) > 0).length} items in storage
                                    </p>
                                </div>
                            ) : (
                                <div style={{
                                    background: '#fff3e0',
                                    padding: '1.5rem',
                                    borderRadius: '12px',
                                    border: '3px solid #ff9800'
                                }}>
                                    <h3 style={{ color: '#e65100', marginBottom: '1rem' }}>
                                        â†—ï¸ Transfer Items to Shop Floor
                                    </h3>
                                    <p style={{ color: '#666', marginBottom: '1.5rem' }}>
                                        Enter quantities to move from storage to shop. Items with 0 in storage are not shown.
                                    </p>
                                    
                                    {(() => {
                                        const itemsWithStorage = items.filter(i => (i.quantityStore || 0) > 0)
                                            .sort((a, b) => a.name.localeCompare(b.name));
                                        
                                        if (itemsWithStorage.length === 0) {
                                            return (
                                                <div style={{ textAlign: 'center', padding: '2rem', background: 'white', borderRadius: '8px' }}>
                                                    <p style={{ color: '#666' }}>No items in storage to transfer.</p>
                                                </div>
                                            );
                                        }
                                        
                                        return (
                                            <>
                                                <div style={{ marginBottom: '1rem', padding: '0.75rem', background: '#e3f2fd', borderRadius: '6px' }}>
                                                    <p style={{ fontSize: '0.9rem', margin: 0, color: '#1565c0' }}>
                                                        <strong>ðŸ“Š Quick Stats:</strong> {itemsWithStorage.length} items in storage | 
                                                        Total: {itemsWithStorage.reduce((sum, i) => sum + (i.quantityStore || 0), 0)} units
                                                    </p>
                                                </div>
                                                
                                                <div style={{ 
                                                    display: 'grid', 
                                                    gap: '0.75rem', 
                                                    marginBottom: '1.5rem',
                                                    maxHeight: '500px',
                                                    overflowY: 'auto',
                                                    padding: '0.5rem'
                                                }}>
                                                    {itemsWithStorage.map((item) => {
                                                        const storageQty = item.quantityStore || 0;
                                                        const transferQty = transferItems[item.id] || 0;
                                                        
                                                        return (
                                                            <div 
                                                                key={item.id}
                                                                style={{
                                                                    background: 'white',
                                                                    padding: '1rem',
                                                                    borderRadius: '8px',
                                                                    border: transferQty > 0 ? '2px solid #ff9800' : '2px solid #ddd',
                                                                    display: 'grid',
                                                                    gridTemplateColumns: '1fr auto',
                                                                    gap: '1rem',
                                                                    alignItems: 'center'
                                                                }}
                                                            >
                                                                <div>
                                                                    <h4 style={{ marginBottom: '0.5rem', color: '#333' }}>
                                                                        {item.name}
                                                                    </h4>
                                                                    <p style={{ fontSize: '0.85rem', color: '#666', margin: 0 }}>
                                                                        ðŸª Shop: {item.quantityShop || 0} | 
                                                                        ðŸ“¦ Storage: <strong>{storageQty}</strong>
                                                                        {transferQty > 0 && (
                                                                            <span style={{ color: '#ff9800', marginLeft: '0.5rem' }}>
                                                                                â†’ Will move: {transferQty}
                                                                            </span>
                                                                        )}
                                                                    </p>
                                                                </div>
                                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                                    <input
                                                                        type="number"
                                                                        min="0"
                                                                        max={storageQty}
                                                                        value={transferQty}
                                                                        onChange={(e) => {
                                                                            const value = parseInt(e.target.value) || 0;
                                                                            const clamped = Math.min(value, storageQty);
                                                                            setTransferItems({
                                                                                ...transferItems,
                                                                                [item.id]: clamped
                                                                            });
                                                                        }}
                                                                        placeholder="0"
                                                                        style={{
                                                                            width: '80px',
                                                                            padding: '0.5rem',
                                                                            border: '2px solid #ddd',
                                                                            borderRadius: '6px',
                                                                            fontSize: '1rem',
                                                                            textAlign: 'center'
                                                                        }}
                                                                    />
                                                                    <button
                                                                        onClick={() => {
                                                                            setTransferItems({
                                                                                ...transferItems,
                                                                                [item.id]: storageQty
                                                                            });
                                                                        }}
                                                                        style={{
                                                                            background: '#e0e0e0',
                                                                            border: 'none',
                                                                            padding: '0.5rem 0.75rem',
                                                                            borderRadius: '6px',
                                                                            cursor: 'pointer',
                                                                            fontSize: '0.8rem',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        title="Transfer all"
                                                                    >
                                                                        All
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                                
                                                <div style={{ display: 'flex', gap: '1rem' }}>
                                                    <button
                                                        onClick={async () => {
                                                            // Apply transfer updates
                                                            let updatedCount = 0;
                                                            const updates = [];
                                                            
                                                            for (const [itemId, quantity] of Object.entries(transferItems)) {
                                                                if (quantity > 0) {
                                                                    const item = items.find(i => i.id === itemId);
                                                                    if (item) {
                                                                        const storageQty = item.quantityStore || 0;
                                                                        
                                                                        // Validate
                                                                        if (quantity > storageQty) {
                                                                            alert(`âŒ Cannot transfer ${quantity} of "${item.name}" - only ${storageQty} in storage!`);
                                                                            return;
                                                                        }
                                                                        
                                                                        const newShopQty = (item.quantityShop || 0) + quantity;
                                                                        const newStorageQty = storageQty - quantity;
                                                                        
                                                                        await saveItemToFirebase({
                                                                            ...item,
                                                                            quantityShop: newShopQty,
                                                                            quantityStore: newStorageQty
                                                                            // Total stays the same - just moving between locations
                                                                        });
                                                                        
                                                                        updates.push({
                                                                            name: item.name,
                                                                            transferred: quantity,
                                                                            newShop: newShopQty,
                                                                            newStorage: newStorageQty
                                                                        });
                                                                        updatedCount++;
                                                                    }
                                                                }
                                                            }
                                                            
                                                            if (updatedCount === 0) {
                                                                alert('âš ï¸ Please enter quantities to transfer.');
                                                                return;
                                                            }
                                                            
                                                            // Wait for Firebase sync
                                                            await new Promise(resolve => setTimeout(resolve, 1500));
                                                            
                                                            let message = `âœ… Stock transfer complete!\n\n${updatedCount} items moved to shop floor:\n\n`;
                                                            message += updates.map(u => 
                                                                `${u.name}:\n  Transferred: ${u.transferred}\n  Shop: ${u.newShop} | Storage: ${u.newStorage}`
                                                            ).join('\n\n');
                                                            message += '\n\nðŸ“Š Quantities updated everywhere.';
                                                            
                                                            alert(message);
                                                            
                                                            // Reset transfer mode
                                                            setShowTransferMode(false);
                                                            setTransferItems({});
                                                        }}
                                                        style={{
                                                            flex: 1,
                                                            background: '#ff9800',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.75rem 1.5rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontWeight: '600',
                                                            fontSize: '1rem'
                                                        }}
                                                    >
                                                        âœ“ Transfer to Shop
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setShowTransferMode(false);
                                                            setTransferItems({});
                                                        }}
                                                        style={{
                                                            flex: 1,
                                                            background: '#666',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.75rem 1.5rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </>
                                        );
                                    })()}
                                </div>
                            )}
                        </div>
                        
                        {/* DISPLAYS SECTION */}
                        <div style={{ marginTop: '3rem', paddingTop: '2rem', borderTop: '2px solid var(--border-gray)' }}>
                            <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                                ðŸ–¼ï¸ Display Photos
                            </h2>
                            <p style={{ color: 'var(--text-gray)', marginBottom: '1.5rem' }}>
                                Upload photos of product displays, arrangements, and visual merchandising.
                            </p>
                            
                            {/* Add Display Button */}
                            <button
                                onClick={() => setShowAddDisplay(!showAddDisplay)}
                                style={{
                                    background: 'var(--primary-orange)',
                                    color: 'white',
                                    border: 'none',
                                    padding: '1rem 2rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    fontWeight: '600',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                    marginBottom: '1.5rem'
                                }}
                            >
                                {showAddDisplay ? 'âœ• Cancel' : 'âž• Add Display Photo'}
                            </button>
                            
                            {/* Add Display Form */}
                            {showAddDisplay && (
                                <div className="stock-count-container" style={{ marginBottom: '2rem', background: '#fff8e1' }}>
                                    <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                        ðŸ“¸ New Display Photo
                                    </h3>
                                    <div style={{ display: 'grid', gap: '1rem' }}>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                Title:
                                            </label>
                                            <input
                                                type="text"
                                                value={newDisplay.title}
                                                onChange={(e) => setNewDisplay({...newDisplay, title: e.target.value})}
                                                placeholder="e.g., Summer Display - Front Window"
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '6px',
                                                    fontSize: '1rem'
                                                }}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                Location:
                                            </label>
                                            <input
                                                type="text"
                                                value={newDisplay.location}
                                                onChange={(e) => setNewDisplay({...newDisplay, location: e.target.value})}
                                                placeholder="e.g., Front Window, Shelf A1, Counter"
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '6px',
                                                    fontSize: '1rem'
                                                }}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                Description:
                                            </label>
                                            <textarea
                                                value={newDisplay.description}
                                                onChange={(e) => setNewDisplay({...newDisplay, description: e.target.value})}
                                                placeholder="Describe the display arrangement..."
                                                rows="3"
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '6px',
                                                    fontSize: '0.95rem',
                                                    resize: 'vertical'
                                                }}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                ðŸ“· Upload Photo:
                                            </label>
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        setUploadingImage(true);
                                                        // Automatic image compression
                                                        const reader = new FileReader();
                                                        reader.onload = (event) => {
                                                            const img = new Image();
                                                            img.onload = () => {
                                                                // Create canvas for compression
                                                                const canvas = document.createElement('canvas');
                                                                let width = img.width;
                                                                let height = img.height;
                                                                
                                                                // Resize if too large (max 800x800)
                                                                const maxSize = 800;
                                                                if (width > maxSize || height > maxSize) {
                                                                    if (width > height) {
                                                                        height = (height / width) * maxSize;
                                                                        width = maxSize;
                                                                    } else {
                                                                        width = (width / height) * maxSize;
                                                                        height = maxSize;
                                                                    }
                                                                }
                                                                
                                                                canvas.width = width;
                                                                canvas.height = height;
                                                                const ctx = canvas.getContext('2d');
                                                                ctx.drawImage(img, 0, 0, width, height);
                                                                
                                                                // Compress to JPEG with quality 0.7
                                                                const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                                                                
                                                                // Check if still too large (>500KB base64 = ~375KB actual)
                                                                if (compressedDataUrl.length > 666666) {
                                                                    // Try again with lower quality
                                                                    const veryCompressed = canvas.toDataURL('image/jpeg', 0.5);
                                                                    if (veryCompressed.length > 666666) {
                                                                        alert('âš ï¸ Image still too large after compression. Try a smaller image.');
                                                                        e.target.value = '';
                                                                        setUploadingImage(false);
                                                                        return;
                                                                    }
                                                                    setNewDisplay({...newDisplay, photo: veryCompressed});
                                                                    setUploadingImage(false);
                                                                } else {
                                                                    setNewDisplay({...newDisplay, photo: compressedDataUrl});
                                                                    setUploadingImage(false);
                                                                }
                                                                
                                                                e.target.value = ''; // Reset input
                                                            };
                                                            img.onerror = () => {
                                                                alert('âŒ Error loading image. Please try a different file.');
                                                                e.target.value = '';
                                                                setUploadingImage(false);
                                                            };
                                                            img.src = event.target.result;
                                                        };
                                                        reader.onerror = () => {
                                                            alert('âŒ Error reading file. Please try again.');
                                                            e.target.value = '';
                                                            setUploadingImage(false);
                                                        };
                                                        reader.readAsDataURL(file);
                                                    }
                                                }}
                                                disabled={uploadingImage}
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '6px',
                                                    fontSize: '0.95rem',
                                                    opacity: uploadingImage ? 0.6 : 1
                                                }}
                                            />
                                            {uploadingImage ? (
                                                <p style={{ fontSize: '0.85rem', color: '#ff9800', marginTop: '0.5rem', fontWeight: 'bold' }}>
                                                    â³ Compressing image, please wait...
                                                </p>
                                            ) : (
                                                <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.5rem' }}>
                                                    âœ¨ Images are automatically compressed. Just upload any photo!
                                                </p>
                                            )}
                                            {newDisplay.photo && (
                                                <div style={{ marginTop: '0.5rem' }}>
                                                    <img 
                                                        src={newDisplay.photo} 
                                                        alt="Preview"
                                                        style={{ 
                                                            maxWidth: '200px', 
                                                            maxHeight: '200px', 
                                                            objectFit: 'cover',
                                                            borderRadius: '8px',
                                                            border: '2px solid var(--border-gray)'
                                                        }}
                                                    />
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div style={{ display: 'flex', gap: '1rem' }}>
                                            <button
                                                onClick={() => {
                                                    if (!newDisplay.title.trim()) {
                                                        alert('Please enter a title for this display');
                                                        return;
                                                    }
                                                    if (!newDisplay.photo) {
                                                        alert('âš ï¸ Please upload a photo first. Wait for compression to complete.');
                                                        return;
                                                    }
                                                    if (uploadingImage) {
                                                        alert('â³ Please wait for image compression to finish');
                                                        return;
                                                    }
                                                    
                                                    const displayEntry = {
                                                        ...newDisplay,
                                                        date: new Date().toISOString(),
                                                        timestamp: Date.now()
                                                    };
                                                    
                                                    try {
                                                        setDisplays([displayEntry, ...displays]);
                                                        setNewDisplay({
                                                            title: '',
                                                            description: '',
                                                            location: '',
                                                            photo: null
                                                        });
                                                        setShowAddDisplay(false);
                                                        alert('âœ… Display photo saved!');
                                                    } catch (e) {
                                                        alert('âŒ Error saving display. Storage might be full. Try a smaller image.');
                                                        console.error(e);
                                                    }
                                                }}
                                                disabled={uploadingImage}
                                                style={{
                                                    background: uploadingImage ? '#ccc' : '#4CAF50',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.75rem 1.5rem',
                                                    borderRadius: '6px',
                                                    cursor: uploadingImage ? 'not-allowed' : 'pointer',
                                                    fontWeight: '600',
                                                    opacity: uploadingImage ? 0.6 : 1
                                                }}
                                            >
                                                {uploadingImage ? 'â³ Processing...' : 'âœ“ Save Display'}
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setNewDisplay({
                                                        title: '',
                                                        description: '',
                                                        location: '',
                                                        photo: null
                                                    });
                                                    setShowAddDisplay(false);
                                                }}
                                                style={{
                                                    background: 'var(--text-gray)',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.75rem 1.5rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Display Gallery */}
                            {displays.length === 0 && !showAddDisplay && (
                                <div style={{ textAlign: 'center', padding: '3rem', color: 'var(--text-gray)' }}>
                                    <p>No display photos yet. Click "Add Display Photo" to create one.</p>
                                </div>
                            )}
                            
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '1.5rem' }}>
                                {displays.map((display, index) => {
                                    const displayDate = new Date(display.date);
                                    const formattedDate = displayDate.toLocaleDateString('en-GB', { 
                                        year: 'numeric', 
                                        month: 'short', 
                                        day: 'numeric' 
                                    });
                                    
                                    return (
                                        <div key={display.timestamp || index} className="stock-count-container" style={{ position: 'relative' }}>
                                            <img 
                                                src={display.photo} 
                                                alt={display.title}
                                                onClick={() => window.open(display.photo, '_blank')}
                                                style={{ 
                                                    width: '100%', 
                                                    height: '200px', 
                                                    objectFit: 'cover',
                                                    borderRadius: '8px 8px 0 0',
                                                    cursor: 'pointer',
                                                    marginBottom: '1rem'
                                                }}
                                            />
                                            
                                            <button
                                                onClick={() => {
                                                    if (confirm('Delete this display photo?')) {
                                                        setDisplays(displays.filter((_, i) => i !== index));
                                                    }
                                                }}
                                                style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#f44336',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '50%',
                                                    width: '32px',
                                                    height: '32px',
                                                    cursor: 'pointer',
                                                    fontSize: '1.2rem',
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.3)'
                                                }}
                                            >
                                                Ã—
                                            </button>
                                            
                                            <h3 style={{ color: 'var(--primary-black)', marginBottom: '0.5rem' }}>
                                                {display.title}
                                            </h3>
                                            
                                            {display.location && (
                                                <p style={{ color: 'var(--text-gray)', fontSize: '0.9rem', marginBottom: '0.5rem' }}>
                                                    ðŸ“ {display.location}
                                                </p>
                                            )}
                                            
                                            {display.description && (
                                                <p style={{ color: 'var(--text-gray)', fontSize: '0.9rem', marginBottom: '0.5rem' }}>
                                                    {display.description}
                                                </p>
                                            )}
                                            
                                            <p style={{ color: '#999', fontSize: '0.85rem', marginTop: '1rem' }}>
                                                {formattedDate}
                                            </p>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderAnalytics = () => {
                // Calculate real analytics from inventory
                const totalItems = items.length;
                const totalQuantity = items.reduce((sum, item) => sum + (item.quantity || 0), 0);
                const totalShopQty = items.reduce((sum, item) => sum + (item.quantityShop || 0), 0);
                const totalStorageQty = items.reduce((sum, item) => sum + (item.quantityStore || 0), 0);
                
                // Helper: Filter out Section C (event items) and Bar Stock
                const isAlertableItem = (item) => {
                    const location = item.location || '';
                    const category = item.category || '';
                    // Exclude C-location items AND Bar Stock items from alerts
                    return !location.startsWith('C') && category !== 'Bar Stock';
                };
                
                // Stock status counts
                const criticalCount = items.filter(i => isAlertableItem(i) && getAlertLevel(i) === 'critical').length;
                const warningCount = items.filter(i => isAlertableItem(i) && getAlertLevel(i) === 'warning').length;
                const goodCount = items.filter(i => isAlertableItem(i) && getAlertLevel(i) === 'good').length;
                
                // Category breakdown
                const categoryStats = items.reduce((acc, item) => {
                    const cat = item.category || 'Uncategorized';
                    if (!acc[cat]) {
                        acc[cat] = { count: 0, totalQty: 0, shopQty: 0, storageQty: 0 };
                    }
                    acc[cat].count++;
                    acc[cat].totalQty += (item.quantity || 0);
                    acc[cat].shopQty += (item.quantityShop || 0);
                    acc[cat].storageQty += (item.quantityStore || 0);
                    return acc;
                }, {});
                
                const topCategories = Object.entries(categoryStats)
                    .sort((a, b) => b[1].totalQty - a[1].totalQty)
                    .slice(0, 8);

                return (
                    <div>
                        <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                            ðŸ“Š Analytics & Stock Levels
                        </h2>
                        
                        {/* NEW V2.2.3 - Sales Analytics (moved from Data Management) */}
                        <div style={{
                            background: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            marginBottom: '2rem',
                            border: '2px solid #ff9800'
                        }}>
                            <h3 style={{color: '#e65100', marginBottom: '1rem'}}>ðŸ† Sales Analytics</h3>
                            
                            {loadingSalesHistory ? (
                                <div style={{padding: '2rem', textAlign: 'center', color: '#666'}}>
                                    Loading sales data...
                                </div>
                            ) : salesHistory.length === 0 ? (
                                <div style={{
                                    padding: '2rem',
                                    background: '#fff3e0',
                                    borderRadius: '8px',
                                    textAlign: 'center'
                                }}>
                                    <div style={{fontSize: '3rem', marginBottom: '1rem'}}>ðŸ“Š</div>
                                    <h4 style={{color: '#e65100', marginBottom: '0.5rem'}}>No Sales Data Yet</h4>
                                    <p style={{color: '#666', margin: 0}}>
                                        Upload your Lightspeed sales files in the Data Management tab to see analytics here!
                                    </p>
                                </div>
                            ) : (() => {
                                // Calculate analytics from salesHistory
                                const totalSold = salesHistory.reduce((sum, record) => sum + (record.quantitySold || 0), 0);
                                
                                // Group by item name and sum quantities
                                const itemSales = {};
                                salesHistory.forEach(record => {
                                    const name = record.itemName || 'Unknown';
                                    if (!itemSales[name]) {
                                        itemSales[name] = 0;
                                    }
                                    itemSales[name] += record.quantitySold || 0;
                                });
                                
                                // Sort and get top 10
                                const topSellers = Object.entries(itemSales)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 10);
                                
                                // Group by category
                                const categorySales = {};
                                salesHistory.forEach(record => {
                                    const cat = record.category || 'Unknown';
                                    if (!categorySales[cat]) {
                                        categorySales[cat] = 0;
                                    }
                                    categorySales[cat] += record.quantitySold || 0;
                                });
                                
                                const topCategories = Object.entries(categorySales)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 5);
                                
                                // Get date range
                                const weeks = [...new Set(salesHistory.map(r => r.weekEnding).filter(Boolean))].sort();
                                const dateRange = weeks.length > 0 
                                    ? `${weeks[0]} to ${weeks[weeks.length - 1]}`
                                    : 'All time';
                                
                                return (
                                    <div>
                                        {/* Summary Stats */}
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                                            gap: '1rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', textAlign: 'center'}}>
                                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#e65100'}}>
                                                    {totalSold}
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666', marginTop: '0.25rem'}}>
                                                    Total Items Sold
                                                </div>
                                            </div>
                                            <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', textAlign: 'center'}}>
                                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#e65100'}}>
                                                    {salesHistory.length}
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666', marginTop: '0.25rem'}}>
                                                    Sales Records
                                                </div>
                                            </div>
                                            <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', textAlign: 'center'}}>
                                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#e65100'}}>
                                                    {weeks.length}
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666', marginTop: '0.25rem'}}>
                                                    Weeks Tracked
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style={{fontSize: '0.9rem', color: '#666', marginBottom: '2rem', textAlign: 'center'}}>
                                            ðŸ“… Date Range: {dateRange}
                                        </div>
                                        
                                        {/* Top Sellers */}
                                        <div style={{marginBottom: '2rem'}}>
                                            <h4 style={{color: '#e65100', marginBottom: '1rem'}}>ðŸ† Top 10 Best Sellers</h4>
                                            <div style={{
                                                background: '#fff3e0',
                                                borderRadius: '8px',
                                                padding: '1rem'
                                            }}>
                                                {topSellers.map(([name, qty], index) => (
                                                    <div
                                                        key={name}
                                                        style={{
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            padding: '0.75rem',
                                                            borderBottom: index < topSellers.length - 1 ? '1px solid #ffcc80' : 'none',
                                                            alignItems: 'center'
                                                        }}
                                                    >
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                                                            <div style={{
                                                                fontSize: '1.2rem',
                                                                fontWeight: 'bold',
                                                                color: index < 3 ? '#d84315' : '#666',
                                                                minWidth: '2rem'
                                                            }}>
                                                                {index + 1}.
                                                            </div>
                                                            <div style={{color: '#333'}}>{name}</div>
                                                        </div>
                                                        <div style={{
                                                            fontWeight: 'bold',
                                                            color: '#e65100',
                                                            fontSize: '1.1rem'
                                                        }}>
                                                            {qty} sold
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        {/* Category Breakdown */}
                                        <div>
                                            <h4 style={{color: '#e65100', marginBottom: '1rem'}}>ðŸ“Š Sales by Category</h4>
                                            <div style={{
                                                background: '#fff3e0',
                                                borderRadius: '8px',
                                                padding: '1rem'
                                            }}>
                                                {topCategories.map(([cat, qty], index) => {
                                                    const percentage = ((qty / totalSold) * 100).toFixed(1);
                                                    return (
                                                        <div
                                                            key={cat}
                                                            style={{
                                                                marginBottom: index < topCategories.length - 1 ? '1rem' : 0
                                                            }}
                                                        >
                                                            <div style={{
                                                                display: 'flex',
                                                                justifyContent: 'space-between',
                                                                marginBottom: '0.5rem'
                                                            }}>
                                                                <span style={{fontWeight: '600', color: '#333'}}>{cat}</span>
                                                                <span style={{color: '#e65100', fontWeight: 'bold'}}>
                                                                    {qty} ({percentage}%)
                                                                </span>
                                                            </div>
                                                            <div style={{
                                                                background: 'white',
                                                                height: '8px',
                                                                borderRadius: '4px',
                                                                overflow: 'hidden'
                                                            }}>
                                                                <div style={{
                                                                    background: '#ff9800',
                                                                    height: '100%',
                                                                    width: `${percentage}%`,
                                                                    transition: 'width 0.3s ease'
                                                                }}></div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>
                        
                        {/* OVERVIEW METRICS */}
                        <div className="stock-count-container" style={{ marginBottom: '2rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸ“ˆ Overview
                            </h3>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem' }}>
                                <div style={{ background: 'white', padding: '1.5rem', borderRadius: '8px', border: '2px solid #e0e0e0', textAlign: 'center' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#999', marginBottom: '0.5rem' }}>Total Items</div>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#333' }}>{totalItems}</div>
                                </div>
                                <div style={{ background: 'white', padding: '1.5rem', borderRadius: '8px', border: '2px solid #e0e0e0', textAlign: 'center' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#999', marginBottom: '0.5rem' }}>Total Quantity</div>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#ff9800' }}>{totalQuantity}</div>
                                </div>
                                <div style={{ background: 'white', padding: '1.5rem', borderRadius: '8px', border: '2px solid #e0e0e0', textAlign: 'center' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#999', marginBottom: '0.5rem' }}>Shop Floor</div>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#2196f3' }}>{totalShopQty}</div>
                                </div>
                                <div style={{ background: 'white', padding: '1.5rem', borderRadius: '8px', border: '2px solid #e0e0e0', textAlign: 'center' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#999', marginBottom: '0.5rem' }}>In Storage</div>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#9c27b0' }}>{totalStorageQty}</div>
                                </div>
                            </div>
                        </div>
                        
                        {/* STOCK STATUS BREAKDOWN */}
                        <div className="stock-count-container" style={{ marginBottom: '2rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸš¦ Stock Status
                            </h3>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))', gap: '1rem' }}>
                                <div style={{ background: '#ffebee', padding: '1.5rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #f44336' }}>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#f44336' }}>
                                        {criticalCount}
                                    </div>
                                    <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                        ðŸ”´ Critical Stock
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#999', marginTop: '0.25rem' }}>
                                        Urgent reorder needed
                                    </div>
                                </div>
                                <div style={{ background: '#fff3e0', padding: '1.5rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #ff9800' }}>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#ff9800' }}>
                                        {warningCount}
                                    </div>
                                    <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                        ðŸŸ¡ Low Stock
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#999', marginTop: '0.25rem' }}>
                                        Monitor closely
                                    </div>
                                </div>
                                <div style={{ background: '#e8f5e9', padding: '1.5rem', borderRadius: '8px', textAlign: 'center', border: '2px solid #4caf50' }}>
                                    <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#4caf50' }}>
                                        {goodCount}
                                    </div>
                                    <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                        ðŸŸ¢ Well Stocked
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#999', marginTop: '0.25rem' }}>
                                        Adequate levels
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* CATEGORY BREAKDOWN */}
                        <div className="stock-count-container" style={{ marginBottom: '2rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸ“¦ Inventory by Category
                            </h3>
                            <div style={{ display: 'grid', gap: '0.75rem' }}>
                                {topCategories.map(([category, stats]) => (
                                    <div key={category} style={{ 
                                        background: 'var(--light-gray)', 
                                        padding: '1rem', 
                                        borderRadius: '8px',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        border: '1px solid var(--border-gray)'
                                    }}>
                                        <div style={{ flex: 1 }}>
                                            <strong style={{ fontSize: '1rem' }}>{category}</strong>
                                            <div style={{ fontSize: '0.85rem', color: 'var(--text-gray)', marginTop: '0.25rem' }}>
                                                {stats.count} products â€¢ Shop: {stats.shopQty} â€¢ Storage: {stats.storageQty}
                                            </div>
                                        </div>
                                        <div style={{ 
                                            fontSize: '1.5rem', 
                                            fontWeight: 'bold', 
                                            color: 'var(--primary-orange)',
                                            minWidth: '60px',
                                            textAlign: 'right'
                                        }}>
                                            {stats.totalQty}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {/* SHOP VS STORAGE COMPARISON */}
                        <div className="stock-count-container" style={{ marginBottom: '2rem' }}>
                            <h3 style={{ marginBottom: '1rem', color: 'var(--primary-black)' }}>
                                ðŸ“Š Shop vs Storage Distribution
                            </h3>
                            <div style={{ 
                                background: 'white', 
                                padding: '2rem', 
                                borderRadius: '12px',
                                border: '2px solid #e0e0e0'
                            }}>
                                <div style={{ display: 'flex', gap: '2rem', alignItems: 'center', marginBottom: '1.5rem' }}>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem' }}>Shop Floor</div>
                                        <div style={{ height: '30px', background: '#e0e0e0', borderRadius: '15px', overflow: 'hidden', position: 'relative' }}>
                                            <div style={{ 
                                                height: '100%', 
                                                width: `${(totalShopQty / totalQuantity * 100) || 0}%`, 
                                                background: 'linear-gradient(90deg, #2196f3, #64b5f6)',
                                                transition: 'width 0.3s ease'
                                            }} />
                                            <div style={{ 
                                                position: 'absolute', 
                                                top: '50%', 
                                                left: '50%', 
                                                transform: 'translate(-50%, -50%)',
                                                fontWeight: 'bold',
                                                color: '#333',
                                                fontSize: '0.85rem'
                                            }}>
                                                {Math.round(totalShopQty / totalQuantity * 100) || 0}%
                                            </div>
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#2196f3', minWidth: '80px', textAlign: 'right' }}>
                                        {totalShopQty}
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '2rem', alignItems: 'center' }}>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem' }}>Storage</div>
                                        <div style={{ height: '30px', background: '#e0e0e0', borderRadius: '15px', overflow: 'hidden', position: 'relative' }}>
                                            <div style={{ 
                                                height: '100%', 
                                                width: `${(totalStorageQty / totalQuantity * 100) || 0}%`, 
                                                background: 'linear-gradient(90deg, #9c27b0, #ba68c8)',
                                                transition: 'width 0.3s ease'
                                            }} />
                                            <div style={{ 
                                                position: 'absolute', 
                                                top: '50%', 
                                                left: '50%', 
                                                transform: 'translate(-50%, -50%)',
                                                fontWeight: 'bold',
                                                color: '#333',
                                                fontSize: '0.85rem'
                                            }}>
                                                {Math.round(totalStorageQty / totalQuantity * 100) || 0}%
                                            </div>
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#9c27b0', minWidth: '80px', textAlign: 'right' }}>
                                        {totalStorageQty}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="app">
                    {/* Edit Item Modal - NEW FEATURE V1.2 */}
                    {showEditModal && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                            padding: '1rem'
                        }}>
                            <div style={{
                                background: 'white',
                                padding: '2rem',
                                borderRadius: '12px',
                                maxWidth: '600px',
                                width: '100%',
                                maxHeight: '90vh',
                                overflowY: 'auto'
                            }}>
                                <h2 style={{ marginBottom: '1.5rem', color: 'var(--primary-black)' }}>
                                    âœï¸ Edit Item Details
                                </h2>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                    {/* Item Name */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Item Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={editForm.name}
                                            onChange={(e) => setEditForm({...editForm, name: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            placeholder="Enter item name"
                                        />
                                    </div>
                                    
                                    {/* Category */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Category
                                        </label>
                                        <select
                                            value={editForm.category}
                                            onChange={(e) => setEditForm({...editForm, category: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem',
                                                background: 'white',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            <option value="">-- Select Category --</option>
                                            {uniqueCategories.map(category => (
                                                <option key={category} value={category}>
                                                    {category}
                                                </option>
                                            ))}
                                        </select>
                                        <div style={{ marginTop: '0.25rem', fontSize: '0.8rem', color: '#666' }}>
                                            {uniqueCategories.length > 0 ? `${uniqueCategories.length} categories in use` : 'Categories from your inventory'}
                                        </div>
                                    </div>
                                    {/* Location */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Storage Location
                                        </label>
                                        <input
                                            type="text"
                                            value={editForm.location}
                                            onChange={(e) => setEditForm({...editForm, location: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            placeholder="e.g., A1.1, B3.2, BULK"
                                        />
                                    </div>
                                    
                                    {/* Supplier - NEW V1.5: Enhanced with autocomplete */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            ðŸ¢ Supplier
                                        </label>
                                        <input
                                            type="text"
                                            list="supplier-list"
                                            value={editForm.supplier}
                                            onChange={(e) => setEditForm({...editForm, supplier: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            placeholder="Type or select supplier..."
                                        />
                                        <datalist id="supplier-list">
                                            {uniqueSuppliers.map(supplier => (
                                                <option key={supplier} value={supplier} />
                                            ))}
                                        </datalist>
                                        <div style={{ marginTop: '0.25rem', fontSize: '0.8rem', color: '#666' }}>
                                            ðŸ’¡ {uniqueSuppliers.length > 0 ? `${uniqueSuppliers.length - 1} suppliers available` : 'Start typing to add supplier'}
                                        </div>
                                    </div>
                                    
                                    {/* Alert Levels */}
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                ðŸ”´ Critical Level
                                            </label>
                                            <input
                                                type="number"
                                                value={editForm.criticalLevel}
                                                onChange={(e) => setEditForm({...editForm, criticalLevel: e.target.value})}
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '8px',
                                                    fontSize: '1rem'
                                                }}
                                                min="0"
                                            />
                                        </div>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                                ðŸŸ¡ Warning Level
                                            </label>
                                            <input
                                                type="number"
                                                value={editForm.warningLevel}
                                                onChange={(e) => setEditForm({...editForm, warningLevel: e.target.value})}
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid var(--border-gray)',
                                                    borderRadius: '8px',
                                                    fontSize: '1rem'
                                                }}
                                                min="0"
                                            />
                                        </div>
                                    </div>
                                    
                                    {/* Tag */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Tag (Optional)
                                        </label>
                                        <input
                                            type="text"
                                            value={editForm.tag}
                                            onChange={(e) => setEditForm({...editForm, tag: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            placeholder="e.g., Bestseller, New, Seasonal"
                                        />
                                    </div>
                                </div>
                                
                                {/* Buttons */}
                                <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={handleDeleteItem}
                                        style={{
                                            padding: '1rem 1.5rem',
                                            background: '#f44336',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            marginRight: 'auto'
                                        }}
                                    >
                                        ðŸ—‘ï¸ Delete Item
                                    </button>
                                    <button
                                        onClick={handleSaveEdit}
                                        style={{
                                            padding: '1rem 1.5rem',
                                            background: 'var(--primary-orange)',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        ðŸ’¾ Save Changes
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowEditModal(false);
                                            setEditingItem(null);
                                        }}
                                        style={{
                                            padding: '1rem 1.5rem',
                                            background: '#666',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        âŒ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Water Stock Edit Modal - NEW FEATURE V1.2 */}
                    {showWaterEditModal && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                            padding: '1rem'
                        }}>
                            <div style={{
                                background: 'white',
                                padding: '2rem',
                                borderRadius: '12px',
                                maxWidth: '500px',
                                width: '100%'
                            }}>
                                <h2 style={{ marginBottom: '1.5rem', color: '#01579b' }}>
                                    ðŸ’§ Edit Water Stock
                                </h2>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
                                    {/* Current Pallets */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Current Pallets
                                        </label>
                                        <input
                                            type="number"
                                            value={waterStock.currentPallets}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || 0;
                                                setWaterStock({...waterStock, currentPallets: Math.max(0, Math.min(val, waterStock.maxPallets))});
                                            }}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            min="0"
                                            max={waterStock.maxPallets}
                                        />
                                        <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.25rem' }}>
                                            Maximum: {waterStock.maxPallets} pallets
                                        </p>
                                    </div>
                                    
                                    {/* Max Pallets */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Maximum Capacity (Pallets)
                                        </label>
                                        <input
                                            type="number"
                                            value={waterStock.maxPallets}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || 15;
                                                setWaterStock({...waterStock, maxPallets: Math.max(1, val)});
                                            }}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            min="1"
                                        />
                                        <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.25rem' }}>
                                            Total storage space for pallets
                                        </p>
                                    </div>
                                    
                                    {/* Bottles per Pallet */}
                                    <div>
                                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                                            Bottles per Pallet
                                        </label>
                                        <input
                                            type="number"
                                            value={waterStock.bottlesPerPallet}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || 840;
                                                setWaterStock({...waterStock, bottlesPerPallet: Math.max(1, val)});
                                            }}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid var(--border-gray)',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                            min="1"
                                        />
                                        <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.25rem' }}>
                                            Default: 840 bottles (42 boxes Ã— 20 bottles)
                                        </p>
                                    </div>
                                    
                                    {/* Preview */}
                                    <div style={{ 
                                        background: '#e3f2fd', 
                                        padding: '1rem', 
                                        borderRadius: '8px',
                                        border: '2px solid #90caf9'
                                    }}>
                                        <h4 style={{ marginBottom: '0.75rem', color: '#01579b' }}>Preview:</h4>
                                        <div style={{ fontSize: '0.9rem', color: '#666' }}>
                                            <div>ðŸ“¦ Current: {waterStock.currentPallets} / {waterStock.maxPallets} pallets ({Math.round((waterStock.currentPallets / waterStock.maxPallets) * 100)}%)</div>
                                            <div style={{ marginTop: '0.25rem' }}>ðŸ’§ Bottles: {(waterStock.currentPallets * waterStock.bottlesPerPallet).toLocaleString()}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Buttons */}
                                <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem' }}>
                                    <button
                                        onClick={async () => {
                                            const success = await saveWaterStock(waterStock);
                                            if (success) {
                                                setShowWaterEditModal(false);
                                            }
                                        }}
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: '#0288d1',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        ðŸ’¾ Save Changes
                                    </button>
                                    <button
                                        onClick={() => setShowWaterEditModal(false)}
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: '#666',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Alert Edit Modal */}
                    {editingAlertItem && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000
                        }}>
                            <div style={{
                                background: 'white',
                                padding: '2rem',
                                borderRadius: '12px',
                                maxWidth: '500px',
                                width: '90%',
                                boxShadow: '0 4px 20px rgba(0,0,0,0.3)'
                            }}>
                                <h3 style={{ marginBottom: '1rem' }}>âš™ï¸ Set Alert Thresholds</h3>
                                <p style={{ color: '#666', marginBottom: '1.5rem' }}>
                                    Set custom stock alert levels for <strong>{editingAlertItem.name}</strong>
                                </p>
                                
                                <div style={{ marginBottom: '1.5rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#f44336' }}>
                                        ðŸ”´ Critical Level (urgent reorder)
                                    </label>
                                    <input
                                        type="number"
                                        min="0"
                                        value={alertValues.critical}
                                        onChange={(e) => setAlertValues({...alertValues, critical: parseInt(e.target.value) || 0})}
                                        style={{
                                            width: '100%',
                                            padding: '0.75rem',
                                            border: '2px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '1rem'
                                        }}
                                    />
                                    <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.25rem' }}>
                                        Alert when stock reaches or drops below this number
                                    </p>
                                </div>
                                
                                <div style={{ marginBottom: '1.5rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#ff9800' }}>
                                        ðŸŸ¡ Warning Level (consider ordering)
                                    </label>
                                    <input
                                        type="number"
                                        min={alertValues.critical}
                                        value={alertValues.warning}
                                        onChange={(e) => setAlertValues({...alertValues, warning: parseInt(e.target.value) || 0})}
                                        style={{
                                            width: '100%',
                                            padding: '0.75rem',
                                            border: '2px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '1rem'
                                        }}
                                    />
                                    <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.25rem' }}>
                                        Alert when stock reaches this level (must be â‰¥ critical level)
                                    </p>
                                </div>
                                
                                <div style={{ 
                                    padding: '1rem',
                                    background: '#f5f5f5',
                                    borderRadius: '6px',
                                    marginBottom: '1.5rem'
                                }}>
                                    <p style={{ fontSize: '0.9rem', margin: 0 }}>
                                        <strong>Current stock:</strong> {editingAlertItem.quantity || 0}
                                        <br/>
                                        <strong>Status:</strong> {
                                            (editingAlertItem.quantity || 0) <= alertValues.critical ? 'ðŸ”´ Would be CRITICAL' :
                                            (editingAlertItem.quantity || 0) <= alertValues.warning ? 'ðŸŸ¡ Would show WARNING' :
                                            'ðŸŸ¢ Would be GOOD'
                                        }
                                    </p>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button
                                        onClick={async () => {
                                            if (alertValues.warning < alertValues.critical) {
                                                alert('Warning level must be greater than or equal to critical level');
                                                return;
                                            }
                                            await saveItemToFirebase({
                                                ...editingAlertItem,
                                                criticalLevel: alertValues.critical,
                                                warningLevel: alertValues.warning
                                            });
                                            setEditingAlertItem(null);
                                            alert('âœ… Alert thresholds saved!');
                                        }}
                                        style={{
                                            flex: 1,
                                            background: '#4caf50',
                                            color: 'white',
                                            border: 'none',
                                            padding: '0.75rem',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            fontWeight: '600'
                                        }}
                                    >
                                        âœ“ Save Thresholds
                                    </button>
                                    <button
                                        onClick={() => setEditingAlertItem(null)}
                                        style={{
                                            flex: 1,
                                            background: '#666',
                                            color: 'white',
                                            border: 'none',
                                            padding: '0.75rem',
                                            borderRadius: '6px',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <header className="header">
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
                            <img 
                                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAqiUlEQVR4nMWcd7wdVdnvv2utmd1Oy0lCCoEEAoQeaSJI5wUFJNRgQ0UURUSagAURC/KqdARsKEXBK1c6BgiINCtIExCMEEKAFNLP2eecvffMWuv+scrMjvq+976v997JJ8kus2fWPOspv+f3PGuJCbvvY60xCCFACKw1CCHBWmyeIdIUEFhjEFK4zxHufCkRACoBLEIlYA1Wa0DE10IpUAq0wRr/XggEYK3118S992OxRoMFpATh7iulwkpBPBkQSQIIhJBYkyOSFLQGKYt7W4O1ICsVrDFgjDsP618nINz5CH9ppdzvrUWlKUMjI0gLkyZOZF2zCUIggcTq3D2AFxpKAmCtwfqBCykRUmKtRUgVxu4OpdyDCAlaY61xnxvtntMLC60L4WjthC3dlYRU7nxj3LnuQ4QUGK2LyRU4yYkobjDWzRU6js1KWQjXFufaLEMkKVYSJwWpMJ0MkSZusvIMqxTCQlqt0RodZbg5wp7bb8tnjj6CHbaaxa+eeJKzr/oBSikSrPUDdIMLYxNCQJKA9bf3mum0w2B1HjVOqMRrgEbgfmvdLCD8wwDIJHUP62cWi/ve+t8ErRHCCR5IwsR5IeI10HqrsHmOSJQTZCLdOBEYYwohGoNUyk2QNU5w1rpJAkjc+BECqxIkFqtzVo+OMn3SJM78wDEcf+hBKD+mHWdtjkwSEIIEBK12x5mSlE6lvdZYY8LcOeEGTfTCQXeckERWaJ4Q3QJU/uGkBNNyZh/dhVcE4x/KH9ZYMM4MgyCxFpGkaJ2j0grVJEF4oVhtnDbmGbJao91ukyaJu4/W7l557i5TcglYgxUSmShvwjlJomiOtUiV4pNzDuasY9/PtEkbANDJcippwu0PPUZzZITx/X0kQsAWM6ZTqVScuUiJSJLom4RS7ub+aYWUUdDWaBDeXIRwv/FmKNIUjEVI0X0tY72FumuZLPM+zfvMIEWto3+D4FItfePG0dGal19bTJ7nyLSC1c5dSKVojY6yzSYzeG3FSrI8jwKMftcrBhIwIJSg02qjkoREKVYPN9lt2234+gnHsecOs91QjEEKQSVNGG21ue8Pj1NNEoyxJJUk4WeXXMjmMzYmCzNZPoJJr/fN+u//4eFNz+uv02RbuLniND85XljWX1nghS/cOY1ajYf/9CTfuu5GZ9ZB45OESrXK6tWrOWi3Xdl+8824/Oe/oF6tYqRCqLLr0chK1U2WdGPbaNIGrG2OsKbZ5NSjD+e8Ez5Ko1aLglNSoo1BCcGDTzzJi6+/QW+jjrWQIBW1WpU0TUnT/0wi/3+P+x77Lceecx5tY+mpN5BJgpQSmSQMt9pMmTiRDx96CKdcdBmtdpt6tUqlkpIZU3IdEudELSpJGB0d4ysnfJRtZm7Kq0uWcNDu7wCc1qmS/w4Wdt28e70lKqy1JAC51lhrefRPT3HdbXfQU6uhfQAIod3muYuWeOcbTSHcxBYaFIOHLcwzBKmokf487+OstdHcSqP2rsNF+ft//0fyPKev3kDrnA7QtqByzdTBcVz0mU+xemiIfXfeie02nUE7z7nzkcdY/NZKUpW4m4YILZwQ142O8tSClzlyv73ZcsbGGK/ZZeEFYT72zJ957IWX6OvtwxgNQAI2wou/vvoqN9z0c6rjB8mzzM1WgBelmaAkWLxPC34mwB2E6ApI8fC4K0ZWROlafkJ8dLbGIJR047CG3t5earUauR/vzCmT2W32dmw1c1Pevfs7mDV9Yzp5zvGHvYdzr/4B37v1TqSASlpxgvGTp4ymYwydVptzjjuWsz/0PrQxYEGpQnBOLcKwDRf//BayXFOrOeUQQpKUH7BWqVAd6GN8Xx95nrsg4dSjwIFCOihhbDQFEAglfSAN70uCCwEkvA6fS+mwmxTodtvPg4+SFIHHCTnHWIMxbnJUkrDJ1KmMdnJ+/fiT7LfzTmhjSKREa83ZHzmW/t4eLr7hJkZGmvT29mKEJFWKdaOjbDA4yLc/90nm7r8P/9FhtEYpxQ33PsDDzz7HQG8v2gN0IRWyHAmMteR5Tp5n6DxHa43Oc/IsI89yjLH+O402hjzL0caSa02ea3e+dt9pa93/xqCtIc8ydJa5e2QZGoFBoK0l1w60a23QRpNnndL9/XutnZOQEmEtOs948PEnuP62O9hq5iZcfcvtfO+W25EeZg309fK54z7EbZd+m1kzZ7Ku3UFKwap163jHtlsz75JvMnf/fdDGOIv5B4c2BqUUz768kK9c+1MatZpLOEq4V1KydXymYY2J2K+4uPWvnTZEhI13VTr3vq7Ai3hzR3jo4z9z2FB3aXhMD8EBdACpHL6UEpTy31uX/VhQSjF7yy3IWi1umncvF1z7E3777HMkSpH7idxzh9nce8VFHLHXHqwdbnLSkYdx54UXsNUm09Ha+TZRdjElZVJSsmLtWj558RU0s4y0UsHkeXDgLr38ux/mmc+FvXC8mXl9duYrZcSG1ugChIcJsE7YMmBIrd01TciTXYYgLBFfug+d0LDG5dfBPfhxhNNjYLGW1WvX8tN75lNPU1pjoxz/1Qv466LFJD44aWOYOG6A68/7AvMvv5BLTvs0jXoNY8zf+btCj9zDtzsdPnXJlbz0+pv0VCpobeLkhUgs15e+UMoLyUdUY1xeHBG99hpa4DcHDYRPyj3Y9qmWTFIPiIuIbY1xgFpJTzjkBUCPAg0abgsvEwKBD2pSScZa7TiB9WqNZStX8oFzvsLry5ajpER6+JEoxZ47zC4mV/5z4VlACsFnr76G+598hnG9vWSdNi5w+NzMGvd8JuuU0igXFbEekgiKVMqbsJCFRshKFaESh8e88GL6Za3LEEKK5+Uhgsno3A02EAhGB/UqjaV0f2ORacVPkJt9pHJpmCcqcq3p6+nh5Tfe5IPnfo3nX17YJRjto/c/MtkoPGuRQnDuNdfzkwd+zfiBAXKdO4tRSQTuQqUIz8h0mZCQKibtAg9FpEQkaRcLEzGh/721NvrBSAhIr2ElvGh9KiJU4q4vpTNvvO8L96fQbuF9oTW6gD7WFO4lSfwwXH5dr1X5zbPPc9uvHy5wp88o/tlhvHCllJx//Y1c/ovbGezrRWeZTwGD2zIOgdiAAwNYLebBJefez7i8VxcQpjRbwgpEorC5djAGgc0yZJJgdRa1COmTeT8QIAYQkaaOJxRBswVYz+EZZyrk7lwrLNbkxdgQyDQlUQorJcLC2uFhpg6O4/IzT+MD7z4gatR/dASTbmcZX/jBtfx43v0MDgw4RkdJhB+HkCL66ICdw9T5hzI+EAjQhpgEe0AdX2O8cJ1PjKDXm3CIVCFXLWgXRzZYr+kiOOSgfUbjsnzrwXMGVkKSOHLXE6XCBxuBpTU6QscK6j0NOtpw6F578K1Pf5JNp02NWvmfCQ/g+YWvctZ3f8QfXlrAQF+Pw5tey4MbshaEKVwSApKobf5ho7lZ3ANpXaRu1iK9ww6QBhlSsiReJ3CA1ho/EV7TguYp5QQZzg9Mtme93UQGNgas9ubqfStCIJWk1cnYbtYsdt5qSx5+6mk+dsRhnPa+o4G/z2X/TnAU6aSUkmWr1vDM316mmiZIITA4npNojW5irS0z2pAQsFi4qrXOxrV2DLByTho8O2I0oJwj9Z96FtXT5Tpey3ry0g3E0+z4WUwq4SQ8Ciyx1QqrPc8XglBIH3EQSKoElMuQrjjrNJpjLXobdaDAcP9M48L3we9Zazng7Ttx70UX8NFvX8brK1bS16iTdTLH5MikmPyoYD5aE5L+KMHCP8Vo7AGw4/+Et3j/8B7oWu211RgPfVzIl2klXgvj3YKUvubhI7UOrx2dZrJO0I+IKyM6SBKSShUNdPKMWRtvzNrmCL2Nussq4J/6vBCFg/CkRwTGZ0M7ztqc277+JbaavhFDYy3SNI0oQCpF4hGHUxsHortSOSFK9l5iV4THeTKteMvWWG0wQWA690HCC0prZ5JeQGHmS3dyn4UiE/jzgqCcJlutMb5mg9GINEUJwehYC5NlXHjyifz4vC8wrq83atU/Ep0pad1Yq80P776X/T/7RS65+VaGRkZRUpIoSSfL2Wzahvziq+ew/aYzGG61SDyWbHXarBoaYmRkFKMNI6NjjLZaJDYvomWACSLYu0f7+BqB1cR0DZ2DSpzWhABibCGo8F4405XKwx7jA5BQXbDJ1TYSb7LSTWDJlwopkVqzZqzFVpvN5Mqzz2CvnXaI9NM/0jrjcV0w51899Qz/fuPNPLHgFapK8vQri/jFI7/lpMMO5r377UO9WsEYw7SJE/jZOWcx92vf4i+vvY4wmq03ncGc3XZlly03Z/LgIEtWruLKW+/0UbikhlaHHNWCFdGPgQ8OvoKGdFU4l01QUF4lusthwSTiORucsZAO9uS5B9YS0tRX9bqBNBZXzrSWVeuGOPKA/fnOOWczZcIEtGdKykfwcUIIJ1Qh+MuixVx2653c8ZvfY4Vk4rgBh++kZOGyZZz23R9x3fwHOemwQzhqrz2Q0rHU1551KideeiUfPHB/jv23fenvacT77LDFZsx7/EkvwOgCC96PEvgNBEAQSkylQu0kcIqhGBXqsbEWYONv4ufen0VfmHV8+uizjIDtpXDcJHD+KSfx+Y9/FCFEZEpCSmm9v5ZSoLw2vrT4DX58z3xuefR3rBkbo79WA+EJZP+MtUqFek3x/KLFfOqK7/Ojefdz8uGH8K5dd2abTWfw68u+Rer9Xu4nTADn33ATN/3qoW4+sGzKIVkOhEGMPD6aAphcdwWUUFDqfu3crEpc3dVmWUzIo/BMVuTBPudzeXSCzjIqlQrXfPVc5uy7N3mIxEGIpSofwLqREf7wl5e4/bHfM//Jp1k97ALMYE8PeZ5HC4rEsHG+vFGrgdE88/LLHPONi7jspI9z8uHvicyOtZY0SVi1boivXH8jN/3qYXrrNRKRpvHmwec4UGscePUmFmh6a0xBvfvUqTDv8HvlheM1LU0dNZVnBKbaloiD6P+CC/DXkFKybmyM4w48gDn77g0QWZbCUAwLlyzjyQV/45E/v8DjLy1g0VsryLVxguvrxSDIrXUpX/DBwe34B7C4urXNcubu9U4++G/7uIBpTLznmuEmR513AU+98irj+3pcKTrmvgQF8DjQa1CoilGub0jh0qsSsI0mGl4H3s9rth4bdZhKJV3CRghf2PasjnQCxptnva+P5xa9xsN/eooNxg+SdTKGxsZ4ddlbPPfyKzy94GVeWb6CNSMj7vxqlUa9TijUGw+rwsT52fbP4HjN0NHQyTKmjBvgohOPZ3xfH8azOMtWr+EXj/yGg3bZCQ00qhVPB1oSG1kQb8GqlOv5npcIYJVCCNVlxqG4jbUOygReME0L36q1nwMbtVkK6VJeX/8VQrgUUFsPXhXGQkUlvLjwVY4664vUGw0MgrbWdLxZVSoV6o0eBvr6XOFUeN5Qa0TIdqRylBnELChSY4F2S1OydofJ48ez0QYTCRp166O/41s338oLi17jp/MfpNlqOYrMT0ZSNgdByFvxAski6rfaF6mlitW62ASkDaJSxXZahVaV+lws0rVf+NqwsJ64VcrVaI12RXgfqCBAKjdJVQ9oc5/S1et1GoGW8s1PSIkJxC7evYQHs6XWEOsZ7UhuuM+MMdSrFV54bTGf/d6PmDFpEvOffJo/vvASKk2YNG6ARW+tQCnlgoo1WCtIyjmsjdkFURDlKptr9Sgiqg3/+GgazdOfL5IkZhKhN8WldXlXsShcSOBoLusjtJCqYHGSxH+vsN61ePbSCci/tyX/DMQuisLP++JWGKdPyYR/6DRNuG7+g2hjSaWkp1EHa8k6GdVKCtbVgFqdjFqiSMoRLPq40BngCURCN5XIC8GGHNmbqgidVirx1TZZBB2fYiGV66iQrtUtNPU43Clc3UM6EwvW4ARZ0iprodNBpKnrHsudCwidZNG/RZ9UElaosQSBepZJeEDvmpU0/Y0GGIPRucOL+CBpDJ0so5JWOGnOQfzu+b+EmkgpF7beqSZJ7IQKzIM7LcAU5+eEEMhqxbHTlaoTQqWCTCvkQkJagSR1kEFAc3QEVUmR1YoPKgqZVhxh6xuGhFLu2kq5e5cCHQJEpeK03Z9LWfNUKFwlflKd342FqhjgEidML0iTF0Uxnedoo7EiQCSQUjLSarPX7O146LJvcsEJx1GvVkkidRV8lyh6SIR1TlmsFzDC4ESSxsEgBdJzfEoI1o2MctycQzjh8ENpt9tOI7HcOO8+fjxvPv19vSiP5QITTADEQYs8yWp1wYA4YahY6LImBKGgCyWzjD7YFgWsiGfzEn4UYLICqgkQMomTElxFlmu2mLYhm0/bkLFWx9WhTadUEwm+SxYUlgO13sREgfeESpBpSuzO8s5cSEGW50yZPIkvffw4poWI5o93zN6ezTbZhPN/8jOUhVQpTOwtDAX5wihCViNC9AxR37uLQPGHwYYmSqx1Zh1sS+c+jQwm7WNKnjurUb5sEFpZwm+D+1Hutx2tMdYivXUmEVgG3+bNJWYoQiJEQSjitSzwaMIPKGipAta12pzx4UOZtsFEmqOjXHP7XaxYvZZD934n73zbbE7/wDHM3Ggap11+NWubTXobFXIturTIWhOrfIEicxETr82etZEqalIUUvCBJf/u0kZTZFehzu3hl0MW3vcLEYlgJ0SNDcU0G0oELkOTrki+HpPhfYMINVovNFmtI9OU2H5hiX4LXNLfMoYtZkznhDmHAHDno7/js5deySU3/Q+OPvtcbrp3PgCH7fVObv/m15g1fWPWjoxRqdYK4J0kiErFm5xApElphN4MpQ8CIXhYj1MTJyDh/6B1l5Zao7122aLx02NdqRRSqW5LgEJhoJvssBZJqYiOcdgP4ypPVru+Y1WrISuVGFlFmjh86Gl6gTMFYQ1j7Q4nHjmHSeMHGWqO8J2bf8Fgfz+Txg+iheCkCy/n/Gt/gjGGHWZtzp3f+hrvfscurBpuula1NPUaRhSEy7Nkoel5qJSJEr4LUMW9N3kWo3KRTZXy9EA9BlcQene85lo/KfHEgApiYc0JX8Y2tCgJ90U5IjrbTBwAlb6pJq0UGiAkMk0YzXJmb7YpHz74XQD89L4HeO7V12j09tDJNUpAb6PON2/4GR//5sWsbTaZMmECN33585x0+HtYNzrmGr6Nb3BXqhBcUmi+qFSdYCjBpgCoI5Lw/k7Jkpn6KG10gWdDFmVKbHqZFAltKVHz1tdAWcKBQiDSShHxujqsTByYjd0CNl5YJimZtZzyvrn09/SwYs1afnD3PfQ0Go6fUwkWAVIxYXCQXzz0GHO/8u/87Y0lVCsVLjrpBC785PFoJcmMJU3SqBmhLCAST7EHVOC1z2FH67IDz5I7NGFjYPQK7XL44NtlUIDwXvmJsC5TCcoVWlpKDHvUQOkxGnjnHIpFfgakSjzg9LPi2RkBUVOlkjSbI+y+9ZbM3c+xJtfcfS+vLFlKrVotMoskgSRFC5g4eRJP/W0hR3z5fB555jkAPnXEofz0nLMZHBx0zTwhsnswLdIkFuRjr4yHXMYjhdAEUPjGog/RPVepYghFi4dwn9lAeZX6ZgLALk8GCMhzpPTMBd4cZKXq/1YcZIiVtTQuZ4g9MMG8pcIKOP39x1CtVHht2XKuu+8B+ho9GCEQScVpUs3dSyYpea7p7+th5cgox377Mm64/yEA3vX2nbj1vC+w3YzprBlrkdZqheYHsByI15BJyJLTFx764IpfQiVF6hmZdttlrgX2LFBA0QBgCtdQaizw0kfGLANici+qNURaib0vqDAjBXIXaQUhJCpJGB4Z4YB37MpBu+8KwHfvnMeydUNU67UiYtpgTkQzy7OMeq0GQnLG967hvOtuJMtztt10Ord+9YsctvuurBlrI4MGRndiC2GEXN3XZsAXxoTTNlfzKUyuMFlRmHBgZ4LlBSIitnGYWEksr3vBGGTMd4MAq077RIiGiV/G5cGzSFMPZYQHnJJqtcpn3z8XpRQvvLqInz/0GAO9rlImpCpmN+S0SvoVTgKda5QU9PX1ccUv7+fjl17NqnVDTBzo59ozT+G0ww9heKyFkcqx2qEzNBCwiAKjxiyl1Gas/FKJ6CcDYVL475jm+cnxVy0J2sGYrkjtg5DsSoO8Woa2C5dz+pQpz10ZMs/iuowkSRlqjjBnrz3Y823bA3DlbXezdmyMpFLBelAuKxVkteZwVppGMOs4Q4vxWj2hv4+7n3yGuRdczIuvv0maKL7+kfdz2YnHg7W0tSERoghiIuS6RToZg58fM1r7fpvSKqWyNgegHqkwIq7E+gwr8H/Wp4Rh6pIEGVB5vFiw7eD0pXKalyTISuojohu0RjDQ38cZ7z0KgD+88BJ3/v5x+oP2BT/ptSIEocKxE1s+jNbkWjO+t5fnF7/J0edfyANPPgPAcQfux02fP50NBgYYbrU9H2fjuIJrcH5QYk0pn/b+MnS5BhcUusSK5/duIAaJoo3DmmK9YNdhQ4eqLT6IJ8ok9qPIoIme2xNSkVQqDLfbvHf/fZi9xWYYY/jOrXfQyl3lKjr8MDGhJCoEst7wPqYwoVDkyY2lr7eHta0Ox11yFT+89wEA9pm9LbeeeyY7bbYpq0fHSJI0+iiL9R2t3qLLkbJsmgGCeOGH70WAQqEWLUOzlBOPDAsRYwM8cVKkrFSK+wSfER2/T9WS1DVWKxUzkE6WMXlwkM8cfQQADz71LA88+wL9PQ3fUycLOspnB4FFsXkeKav4YL7wbq0hzzUVKUiqVb5w/c/44vU/o51lbDFtQ/7nOWcyd7e3s7rZdO0WSeLSr6DVwb+FIFEYXIEaQjYSImvEiSX/B0gfSK0tpX0lgkIIgXTqHqJb8UVcD+xpo7CqEmMQ1tJstfnwu/Zns2lTyfKcK2672/XThSjtzSmYq5Qqsjh4ji6sMQmd91gHTZxbcvcZaNT57rz5HHfxlSxfs5Zxfb388PST+NzRhzM8OsbakRFa7Q65b+5UiSKtVFDCFdalCrkx0c8VYFwQGCYH2otgEgJGiLyhWbTISIIJl4vpolhJFJqFIvL2UVcISSfP2WTKZD55mCcMfvsHfvv8X+hr1F1dwvfFhJwV7/iJAypSNIRwi6jDg0WzducYJBP7+7n/mec4+hsX8edXFiGl5EsfnMv3T/4E795xNtvM2Ji+ep12q82adUOsHhpiaHSMsU4HrQ1SSVSiUFKiktRhR09UhLw30lihYObrQDFahwSirNVK+bJmkF/IOwNWinUDorNWSjE03OEThx7M1AnjaY6N8Z1b7kD5xdFxmZc13qH74pC1gMdVfqGOm2UX2SwWTB413p3vTCzTmnH1OguWLOeYb1/OJR/7EIfutgvH7LMHx+yzB+0sY/matSxavoJXlixlwRtvsnD5Cl5fsZK3hoYZHhml7VcVKCGopClKQBLrxF6I1voWEwPSd074/uvYolxWOGsp80Tu0KFCVhTXnW92ZGmrk7H19Gl85N3/BsDNDz7MMwsXMdjbixYiCjoUk7ogUmBVAp8mPOUkhNeIgnO0eQehUshdOTIHempVhkfH+MQV3+PsJUdw8M47MHXCeMb19jB90gZMn7QBe2+/TbzdSKvFklWree2tlbyyZCl/ff1NFi5dyhsr17ByaJjmyCiZ5wITJUmTlDRNIv8S10v7ANj1PD7qJ2WnCCCr1eiArVdT4ZG/lIpWu83JR85hsK+XVevWcfUdv6RWqbgeZSiWgOFbhaP2CZ8dlCKzPzMIL/QHOlMJUdX32kiBtoZqpYI2igt+fitX3XUvE8cNsPEGE9lk0kQ2nzKZzTacwqaTJzFt4gR6ajW2mLYhW0zbkAN2nB2fcc1wkzdXrWbRsuW8snQZLy9dzqtLl/Pa8rdY3Wx2owgTqDAot/viBZx05XdBjcMCGSldTdgYpBSMdjrsPGtzjtl3LwCuv+9XLHhzKRPGDaB9WTOmV95UnTXbGNVd01LYJEIXmhqiIsQWkGISiwBmcC6hv7eHLDe8vmIlC5ct58HcsdEVKejvaTB53DimbzCBmZMnsfm0qcycOpkZkyYxdcIgg329DPb1st0m07uUZ/Gytzjqgot5c+Uq0iAsGTpnczorlxca6MeTFItPKdoqAKGCqfl1GSrBtDucNvcIGrUab7y1gh/98j5663XfkO07tILTVQnCWkyeE5YIFDtlWKwqgoqbuxLM0Zq4zYBw0dM6ZiBMvUcVgopQ1KpVwnPoPKfVbvPy0mW8uPh1tM6RSUo1SeivVZk6OI5Npk5m86lT2GzDqcycMonpkycxZfwg06dMYt/ttuaaex9gsLdBnusIfQQgq7VuHyhweyaUi0ohl8QQHbkUguFmk72224b3+AXJP7j7Ht5YvSau7BS++yqkRULnRa028RFX59EZx3uW6Xbt685Sut/7oBKWicVW4sAwe3+qQ5OQddeVKqGeCBrVqjvPuM6D0Vzz4ptLee71N9FZhlLK9dJUUq498xT22G5rDtxxNjfc/6Ana7378mNKBsZ1aSxWrLdWzpOQMQqHtEcIkiThjPceRZooFrz+Bjc9+IiDLSFdi2XQEij1wDy08QbmxApioIlFHr8awPXq6IhBbdwOhW4yMwQgS+zNjj5WgDa6WG2au00xpDXUq1X6G3XGD/TT39OgoiRL16zlrt8/jhSC3bfdms2mbUi7kxXCC3fN12NjAFnUC7xWmGJ/FyklaZoy3Opw8K67sO8OjjC46vZfsnK46RYy+90wKKm6EEUrRhntCyFJlHJsswydXbIoHcQahjdb3/hUNGuKvxN86aZEwjNES+/TRcX1dlshMEajsywuxTXW0lur8uhzL7BuZIT+ngZ7b7c1o622W8BjbSQlKDHwYSKLmBxFWsAMcF2ZPbUqpx41ByEET//tFW773R/pbzTIQsE8ZCzWFilVoJjiv44wWNMcYdW6Idodt37X6ryo8wYMGoQU0soAdYJ2RyI0LKsQXY8QA2MQapYVYwyP7v22sVBNEhYuXcYfX1yANoYj99ydvnqN4dFREp++hg0zChThXssuqcZ81aFupRTrmk2Oeuc72GXLLTDWcuktd9AcG3MLbuID6YjabSAjjfF5tePSjDFUEsVx++/NZ+YcxJYbbcia4RFUwIChq98UuxtZ691Cnrm/waRUIDwK4Rax0AvN+29Xi/GzaE0xuYHn81G2k2vmP/EkSkp232Yr/ueXzmbmlMmsHhpC2dJ+ELobSMsuqQaa3PubzBgmDAxw8hGHAvDrp57h3j88QZ/fEiQWdWLuW+bYnFDxEGh4rMX79tmTKz59Ahd89IPc8qWzOHz3XVkzMuIUP5p5yMsdG2LDZ1GjnaQCqI00mbV+2YRfEBg1hoJkMAY9NooZG0UPr6OzagV5cxidZQz093Pb409z3QMPA7DH7G256xtf5qg9dmP10BAW63H++iZcLtkJr03Gp2zNEY7dby+2mr4R7U7GxTffhiHEltLAA3705lWeFCkEWa6ZNjiOUw47GGMtWa7ZYKCf6z/7ab54zBGMZRmdPEdBkTp5ErMrk4nLKRxPZzrtgnrvYl9CjmsiLAvRX1ZryGoNkabosVFaby6m+fJfaf7lWdY+/wyfPudcPnHOeax8azmTxw9y3efP4Bsf+whWuDUmcZG2tYik4hdcl7MR4RaWtPOcjcYP8qk5BwNwy6O/5fcvLoiEQeHkffaADx6BIPA0lZSCkdERTjz4AKZOGI9r1lZR4J9/75H8+LRP0d+o02y3SUI7WwxovuIWxhlqFN5PRmoq7BQXLMC68bjJxS8G0lErVb1BY8ZMerfant5ZW1OfPpP61GkMTpjAT+f/ivecehZPvrQAIQSnHn0YN33uNCaODbP85QVefpbmgr8gu/gt/79K3BZHxx90ABtN2oA1zSZX3n431UqK0U7DBBTRsaQhDgvqqC2jrTbbTJ/Oxw4+kPLS0zBx2hjm7PZ2bv/y59hh0xmsHhnxnfeASgmBPBbAfS0iQJtgmiENtD6VjAAk1EECH+i11eQ5emwUm7l9w2Slgmw0UBMnMXXrbVmYC44+/0Kuu+d+APbaYTa/vua7HLjLTnH82drV3TjQIpACxjodtpg2lY8dfCAA18//NS8uWUqjXi84ssD3eaY24jsPdKVyRaB2lnHq4YfQFwrs601Y2FZp6+kbcdu5Z/OhffZkzXATaywSx+hEjbSs19pmCvYn+OKovQbrs6j43uSe1pfeWorJDL+znQ5Zp0MjTeh0OpzxvR9z6hXfZW2zyZZbbcWx73+f9wiSgR3e3q2BgdJv5YYTDz2YCQP9vP7WCq6ZN59Gmrq1ceD24IMCwohiBXrYT0EAw2Mt3rn1LObu/U7fErZeTSFovHTd9H2NOledfAIXfOT9aGtptdsoj0udKZqSjwxTYIuJ9Jpno0BKEyCL6lrMeMLE29C27K8n/RoUAf09Da5/4CGOOPd8nvrr36L5Wovb6iCmRbhtRMZyww4zZ/DB/V2HwVV3zOONVaup1WpxYCGqhb9hmat101lEZKM546g5pGGnon8oPuKMhmVan55zEDeedQqT+/tZNzLqtrILjLj1AcwUcCL4YpfmQXl3kFg/9sHNNccTe6LXL4PGPkTrNFhrzWBPg+deXcyRXz6fG+69HyEEiZLoLA/NRYUq51pz8qEH0VOv8dzCRfz8oUfpr9fcKh/P1EApCgcOMGikUkhrGRprcdAuO3Lgzjv+h+t3y0dY36aNYb8dtueur3+JvWdvy8p160r0fLHWIxaDIoHhvo+lRwthWYWL1jZ+boL5Q4zqAQrFgBVkYgy9tSqdLOfUq67htO98n3XNEaq1qk/l/IWdyW3JnN3fjrWWS2+9i6F2x9V4Q7trYKojkMWzzCre0FhLPZGc6cud3djpPz+CX5wxeQNu/uKZnHTIuxgaHS0tLiw0P65tRsQFQgXDY4o2Nw+sI9nh4ZDJ/GrV4AODFntAbvz7XOcoJRnX38eP75nP3PMuYPnqNcjywj4p4DOHHUyaJDzy5xe454mn6O9x+wfEpafBVwRnHfyP/1wC65ojvHefPdlx85lxYfP/6aGkW/dRraR8+xPHcfmnPoaSgpFW2y0mDBAqROjgF0tsT7GDnC2gVQlXOsLXec6IE7v2AAwaazxIt+RZh/F9vTy7cCGLly8nQcloXvu9bXumjB9HrjWX3v5Lcu8vDJT2L/ADD2uHw8CV2zWjk2dM6u/j9KMPjz7xv3qETXOMtXzkgH3ZaqMNOeXKH/DXJUsZ7Otz+2nFxkovFCGxFEA8aFJ3G3DofYGCMSfCovDe4jhHkICOKaC2lnql6rKTmEsCm06dRKNa5c7fPc5vnnuBvkYdHZbj+67VqHFBAwPTbC1SQLPV4mOHvItNpkx22vffEKATSLGD5K5bzeKu88/lkLfvzOrhJkJKp92iEFL3dgV000/eT8ZFhgGEGxNXLtkS1uzissI6ad8iYnDkiIxmABhjaY6Ncfmd80grFYejVKl3poSxumbK832tLGPzqVM4cc5BXaD5X3EEIU4eP8iNX/gsn5t7OCNjY2R5jhKlUqwTu5/cguANrM/6QrVBCaT0jeXBbEO24KFNuF4MUH4VPaH13w/yJw8+ynOLFtNTAs3hQl010hIbIpLUQaCxMT4952Am9Pf/HWj+VwnRdXzBl459L9eccTI91SrNsbG4KLqQXwDTdIH+SPTKUo/Oei0boa9GRG6yNDmR7HD4UUa1tZZlq9fw/Xnz6fF1Dhu000KxrEB24SxwxMPIWIudZ23BsQfs60Dzv1h44XDXdVDnyD124/avfIHtN5nB6qEhpPCkUzTnYlsTt+zMM9dau24zKPqkQ+TGL7HwwopiDW0hIU3wS2SlwLs2Ibjq7vtYvHIVtWoVo3Nk6H6KJKtH+KFjKyzLUgptLWfMPZx6aOn9vyRA6E4Bt5u5CXd8/Rzet/cerG02Y2ErZixeGGFLgBB03M6+uOJZ6KQQIIKyCOk3NfM0vheUy74KFyG1cZT2a8vf4qaHf0N/WBovQjtGAQNizhlaanG0//DoKPu9bXsO2XXn/23Q/K84Qgo40NPDD888ha9/5INkeU47y0gSn7aVmipDe0bIq90+WF6nQreWVysRmu/DwqMI3bzrjyuVcDN02V33sXasxWBPw5GlqljR07UBBZSq9MJvO2I5/chDCfsY/Hegy3/lCPsonDb3cLacvhGnX30NS9asYaCnJ2pi7MnBmalAdO8aQlinB+AFH1JWD9VcLTssgXDanQw0enjg6T9z5x/+RH+j7nZpXB9XSYirlgig3u2asW5kjOMP2Jc9t9sawO8P8//2KOv7QbvuzCObz+T0q6/h4Wf+TJKmhCVekYTw+9kI30AkkzSau0XiN8iJbiguuikz3QAIko61fO+eB2i321QqKbFzM9LmQZg+qPgLWwvaQq1aZaNJE5n3xFMY47CgG3C3GXfNbkztbBxIcNrdOxwRe1TK0S/mql3nOueujaFeqXDUXruz4PU3WbJmDYmScUu/uEOnLe5tdE7YnSmkfG6zn7DEq5QKFrcC4H8BiZecYQa21psAAAAASUVORK5CYII="
                                alt="The Tunnels Gibraltar Logo"
                                style={{ 
                                    height: '60px', 
                                    width: 'auto'
                                }}
                            />
                            <div style={{ textAlign: 'center' }}>
                                <h1 style={{ marginBottom: '0.5rem', fontSize: '1.4rem' }}>Inventory System</h1>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>
                                    <p style={{ fontSize: '0.9rem', margin: 0 }}>Storage Management</p>
                                    <span style={{
                                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                        color: 'white',
                                        padding: '0.15rem 0.5rem',
                                        borderRadius: '12px',
                                        fontSize: '0.7rem',
                                        fontWeight: '700',
                                        letterSpacing: '0.5px'
                                    }}>
                                        V2.0
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <nav className="nav">
                        <button
                            className={`nav-button ${currentPage === 'search' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('search')}
                        >
                            ðŸ” Search & Find
                        </button>
                        <button
                            className={`nav-button ${currentPage === 'map' ? 'active' : ''}`}
                            onClick={() => {
                                setCurrentPage('map');
                                setSelectedZone(null);
                                setSelectedShelf(null);
                            }}
                        >
                            ðŸ—ºï¸ Storage Map
                        </button>
                        <button
                            className={`nav-button ${currentPage === 'count' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('count')}
                        >
                            ðŸ“Š Stock Count
                        </button>
                        <button
                            className={`nav-button ${currentPage === 'analytics' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('analytics')}
                        >
                            ðŸ“ˆ Analytics
                        </button>
                        <button
                            className={`nav-button ${currentPage === 'shiftlog' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('shiftlog')}
                        >
                            ðŸ“‹ Shift Log
                        </button>
                        <button
                            className={`nav-button ${currentPage === 'inbox' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('inbox')}
                        >
                            ðŸ“¬ Inbox & Alerts
                        </button>
                                                <button
                                className={`nav-btn ${currentPage === 'firebase' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('firebase')}
                            >
                                <span className="nav-icon">ðŸ”¥</span>
                                <span className="nav-label">Firebase</span>
                            </button>
                        </nav>

                    <main className="content">
                        {currentPage === 'search' && renderSearch()}
                        {currentPage === 'map' && renderStorageMap()}
                        {currentPage === 'count' && renderStockCount()}
                        {currentPage === 'analytics' && renderAnalytics()}
                        {currentPage === 'shiftlog' && renderShiftLog()}
                        {currentPage === 'inbox' && renderInbox()}
                        {currentPage === 'firebase' && renderFirebasePage()}
                    </main>
                    
                    {/* Floating Add Item Button */}
                    <button
                        onClick={() => setShowAddItemModal(true)}
                        style={{
                            position: 'fixed',
                            bottom: '2rem',
                            right: '2rem',
                            width: '60px',
                            height: '60px',
                            borderRadius: '50%',
                            background: '#ff9800',
                            color: 'white',
                            border: 'none',
                            fontSize: '2rem',
                            cursor: 'pointer',
                            boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                            zIndex: 1000
                        }}
                        title="Add New Item"
                    >
                        +
                    </button>
                    
                    {/* Add Item Modal */}
                    {showAddItemModal && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.7)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 2000,
                            padding: '1rem'
                        }}>
                            <div style={{
                                background: 'white',
                                borderRadius: '12px',
                                padding: '2rem',
                                maxWidth: '600px',
                                width: '100%',
                                maxHeight: '90vh',
                                overflow: 'auto'
                            }}>
                                <h2 style={{marginBottom: '1.5rem', color: '#333'}}>âž• Add New Item</h2>
                                
                                <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                    <div>
                                        <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                            Item Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={newItem.name}
                                            onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                            placeholder="e.g., Spitfire Stamp"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid #ddd',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                            Category *
                                        </label>
                                        <select
                                            value={newItem.category}
                                            onChange={(e) => setNewItem({...newItem, category: e.target.value})}
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid #ddd',
                                                borderRadius: '8px',
                                                fontSize: '1rem',
                                                background: 'white',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            <option value="">-- Select Category --</option>
                                            {uniqueCategories.map(category => (
                                                <option key={category} value={category}>
                                                    {category}
                                                </option>
                                            ))}
                                        </select>
                                        <div style={{ marginTop: '0.25rem', fontSize: '0.8rem', color: '#666' }}>
                                            {uniqueCategories.length > 0 ? `${uniqueCategories.length} categories in use` : 'Categories from your inventory'}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                            Location
                                        </label>
                                        <input
                                            type="text"
                                            value={newItem.location}
                                            onChange={(e) => setNewItem({...newItem, location: e.target.value})}
                                            placeholder="e.g., A1.1 or B2.3"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid #ddd',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                        />
                                    </div>
                                    
                                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                        <div>
                                            <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                                Quantity in Shop
                                            </label>
                                            <input
                                                type="number"
                                                value={newItem.quantityShop}
                                                onChange={(e) => setNewItem({...newItem, quantityShop: parseInt(e.target.value) || 0})}
                                                min="0"
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid #ddd',
                                                    borderRadius: '8px',
                                                    fontSize: '1rem'
                                                }}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                                Quantity in Storage
                                            </label>
                                            <input
                                                type="number"
                                                value={newItem.quantityStore}
                                                onChange={(e) => setNewItem({...newItem, quantityStore: parseInt(e.target.value) || 0})}
                                                min="0"
                                                style={{
                                                    width: '100%',
                                                    padding: '0.75rem',
                                                    border: '2px solid #ddd',
                                                    borderRadius: '8px',
                                                    fontSize: '1rem'
                                                }}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style={{display: 'block', marginBottom: '0.5rem', fontWeight: '600', color: '#555'}}>
                                            Supplier
                                        </label>
                                        <input
                                            type="text"
                                            value={newItem.supplier}
                                            onChange={(e) => setNewItem({...newItem, supplier: e.target.value})}
                                            placeholder="e.g., Local Supplier"
                                            style={{
                                                width: '100%',
                                                padding: '0.75rem',
                                                border: '2px solid #ddd',
                                                borderRadius: '8px',
                                                fontSize: '1rem'
                                            }}
                                        />
                                    </div>
                                </div>
                                
                                <div style={{display: 'flex', gap: '1rem', marginTop: '2rem'}}>
                                    <button
                                        onClick={async () => {
                                            if (!newItem.name.trim()) {
                                                alert('Please enter an item name');
                                                return;
                                            }
                                            
                                            const itemToAdd = {
                                                ...newItem,
                                                quantity: newItem.quantityShop + newItem.quantityStore,
                                                lastRestocked: new Date().toISOString().split('T')[0]
                                            };
                                            
                                            const success = await saveItemToFirebase(itemToAdd);
                                            
                                            if (success) {
                                                setShowAddItemModal(false);
                                                setNewItem({
                                                    name: '',
                                                    category: 'General',
                                                    location: '',
                                                    quantityShop: 0,
                                                    quantityStore: 0,
                                                    minStock: 5,
                                                    reorderPoint: 10,
                                                    supplier: 'TBD',
                                                    notes: []
                                                });
                                                alert('âœ… Item added successfully!');
                                            }
                                        }}
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: '#4caf50',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        âœ… Add Item
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            setShowAddItemModal(false);
                                            setNewItem({
                                                name: '',
                                                category: 'General',
                                                location: '',
                                                quantityShop: 0,
                                                quantityStore: 0,
                                                minStock: 5,
                                                reorderPoint: 10,
                                                supplier: 'TBD',
                                                notes: []
                                            });
                                        }}
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: '#f44336',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        âŒ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>